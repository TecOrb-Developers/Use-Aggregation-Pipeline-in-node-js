"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _chain=_interopRequireDefault(require("ramda/es/chain"));var _clone=_interopRequireDefault(require("ramda/es/clone"));var _uniq=_interopRequireDefault(require("ramda/es/uniq"));var _xprod=_interopRequireDefault(require("ramda/es/xprod"));var _equals=_interopRequireDefault(require("ramda/es/equals"));var _addIndex=_interopRequireDefault(require("ramda/es/addIndex"));var _lib=require("@fusioncharts/core/src/lib");var _operators=require("@fusioncharts/datatable/src/operators");var _extent3=_interopRequireDefault(require("@fusioncharts/utils/src/array/extent"));var _safeMax=_interopRequireDefault(require("@fusioncharts/utils/src/array/safe-max"));var _timeIntervals=require("@fusioncharts/utils/src/time-intervals");var _utc=require("@fusioncharts/utils/src/time-intervals/utc");var _isObject=_interopRequireDefault(require("@fusioncharts/utils/src/type/is-object"));var _ordinal=_interopRequireDefault(require("@fusioncharts/utils/src/scales/ordinal"));var _isValidNumber=_interopRequireDefault(require("@fusioncharts/utils/src/type/is-valid-number"));var _arrayHasContent=_interopRequireDefault(require("@fusioncharts/utils/src/type/array-has-content"));var _datetimeEnums=require("@fusioncharts/utils/src/datetime-enums");var _stringHasContent=_interopRequireDefault(require("@fusioncharts/utils/src/type/string-has-content"));var _commonchartapi=_interopRequireDefault(require("@fusioncharts/charts/src/chart/_internal/commonchartapi"));var _colormanager=_interopRequireDefault(require("@fusioncharts/charts/src/_internal/color-utils/colormanager"));var _atomicity=require("./_utils/atomicity");var _binDecider=require("@fusioncharts/utils/src/bin-decider");var _diff=_interopRequireDefault(require("@fusioncharts/utils/src/scale-utils/array/diff.js"));var _capsFirst=_interopRequireDefault(require("@fusioncharts/utils/src/string/caps-first.js"));var _x=_interopRequireDefault(require("./factories/x"));var _y=_interopRequireDefault(require("./factories/y"));var _panel=_interopRequireDefault(require("./factories/panel"));var _caption=_interopRequireDefault(require("./factories/caption"));var _axis=_interopRequireDefault(require("./_utils/expanders/axis"));var _index=require("./_utils/index.js");var _panel2=_interopRequireDefault(require("./_utils/expanders/panel"));var _series=_interopRequireDefault(require("./_utils/expanders/series"));var _background=_interopRequireDefault(require("./factories/background"));var _line=_interopRequireDefault(require("../../_internal/components/dataset/line"));var _navigatorTime=_interopRequireDefault(require("./factories/navigator-time"));var _customRangeSelector=_interopRequireDefault(require("./factories/custom-range-selector"));var _toolbarManagerFactory=_interopRequireDefault(require("./factories/toolbar-manager-factory"));var _legendFactory=_interopRequireDefault(require("../../../src/_internal/factories/legend-factory"));var _toolbarFactory=_interopRequireDefault(require("../../../src/_internal/factories/toolbar-factory"));var _multicanvasCrosslineManager=_interopRequireDefault(require("../../_internal/factories/multicanvas-crossline-manager"));var _standardRangeSelector=_interopRequireDefault(require("../../../src/_internal/factories/standard-range-selector.factory"));var _isArray=_interopRequireDefault(require("@fusioncharts/utils/src/type/is-array"));var _timeConverter=_interopRequireDefault(require("@fusioncharts/utils/src/time-converter"));var _clipUtils=require("@fusioncharts/utils/src/clip-utils");var _fcTimeSeparator=_interopRequireDefault(require("@fusioncharts/utils/src/string/fc-time-separator"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))}keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}var standardTimeIntervals={day:_timeIntervals.timeDay,hour:_timeIntervals.timeHour,week:_timeIntervals.timeWeek,year:_timeIntervals.timeYear,month:_timeIntervals.timeMonth,minute:_timeIntervals.timeMinute,second:_timeIntervals.timeSecond,millisecond:_timeIntervals.timeMillisecond},utcStandardTimeIntervals={day:_utc.utcDay,hour:_utc.utcHour,week:_utc.utcWeek,year:_utc.utcYear,month:_utc.utcMonth,minute:_utc.utcMinute,second:_utc.utcSecond,millisecond:_utc.utcMillisecond},DEFAULT_CANVAS_DISTANCE=20,DEFAULT_TIMENAV_HEIGHT_RATIO=.3,DEFAULT_AXIS_HEIGHT_RATIO=.6,DEFAULT_CAPTION_HEIGHT_RATIO=.3,DEFAULT_LEGEND_RATIO=.1,CANVAS_TOP_PADDING=6,LINE_HEIGHT_FACTOR=1.2,STYLE_STR_ONE="style='",STYLE_STR_TWO="'",MONTH_MID=14,dropHash=_lib.regex.dropHash,AGGREGATE="aggregate",LEGEND_ALIGNMENT=6,date=function date(s){if(s===void 0){s=0}return new Date(s)},toString=function toString(d){if(d===void 0){d=""}return d.toString()},isDashedString=function isDashedString(str){return typeof str==="string"&&str!=="none"},columnsFilter=function columnsFilter(table,filterFn){return table.getSchema().filter(filterFn).map((function(scheme){return scheme.name}))},permuteIndices=function permuteIndices(arr){return arr.map((function(p){return{x:p.x,y:p.y,plots:(0,_xprod.default)(p.x.map((function(x){return x.index})),p.y.map((function(y){return y.index}))).map((function(prod){return{x:prod[0],y:prod[1]}}))}}))},reducersum=function reducersum(a,b){return a+b},getValidProportions=function getValidProportions(_prop,length){var finalProp={},prop=_prop,proparray=[];for(var i=0;i<length;i++){proparray.push(1)}finalProp.proportions=proparray;finalProp.totalProportions=length;if(typeof prop==="string"){prop=prop.split(":")}if(Array.isArray(prop)){prop=prop.filter((function(value){return value&&!isNaN(Number(value))&&Number(value)>0}));if(prop.length===length){prop=prop.map((function(value){return Number(value)}));finalProp.proportions=prop;finalProp.totalProportions=prop.reduce(reducersum,0)}}return finalProp},filterInformation=function filterInformation(ob){return Object.assign({},ob,{filter:ob.plot.map((function(n){return n.value})),filterInfo:{}})},getIndex=function getIndex(id){return+id.split("_").pop()},toolbarPositionParser=function toolbarPositionParser(positionArg){var position=positionArg;switch(position){case"tr":case"rt":case"top right":case"right top":position="tr";break;case"br":case"rb":case"bottom right":case"right bottom":position="br";break;case"tl":case"lt":case"top left":case"left top":position="tl";break;case"bl":case"lb":case"bottom left":case"left bottom":position="bl";break;default:position="tr"}return position},isDateScheme=function isDateScheme(scheme){return scheme.type==="date"},isIntervalScheme=function isIntervalScheme(scheme){return scheme.type==="interval"},isTemporalScheme=function isTemporalScheme(scheme){return isDateScheme(scheme)||isIntervalScheme(scheme)},isNumericScheme=function isNumericScheme(scheme){return scheme.type==="number"},isStringyScheme=function isStringyScheme(scheme){return scheme.type==="string"},flatMap=(0,_addIndex.default)(_chain.default),updateSet=function updateSet(set,arr){if(set===void 0){set=new Set}if(arr===void 0){arr=[]}var oldItemArr=Array.from(set),removedItems=(0,_diff.default)(oldItemArr,arr);removedItems.forEach((function(item){return set["delete"](item)}));arr.forEach((function(item){return set.add(item)}))},defaultPanelsMulticanvas=function defaultPanelsMulticanvas(xs,ys){return flatMap((function(fx,ix){return ys.map((function(fy,iy,yArr){return{x:[{index:ix,visible:iy===yArr.length-1}],y:[{index:iy,align:"left"}]}}))}),xs)},defaultPanelsSingleCanvas=function defaultPanelsSingleCanvas(xs,ys){return flatMap((function(fx,ix){return{x:[{index:ix,visible:true}],y:ys.map((function(fy,iy){return{index:iy,align:iy%2===0?"left":"right"}}))}}),xs)},parsePaletteColor=function parsePaletteColor(paletteInfo){if(paletteInfo===void 0){paletteInfo=[]}var colorArr=[];if((0,_arrayHasContent.default)(paletteInfo)){colorArr=paletteInfo.slice()}else if((0,_stringHasContent.default)(paletteInfo)){colorArr=paletteInfo.split(/\s*,\s*/)}colorArr=colorArr.filter((function(color){return!!color}));return colorArr.map((function(color){return(0,_lib.hashify)(color)}))},setLineHeight=function setLineHeight(styleObj,baseFontSize){if(typeof styleObj!=="object"){return}if(!styleObj["line-height"]){styleObj["line-height"]=(parseFloat(styleObj["font-size"])||baseFontSize||10)*LINE_HEIGHT_FACTOR+_lib.PXSTRING}},filterer=function filterer(tree,info){for(var filter in tree){if(tree.hasOwnProperty(filter)){if(!tree[filter]._fc_info.table){tree[filter]._fc_info.table=tree[filter]._fc_info.filter?info.table.query([tree[filter]._fc_info.filterInfo.query]):info.table;tree[filter]._fc_info.filterInfo.table=tree[filter]._fc_info.table}tableCreator(tree[filter])}}},grouping=function grouping(tree,info){for(var groupOp in tree){if(tree.hasOwnProperty(groupOp)){tree[groupOp]._fc_info.table=info.table;tree[groupOp]._fc_info.group=groupOp;tableCreator(tree[groupOp])}}},pivoter=function pivoter(tree,info){for(var pivotOp in tree){if(tree.hasOwnProperty(pivotOp)){tree[pivotOp]._fc_info.table=info.table;tree[pivotOp]._fc_info.groupItems=info.groupItems;tree[pivotOp]._fc_info.group=info.group;tableCreator(tree[pivotOp])}}},aggregator=function aggregator(operation){var operands=operation.operands,keys=[];if(operation.filter){for(var key in operands){if(operands.hasOwnProperty(key)){for(var opKey in operands[key]){if(operands[key].hasOwnProperty(opKey)&&(0,_isArray.default)(operands[key][opKey])){keys.push(opKey);operands[key][opKey].length=0}}}}keys=(0,_uniq.default)(keys)}else{for(var _key in operands){if(operands.hasOwnProperty(_key)&&(0,_isArray.default)(operands[_key])){keys.push(_key);operands[_key].length=0}}}return keys.map((function(operand){return{column:operand,operation:operation.op}}))},seriesGenerator=function seriesGenerator(operands,uniqueItems,aggregations,op){if(uniqueItems===void 0){uniqueItems=[]}var seriesNames=[];var _loop=function _loop(operand){if(operand!=="plottype"){var filterFn=function filterFn(aggr){return aggr.column===operand&&aggr.operation===op};if(uniqueItems.length>0){seriesNames=(0,_chain.default)((function(item){return aggregations.filter(filterFn).map((function(aggr){return[item,aggr.column,aggr.operation]}))}),uniqueItems).map((function(arr){return arr.join(_fcTimeSeparator.default)}))}else{seriesNames=aggregations.filter(filterFn).map((function(aggr){return[aggr.column,aggr.operation].join(_fcTimeSeparator.default)}))}seriesNames.forEach((function(name){return operands[operand].push(name)}))}};for(var operand in operands){_loop(operand)}},binner=function binner(tree,info){for(var bin in tree){if(tree.hasOwnProperty(bin)){(function(){var binInfo=tree[bin]._fc_info,binDecider=binInfo.binDecider,chart=binInfo.chart,thresholdX=binDecider.getRangeThreshold(),groupConfig=[{column:binInfo.bin,timeUnit:_datetimeEnums.DatetimeUnits[(0,_capsFirst.default)(thresholdX[0].name())],binSize:thresholdX[1],startValue:binInfo.totalStart,weekStartFrom:chart.config.startOfWeek}],filterColumn=info.group,filterItems=info.groupItems,pivotColumn=info.pivot,infoTable=info.table,agg=AGGREGATE;if(tree[bin][agg]){var ops=tree[bin][agg]._fc_info,operations=[],aggregations=[],query,queriedTables=[],uniqueItemsList=[],uniqueItemsSet=[],uniqueItems=[],tableCreated=false;for(var op in ops){if(ops.hasOwnProperty(op)){operations.push({op:op,operands:ops[op],filter:filterColumn})}}aggregations=(0,_chain.default)(aggregator,operations);if(filterColumn){var selectorFn=function selectorFn(item){var table,parentTable;for(var i=0;i<operations.length&&!table;++i){if(operations[i].operands[item].table){table=operations[i].operands[item].table;parentTable=table._parentTable}}return{table:table,filterQuery:!table&&(0,_operators.filter)((function(row,col){return row[col[filterColumn]]===item})),parentTable:parentTable}},filterQueries=filterItems.map(selectorFn),filteredTables=filterQueries.map((function(_ref){var table=_ref.table,filterQuery=_ref.filterQuery,parentTable=_ref.parentTable;return{newTable:!table,table:table||infoTable.query([filterQuery]),parentTable:parentTable}}));if(pivotColumn){query=(0,_operators.pivot)(groupConfig,pivotColumn,aggregations);filteredTables.forEach((function(_ref2){var table=_ref2.table,newTable=_ref2.newTable,parentTable=_ref2.parentTable;var items;if(newTable){tableCreated=true;items=table.unique(pivotColumn);uniqueItemsSet.push(new Set(items));uniqueItemsList.push(items);queriedTables.push(table.query([query]))}else{var oldItems=Array.from(table.__set);updateSet(table.__set,parentTable.unique(pivotColumn));items=Array.from(table.__set);uniqueItemsList.push(items);if(!(0,_equals.default)(items,oldItems)){if(!table.disposed){parentTable.disposeChildren();chart.removeEventListener("focusLimitChanged",info.query)}queriedTables.push(parentTable.query([query]));tableCreated=true}else{queriedTables.push(table)}}}))}else{query=(0,_operators.groupBy)(groupConfig,aggregations);queriedTables=filteredTables.map((function(_ref3){var table=_ref3.table,newTable=_ref3.newTable;if(newTable){tableCreated=true}return newTable?table.query([query]):table}))}}else{if(pivotColumn){query=(0,_operators.pivot)(groupConfig,pivotColumn,aggregations);uniqueItems=infoTable.unique(pivotColumn)}else{query=(0,_operators.groupBy)(groupConfig,aggregations)}if(operations[0].operands.table){var set=operations[0].operands.table.__set,oldItems=Array.from(set);updateSet(set,uniqueItems);uniqueItems=Array.from(set);uniqueItemsSet.push(set);if((0,_equals.default)(oldItems,uniqueItems)&&!operations[0].operands.table.diposed){queriedTables=[operations[0].operands.table]}else{operations[0].operands.table.dispose();queriedTables=[infoTable.query([query])];tableCreated=true}}else{uniqueItemsSet.push(new Set(uniqueItems));queriedTables=[infoTable.query([query])];tableCreated=true}}tableCreated&&chart.addEventListener("focusLimitChanged",info.query=function(e){if(!queriedTables.filter((function(table){return table&&!table.disposed})).length){e.detachHandler();return}thresholdX=binDecider.getRangeThreshold();groupConfig=[{column:binInfo.bin,timeUnit:_datetimeEnums.DatetimeUnits[(0,_capsFirst.default)(thresholdX[0].name())],binSize:thresholdX[1],startValue:binInfo.totalStart,weekStartFrom:chart.config.startOfWeek}];if(pivotColumn){query._updateArgs(groupConfig,pivotColumn,aggregations)}else{groupConfig.startValue=binInfo.totalStart;query._updateArgs(groupConfig,aggregations)}});operations.forEach((function(operation){var operands=operation.operands;if(filterColumn){filterItems.forEach((function(filterItem,index){var nodeInfo=operands[filterItem];nodeInfo.table=queriedTables[index];nodeInfo.position=binInfo.bin;nodeInfo.filterItem=filterItem;nodeInfo.table.__set=uniqueItemsSet[index];seriesGenerator(nodeInfo,uniqueItemsList[index],aggregations,operation.op)}))}else{operands.table=queriedTables[0];operands.position=binInfo.bin;operands.table.__set=uniqueItemsSet[0];seriesGenerator(operands,uniqueItems,aggregations,operation.op)}}))}})()}}},tableCreator=function tableCreator(tableMap){for(var op in tableMap){if(tableMap.hasOwnProperty(op)){var ops=tableMap[op];if(op==="filter"){filterer(ops,tableMap._fc_info)}else if(op==="group"){grouping(ops,tableMap._fc_info)}else if(op==="pivot"){pivoter(ops,tableMap._fc_info)}else if(op==="bin"){binner(ops,tableMap._fc_info)}}}},mapper=function mapper(chart,isContext){var panels,xs,ys,binDeciders,scalesX,scalesY,root,config=chart.config;if(isContext){panels=config.contextPanels;xs=config.contextAxesX;ys=config.contextAxesY;binDeciders=chart.getFromEnv("contextBins");scalesX=chart.getFromEnv("contextScalesX");scalesY=chart.getFromEnv("contextScalesY");root=config.contextTableMap}else{panels=config.focusPanels;xs=config.focusAxesX;ys=config.focusAxesY;binDeciders=chart.getFromEnv("focusBins");scalesX=chart.getFromEnv("focusScalesX");scalesY=chart.getFromEnv("focusScalesY");root=config.focusTableMap}for(var i=0,ii=panels.length;i<ii;i++){var plots=panels[i].plots;var _loop2=function _loop2(j,jj){var plot=plots[j],x=xs[plot.x],y=ys[plot.y],binDecider=binDeciders[plot.x],threshold=binDecider.getRangeThreshold(),xDomain=binDecider.getBinDomain().map(Number),scaleX=scalesX[plot.x],scaleY=scalesY[plot.y];var node=root;plot.plots=[];x.binDecider=binDecider;x.scale=scaleX;y.scale=scaleY;if(x.filter){if(!node.filter)node.filter={};node=node.filter;if(!x.filterInfo.query){x.filterInfo.query=(0,_operators.between)(x.filter[0],xDomain[0]-threshold[2]*2,xDomain[1]+threshold[2]*2)}if(!node["x__FC_OP_SEP__"+plot.x]){node["x__FC_OP_SEP__"+plot.x]={_fc_info:{filter:x.filter[0],filterInfo:x.filterInfo,start:xDomain[0],end:xDomain[1]}}}node=node["x__FC_OP_SEP__"+plot.x]}if(y.filter){if(!node)node.filter={};node=node.filter;if(!node["y__FC_OP_SEP__"+plot.y]){node["y__FC_OP_SEP__"+plot.y]={_fc_info:{filter:y.filter[0]}}}node=node["y__FC_OP_SEP__"+plot.y]}y.plot.forEach((function(eachPlot,index){var parent=node,uniqueItems=[];if(eachPlot.group){var group=eachPlot.group;if(!node.group)node.group={};node=node.group;if(!node[group]){node[group]={_fc_info:{}}}uniqueItems=config.dataTable.unique(group);if(node[group]._fc_info.groupItemsSet){var oldSet=node[group]._fc_info.groupItemsSet;updateSet(oldSet,uniqueItems);node[group]._fc_info.groupItems=uniqueItems=Array.from(oldSet)}else{node[group]._fc_info.groupItemsSet=new Set(uniqueItems);node[group]._fc_info.groupItems=uniqueItems}node=node[group]}if(eachPlot.stack){var stack=eachPlot.stack;if(!node.pivot)node.pivot={};node=node.pivot;if(!node[stack]){node[stack]={_fc_info:{pivot:stack}}}node=node[stack]}if(x.bin){if(!node.bin)node.bin={};node=node.bin;if(!node["x__FC_OP_SEP__"+plot.x]){node["x__FC_OP_SEP__"+plot.x]={_fc_info:{chart:chart,bin:x.bin[0],binDecider:binDecider}}}node=node["x__FC_OP_SEP__"+plot.x];node._fc_info.totalStart=+_timeIntervals.timeYear.floor(config.rawDataXStart)}if(y.bin){if(!node.bin)node.bin={};node=node.bin;if(!node["y__FC_OP_SEP__"+plot.y]){node["y__FC_OP_SEP__"+plot.y]={_fc_info:{bin:y.bin[0]}}}node=node["y__FC_OP_SEP__"+plot.y]}if(!node.aggregate)node.aggregate={_fc_info:{}};if(eachPlot.type==="candlestick"||eachPlot.type==="ohlc"){var len=eachPlot.group?uniqueItems.length:1;for(var k=0;k<len;++k){var ohlcObj={plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator},uniqueItem=eachPlot.group?uniqueItems[k]:_lib.UNDEF;if(eachPlot.open){if(!node.aggregate._fc_info.first){node.aggregate._fc_info.first={}}var first=node.aggregate._fc_info.first;if(uniqueItem&&!first[uniqueItem]){first[uniqueItem]={}}if(uniqueItem){if(!first[uniqueItem][eachPlot.open]){first[uniqueItem][eachPlot.open]=[]}}else{if(!first[eachPlot.open]){first[eachPlot.open]=[]}}ohlcObj.open=uniqueItem?first[uniqueItem][eachPlot.open]:first[eachPlot.open]}if(eachPlot.high){if(!node.aggregate._fc_info.max){node.aggregate._fc_info.max={}}var max=node.aggregate._fc_info.max;if(uniqueItem&&!max[uniqueItem]){max[uniqueItem]={}}if(uniqueItem){if(!max[uniqueItem][eachPlot.high]){max[uniqueItem][eachPlot.high]=[]}}else{if(!max[eachPlot.high]){max[eachPlot.high]=[]}}ohlcObj.high=uniqueItem?max[uniqueItem][eachPlot.high]:max[eachPlot.high]}if(eachPlot.low){if(!node.aggregate._fc_info.min){node.aggregate._fc_info.min={}}var min=node.aggregate._fc_info.min;if(uniqueItem&&!min[uniqueItem]){min[uniqueItem]={}}if(uniqueItem){if(!min[uniqueItem][eachPlot.low]){min[uniqueItem][eachPlot.low]=[]}}else{if(!min[eachPlot.low]){min[eachPlot.low]=[]}}ohlcObj.low=uniqueItem?min[uniqueItem][eachPlot.low]:min[eachPlot.low]}if(eachPlot.close){if(!node.aggregate._fc_info.last){node.aggregate._fc_info.last={}}var last=node.aggregate._fc_info.last;if(uniqueItem&&!last[uniqueItem]){last[uniqueItem]={}}if(uniqueItem){if(!last[uniqueItem][eachPlot.close]){last[uniqueItem][eachPlot.close]=[]}}else{if(!last[eachPlot.close]){last[eachPlot.close]=[]}}ohlcObj.close=uniqueItem?last[uniqueItem][eachPlot.close]:last[eachPlot.close]}var info=node.aggregate._fc_info;ohlcObj.tableInfo=(uniqueItem?[info.first[uniqueItem],info.max[uniqueItem],info.min[uniqueItem],info.last[uniqueItem]]:[info.first,info.max,info.min,info.last]).filter((function(s){return!!s}))[0];ohlcObj.value=eachPlot.value;ohlcObj.plotInAxisIndex=index;plot.plots.push(ohlcObj)}}else if(eachPlot.type==="column-range"||eachPlot.type==="area-range"){var _len=eachPlot.group?uniqueItems.length:1;for(var _k=0;_k<_len;++_k){var rangeObj={plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator,name:eachPlot.name},_uniqueItem=eachPlot.group?uniqueItems[_k]:_lib.UNDEF;if(eachPlot.high){if(!node.aggregate._fc_info.max){node.aggregate._fc_info.max={}}var _max=node.aggregate._fc_info.max;if(_uniqueItem&&!_max[_uniqueItem]){_max[_uniqueItem]={}}if(_uniqueItem){if(!_max[_uniqueItem][eachPlot.high]){_max[_uniqueItem][eachPlot.high]=[]}}else{if(!_max[eachPlot.high]){_max[eachPlot.high]=[]}}rangeObj.high=_uniqueItem?_max[_uniqueItem][eachPlot.high]:_max[eachPlot.high]}if(eachPlot.low){if(!node.aggregate._fc_info.min){node.aggregate._fc_info.min={}}var _min=node.aggregate._fc_info.min;if(_uniqueItem&&!_min[_uniqueItem]){_min[_uniqueItem]={}}if(_uniqueItem){if(!_min[_uniqueItem][eachPlot.low]){_min[_uniqueItem][eachPlot.low]=[]}}else{if(!_min[eachPlot.low]){_min[eachPlot.low]=[]}}rangeObj.low=_uniqueItem?_min[_uniqueItem][eachPlot.low]:_min[eachPlot.low]}var _info=node.aggregate._fc_info;rangeObj.tableInfo=(_uniqueItem?[_info.max[_uniqueItem],_info.min[_uniqueItem]]:[_info.max,_info.min]).filter((function(s){return!!s}))[0];rangeObj.plotInAxisIndex=index;plot.plots.push(rangeObj)}}else{if(!node.aggregate._fc_info[eachPlot.aggregation]){node.aggregate._fc_info[eachPlot.aggregation]={}}var aggregationObj=node.aggregate._fc_info[eachPlot.aggregation];if(eachPlot.group){for(var _k2=0;_k2<uniqueItems.length;++_k2){var _uniqueItem2=uniqueItems[_k2];if(!aggregationObj[_uniqueItem2]){aggregationObj[_uniqueItem2]={}}if(!aggregationObj[_uniqueItem2][eachPlot.value]){aggregationObj[_uniqueItem2][eachPlot.value]=[]}plot.plots.push({plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator,tableInfo:aggregationObj[_uniqueItem2],value:aggregationObj[_uniqueItem2][eachPlot.value],stack:eachPlot.stack,plotInAxisIndex:index})}}else{if(!aggregationObj[eachPlot.value]){aggregationObj[eachPlot.value]=[]}plot.plots.push({plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator,tableInfo:aggregationObj,value:aggregationObj[eachPlot.value],stack:eachPlot.stack,plotInAxisIndex:index})}}node=parent}))};for(var j=0,jj=plots.length;j<jj;j++){_loop2(j,jj)}}},getSmartLinearMin=function getSmartLinearMin(min,isBaseRequired,minLim){var reducedMin=min-Math.abs(min*.1);reducedMin=reducedMin<minLim?minLim:reducedMin;return reducedMin>0&&isBaseRequired?0:reducedMin},getSmartLogMin=function getSmartLogMin(min,isBaseRequired){var reducedMin=min*.9;return isBaseRequired?Math.min(reducedMin,1):reducedMin},getLogMinMax=function getLogMinMax(dataMin,dataMax,userMin,userMax,baseArg,isBaseRequired){var base=baseArg;if(!(0,_isValidNumber.default)(base)||base===0)base=10;var logMin=dataMin>0&&isFinite(dataMin)?getSmartLogMin(dataMin,isBaseRequired):1,enforcedMin=(0,_isValidNumber.default)(userMin)&&userMin>0&&userMin<dataMin?userMin:logMin,logMax=dataMax>0&&isFinite(dataMax)?dataMax:logMin+ +base,enforcedMax=(0,_isValidNumber.default)(userMax)&&userMax>enforcedMin?userMax:logMax*1.2;return[enforcedMin,enforcedMax]},getLinearMinMax=function getLinearMinMax(dataMinArg,dataMaxArg,userMinArg,userMaxArg,isBaseRequired){var dataMax=dataMaxArg,dataMin=dataMinArg,userMin=userMinArg,userMax=userMaxArg,linearMax,minLim,maxLim;!isFinite(dataMin)&&(dataMin=_lib.UNDEF);!isFinite(dataMax)&&(dataMax=_lib.UNDEF);!isFinite(userMin)&&(userMin=_lib.UNDEF);!isFinite(userMax)&&(userMax=_lib.UNDEF);minLim=dataMin===dataMax?dataMin-Math.abs(dataMin*.1):dataMin-Math.abs((dataMax-dataMin)*.2);maxLim=dataMin===dataMax?dataMax+Math.abs(dataMax*.2):dataMax+Math.abs((dataMax-dataMin)*.2);var linearMin=userMin<dataMin?userMin:dataMin!==_lib.UNDEF?getSmartLinearMin(dataMin,isBaseRequired,minLim):0,isNegitive=linearMin<0&&(userMax<0||dataMax<0);if(userMax>dataMax){linearMax=userMax}else if(dataMax!==_lib.UNDEF){if(isNegitive&&isBaseRequired){linearMax=0}else{linearMax=dataMax+Math.abs(dataMax*.2);linearMax=maxLim<linearMax?maxLim:linearMax}}else{linearMax=linearMin+1}return[linearMin,linearMax]},parseStrokeDashArray=function parseStrokeDashArray(styleDef){for(var property in styleDef){if(styleDef.hasOwnProperty(property)){var isStrokeDashArray=property==="stroke-dasharray";if(typeof styleDef[property]==="object"){parseStrokeDashArray(styleDef[property])}else if(isStrokeDashArray&&isDashedString(styleDef[property])){styleDef[property]=styleDef[property].replace(/^\s+|\s+$/g,"").replace(/,/g," ").split(" ").map((function(c){return+c}))}}}},parseOpacity=function parseOpacity(styleDef){for(var property in styleDef){if(styleDef.hasOwnProperty(property)){if(typeof styleDef[property]==="object"){parseOpacity(styleDef[property])}else if(property==="opacity"||property==="stroke-opacity"||property==="fill-opacity"){styleDef[property]=Math.max(0,Math.min(1,+styleDef[property]))}}}},updateBinStart=function updateBinStart(startObj,totalStart){var bin=startObj.bin;for(var i in bin){if(bin.hasOwnProperty(i)&&/x__FC_OP_SEP__/.test(i)){var binInfo=bin[i]._fc_info;binInfo.totalStart=totalStart}}},updateGroupByStart=function updateGroupByStart(tableMap,timeStart){var totalStart=+_timeIntervals.timeYear.floor(timeStart);if(tableMap.filter){var startObj=tableMap.filter;for(var key in startObj){if(startObj.hasOwnProperty(key)&&/x__FC_OP_SEP__/.test(key)){updateBinStart(startObj[key],totalStart)}}}else{updateBinStart(tableMap,totalStart)}},disposeFn=function disposeFn(component){component.dispose&&component.dispose()},useFirstTables=function useFirstTables(obj,rootTable,useTable){if(obj===void 0){obj={}}if(useTable===void 0){useTable=_lib.stubFN}var keys=Object.keys(obj),len=keys.length,continueRecursion=true;for(var i=0;i<len&&continueRecursion;++i){var key=keys[i],el=obj[key];if(key==="_fc_info"||key==="table"){var table=key==="table"?el:el.table;if(table&&table!==rootTable){useTable(table);continueRecursion=false}}else if(key===AGGREGATE){useFirstTables(el._fc_info,rootTable,useTable)}else if((0,_isObject.default)(el)){useFirstTables(el,rootTable,useTable)}}},actionsReducer=function actionsReducer(action,type,chart){switch(action){case"plot":chart.showWarning("02362480","param"," Timeseries"," Some plot configurations were ignored. Please provide valid values to the plot attribute within a "+type+"Axis configuration.");break;case"axis":chart.showWarning("08927060","param"," Timeseries","Some "+type+"Axis configurations were ignored. Please provide a valid value to the plot attribute within the "+type+"Axis configurations.");break;case"fullaxis":chart.showWarning("08963401","param"," Timeseries","All "+type+"Axis configurations were ignored. Please provide a valid value to the plot attribute within the "+type+"Axis configurations. Defaulting to showing all numeric columns in separate canvases.");break;default:}},createStyleStr=function createStyleStr(styleObj){if(styleObj===void 0){styleObj={}}var key,styleStr=STYLE_STR_ONE;for(key in styleObj){if(styleObj.hasOwnProperty(key)){styleStr+=key+": "+styleObj[key]+"; "}}styleStr+=STYLE_STR_TWO;return styleStr},parsePrediction=function parsePrediction(dataSource,getStyleDef){var prediction={},styleKey={};if(dataSource.extensions&&(0,_isObject.default)(dataSource.extensions.prediction)){prediction=dataSource.extensions.prediction;prediction.enabled=true}else{prediction={enabled:false}}if((0,_isObject.default)(prediction.style)){for(styleKey in prediction.style){if(prediction.style.hasOwnProperty(styleKey)){prediction.style[styleKey]=getStyleDef(prediction.style[styleKey])}}}else{prediction.style={}}return prediction};function dateAPI(dateVal,param,utc){return dateVal["get"+utc+param]()}function getBinIndex(scale,curTimeStamp,startTimeStamp){var curBin=scale._getRangeThreshold(),showPlotOverTick=scale.showPlotOverTick(),squareOff=showPlotOverTick?Math.round:Math.floor,yearsInBetween,startTime=new Date(startTimeStamp),curTime=new Date(curTimeStamp),startMonth,curMonth,startYear,curYear,index,binLength=curBin[2];if(curBin[0].name()==="year"){return squareOff(curBin[0].count(startTimeStamp,curTimeStamp)/curBin[1])}else if(curBin[0].name()==="month"){startYear=dateAPI(startTime,"FullYear",scale.getType());curYear=dateAPI(curTime,"FullYear",scale.getType());startMonth=dateAPI(startTime,"Month",scale.getType());curMonth=dateAPI(curTime,"Month",scale.getType());yearsInBetween=Math.max(0,curYear-startYear-1);if(startYear===curYear){index=Math.floor(curMonth/curBin[1])-Math.floor(startMonth/curBin[1])}else{index=yearsInBetween*12/curBin[1];index+=12/curBin[1]-Math.floor(startMonth/curBin[1]);index+=Math.floor(curMonth/curBin[1])}if(showPlotOverTick&&curTime.getDate()>MONTH_MID){index++}return index}return squareOff((curTimeStamp-startTimeStamp)/binLength)}function _onDataUpdate(_ref4){var _ref4$data=_ref4.data,_ref4$data$parsedRows=_ref4$data.parsedRows,parsedRows=_ref4$data$parsedRows===void 0?[]:_ref4$data$parsedRows,tableID=_ref4$data.tableID;var chart=this,config=chart.config,focusAxis=config.focusAxesX[0],clipDates=config.clipDates,_this$getFromEnv=this.getFromEnv("dateColumn"),dateColumnName=_this$getFromEnv.name,clippedRows=function clippedRows(row,col){var t=row[col[dateColumnName]];return clipDates.some((function(_ref5){var from=_ref5.from,to=_ref5.to;return t>=from&&t<=to}))},contextBins=chart.getFromEnv("contextBins"),focusBins=chart.getFromEnv("focusBins"),focusScalesX=chart.getFromEnv("focusScalesX"),contextScalesX=chart.getFromEnv("contextScalesX"),data=config.dataTable.getData().data,newDataLimit=(0,_extent3.default)(parsedRows,(function(row){return(0,_arrayHasContent.default)(row)&&row[config.dateColumnIndex]})),newContextLimit=[],lastContextLimit=this.getContextLimit(),binStartTime=_timeIntervals.timeYear.floor(lastContextLimit[0]),focusLimit=this.getFocusLimit(),newFocusLimit=focusLimit.slice(),lastFocusDuration=focusLimit[1]-focusLimit[0],newStartLimit=Math.min(data[0][config.dateColumnIndex],newDataLimit[0]),isNewBinAdded=false,getDeletionTime=function getDeletionTime(){var interval=contextBins[0].getRangeThreshold()[0];return+interval.offset(lastContextLimit[0],interval.count(lastContextLimit[1],newDataLimit[1]))},ops=[];if(config.dataTable.getID()===tableID){if(clipDates.length){ops=[(0,_operators.filter)(clippedRows)]}contextScalesX.some((function(scale){var currentMaxIndex=getBinIndex(scale,lastContextLimit[1],binStartTime),newMaxIndex=getBinIndex(scale,newDataLimit[1],binStartTime),indexDiff=newMaxIndex-currentMaxIndex;if(indexDiff>0){newStartLimit=getDeletionTime();ops=ops.concat((0,_operators.less)(dateColumnName,newStartLimit-(contextBins[0].getRangeThreshold()[2]===1?0:1)));isNewBinAdded=true;return true}return false}));if(ops.length){config.dataTable.getDataStore().deleteRows(_operators.pipe.apply(void 0,ops),config.dataTable.getID());data=config.dataTable.getData().data;newStartLimit=Math.max(newStartLimit,Math.min(data[0][config.dateColumnIndex],newDataLimit[0]))}config.contextAxesX.forEach((function(_ref6){var binDecider=_ref6.binDecider,scale=_ref6.scale;config.atomicity.minBin=(0,_atomicity.getAtomicity)(_objectSpread(_objectSpread({},config.atomicity),{},{index:config.dateColumnIndex,data:data.slice(-parsedRows.length-1),bins:binDecider.getStandardBins(),intervalIndexMap:binDecider.intervalIndexMap,ms:scale.getTimeInterval().Millisecond}));binDecider.setBinMin(config.atomicity.minBin);scale.setRangeThreshold(binDecider.getRangeThreshold())}));config.focusAxesX.forEach((function(_ref7){var binDecider=_ref7.binDecider,scale=_ref7.scale;binDecider.setBinMin(config.atomicity.minBin);scale.setRangeThreshold(binDecider.getRangeThreshold())}));if(isNewBinAdded||data.length-parsedRows.length===0){var minBin=contextBins[0].getBinMin(),curBin=contextBins[0].getRangeThreshold();if(config.timeSpread){newContextLimit[1]=newDataLimit[1];newContextLimit[0]=Math.min(config.timeSpread.interval.offset(newDataLimit[1],-config.timeSpread.multiplier),curBin[0].offset(newDataLimit[1],-2))}else{if(isNewBinAdded){newContextLimit[1]=newDataLimit[1];newContextLimit[0]=Math.min(newDataLimit[1]-(lastContextLimit[1]-lastContextLimit[0]),newDataLimit[1]-(newDataLimit[1]-newStartLimit),minBin[0].offset(newDataLimit[1],-3))}else if(data.length-parsedRows.length===0){newContextLimit[1]=newDataLimit[1];newContextLimit[0]=Math.min(newDataLimit[1]-(lastContextLimit[1]-lastContextLimit[0]),newDataLimit[1]-(newDataLimit[1]-newStartLimit),minBin[0].offset(newDataLimit[1],-3))}else{newContextLimit=(0,_extent3.default)([].concat(lastContextLimit,newDataLimit),Number)}}}else{if(config.timeSpread){var lowerBound=Math.min(lastContextLimit[0],newDataLimit[0]),upperBound=Math.max(lastContextLimit[1],newDataLimit[1]),upperDiff=Math.max(0,newDataLimit[1]-lastContextLimit[1]);newContextLimit=[lowerBound+upperDiff,upperBound]}else{newContextLimit=(0,_extent3.default)([].concat(lastContextLimit,newDataLimit),Number)}}var startUpdated=config.rawDataXStart!==newStartLimit&&!config.hasSeries;if(startUpdated){updateGroupByStart(config.focusTableMap,newStartLimit);updateGroupByStart(config.contextTableMap,newStartLimit)}config.rawDataXStart=newStartLimit;chart.setContextLimit(newContextLimit);if(focusLimit[0]<=lastContextLimit[0]){newFocusLimit[0]=newContextLimit[0];if(focusLimit[1]!==lastContextLimit[1]){newFocusLimit[1]=newFocusLimit[0]+lastFocusDuration}}if(focusLimit[1]>=lastContextLimit[1]){newFocusLimit[1]=newContextLimit[1];if(focusLimit[0]!==lastContextLimit[0]){newFocusLimit[0]=newFocusLimit[1]-lastFocusDuration}}if(newFocusLimit[0]<newContextLimit[0]){newFocusLimit[0]=newContextLimit[0];newFocusLimit[1]=newFocusLimit[0]+lastFocusDuration}if(newFocusLimit[1]>newContextLimit[1]){newFocusLimit[1]=newContextLimit[1];newFocusLimit[0]=newFocusLimit[1]-lastFocusDuration}if(config.hasSeries){if(!(0,_equals.default)(newFocusLimit,focusLimit)){focusBins[0].setBinDomain(newFocusLimit)}var threshold=focusBins[0].getRangeThreshold();focusScalesX[0].setRangeThreshold(threshold);if(focusAxis.filterInfo&&focusAxis.filterInfo.query){focusAxis.filterInfo.query._updateArgs(+threshold[0].offset(+newFocusLimit[0],-2*threshold[1]),+threshold[0].offset(+newFocusLimit[1],2*threshold[1]))}mapper(chart);mapper(chart,true);tableCreator(config.focusTableMap);tableCreator(config.contextTableMap);chart._createLegendMap(true);for(var i=0;i<contextBins.length;++i){var pixels=config.pixelMultiplier*_binDecider.DEFAULT_THRESHOLD_PIXELS;contextBins[i].setRangeThreshold(pixels);focusBins[i].setRangeThreshold(pixels);contextScalesX[i].setRangeThreshold(contextBins[i].getRangeThreshold());focusScalesX[i].setRangeThreshold(focusBins[i].getRangeThreshold())}}if(!chart.setFocusLimit(newFocusLimit,false)){config.focusAxesX[0].filterInfo.table.flushResults();startUpdated&&chart.fireEvent("focusLimitChanged");chart._updateAffectedVisuals({legendInteracted:null})}}}function _offDataUpdate(){var dataTable=this.config.dataTable;dataTable.getDataStore().off("itemsAdded",this._onDataUpdate)}var TimeSeries=function(_CommonAPI){(0,_inheritsLoose2.default)(TimeSeries,_CommonAPI);function TimeSeries(){var _this;_this=_CommonAPI.call(this)||this;var chart=(0,_assertThisInitialized2.default)(_this);_this._onDataUpdate=_onDataUpdate.bind((0,_assertThisInitialized2.default)(_this));_this._offDataUpdate=_offDataUpdate.bind((0,_assertThisInitialized2.default)(_this));chart.eiMethods={getYAxis:function getYAxis(){return chart.getFromEnv("chartInstance").getJSONData().yaxis},setYAxis:function setYAxis(){var chartInstance=chart.getFromEnv("chartInstance");if(arguments.length){var data=chartInstance.getJSONData();data.yaxis=arguments.length<=0?undefined:arguments[0];chartInstance.setJSONData(data)}return chartInstance},getCurrentBin:function getCurrentBin(){var binDecider=chart.getFromEnv("focusBins")[0],currentBin=binDecider.getRangeThreshold();return{unit:currentBin[0].name(),multiplier:currentBin[1]}},setCurrentBin:function setCurrentBin(customBinObj){var customBin=(0,_index.validateUserBin)(customBinObj,chart);if(customBin){chart.setFocusLimit((0,_index.calculateDomainForUserCustomBin)(customBin,chart))}return this},getTimeSelection:function getTimeSelection(){var _chart$getFocusLimit=chart.getFocusLimit(),start=_chart$getFocusLimit[0],end=_chart$getFocusLimit[1];return{start:start,end:end}},setTimeSelection:function setTimeSelection(timeInterval){var validatedTimeInterval=(0,_index.validateFocusLimit)(timeInterval,this.getTimeSelection(),chart);if(validatedTimeInterval){chart.setFocusLimit(validatedTimeInterval)}return this},getBinning:function getBinning(){return(0,_index.filterStandarBinsToUserConfig)(chart.getFromEnv("contextBins")[0].getStandardBins())},setBinning:_index.setBinningRules,feedData:function feedData(rows){if((0,_arrayHasContent.default)(rows)){var config=chart.config,contextLimit=chart.getContextLimit(),baseTimeConverter=config.baseTimeConverter,dateColumnIndex=config.dateColumnIndex;if(chart.cloneTable()){config.focusTableMap={_fc_info:{table:config.dataTable}};config.contextTableMap={_fc_info:{table:config.dataTable}};mapper(chart);mapper(chart,true);tableCreator(config.focusTableMap);tableCreator(config.contextTableMap);config.dataTable.getDataStore().on("itemsAdded",chart._onDataUpdate)}var filteredData=rows.filter((function(row){return+baseTimeConverter.parse(row[dateColumnIndex])>=contextLimit[0]}));if(filteredData.length){config.dataTable.getDataStore().appendRows(filteredData,config.dataTable.getID())}}return chart}};chart.addToEnv("getStyleDef",(function(styleDefArg){if(styleDefArg===void 0){styleDefArg={}}var styleDef=styleDefArg,defaulTextStyle=chart.getFromEnv("textStyle"),mergedStyle;if(typeof styleDef==="string"){var styleDefinition=chart.getFromEnv("dataSource").styledefinition;mergedStyle={};styleDefinition&&styleDef.split(/\s+/g).forEach((function(style){return(0,_lib.extend2)(mergedStyle,styleDefinition[style])}))}if(mergedStyle){styleDef=mergedStyle}parseStrokeDashArray(styleDef);parseOpacity(styleDef);(styleDef["font-size"]||styleDef["font-size"]===0)&&setLineHeight(styleDef,defaulTextStyle["font-size"]);return styleDef}));chart.deregisterFactory("canvas");chart.registerFactory("background",_background.default);chart.registerFactory("caption",_caption.default);chart.registerFactory("legend",_legendFactory.default);chart.registerFactory("panel",_panel.default);chart.registerFactory("selectorToolbar",_toolbarFactory.default,["timeNavigator","canvas"]);chart.registerFactory("timeNavigator",_navigatorTime.default);chart.registerFactory("standardRangeSelector",_standardRangeSelector.default,["selectorToolbar"]);chart.registerFactory("customRangeSelector",_customRangeSelector.default,["selectorToolbar"]);chart.registerFactory("multicanvasCrosslineManager",_multicanvasCrosslineManager.default,["mouseTracker"]);chart.registerFactory("toolbarManager",_toolbarManagerFactory.default,["standardRangeSelector","customRangeSelector"]);return _this}TimeSeries.getName=function getName(){return"timeseries"};var _proto=TimeSeries.prototype;_proto.getName=function getName(){return"timeseries"};_proto.__setDefaultConfig=function __setDefaultConfig(){var config=this.config;config.skipConfigureIteration={};config.canvasAxisMap={};config.scaleDsMap={};config.palettecolors=["#5D62B5","#29C3BE","#F2726F","#FFC533","#62B58F","#BC95DF","#67CDF2"];config.defaultLegendTextStyle={"font-family":_lib.DEFAULT_FT_FONT,"font-weight":"normal","font-style":"normal","font-size":"12px",fill:"#5F5F5F","line-height":"14px",opacity:"1","fill-opacity":"1"};config.defaultTooltipStyle={"background-color":(0,_lib.convertColor)("#ffffff","90"),color:"#5f5f5f","border-color":"#e8e8e8","border-width":"1px","border-radius":"0px","line-height":1,"font-family":_lib.DEFAULT_FT_FONT,padding:"3px",opacity:.9};this.addToEnv("textStyle",{"font-family":"sans-serif","font-size":"10",fill:"#000000","line-height":"12"});config.contextPanels=[];config.contextLimit=config.focusLimit=_lib.UNDEF;config.legendMap={};config.isXMLUnsupported=true;config.uniqueItemsMap={};config.isTableCloned=false;config.hasSeries=false;config.clipDates=_lib.UNDEF};_proto.cloneTable=function cloneTable(){var chart=this,config=chart.config,_config$dataTable$get=config.dataTable.getData(),data=_config$dataTable$get.data,schema=_config$dataTable$get.schema;if(!config.isTableCloned){var newDataTable=config.dataTable.getDataStore().createDataTable(data.map((function(row){return row.map((function(cell,idx){return isDateScheme(schema[idx])?config.baseTimeConverter.format(cell):cell}))})),schema);useFirstTables(config.focusTableMap,config.dataTable,disposeFn);useFirstTables(config.contextTableMap,config.dataTable,disposeFn);config.dataTable=newDataTable;config.isTableCloned=true;return true}return false};_proto.setTooltipStyle=function setTooltipStyle(){var tooltipStyle=this.getFromEnv("tooltipStyle"),baseTextStyle=this.getFromEnv("baseTextStyle"),toolTipController=this.getFromEnv("toolTipController");tooltipStyle.container=Object.assign({},this.config.defaultTooltipStyle,baseTextStyle,tooltipStyle.text,tooltipStyle.container);tooltipStyle.header=Object.assign({"font-size":(0,_lib.pluck)(tooltipStyle.container["font-size"],"12px"),"font-weight":(0,_lib.pluck)(tooltipStyle.container["font-weight"],"bold"),"font-family":tooltipStyle.container["font-family"],padding:"5px 5px 0",color:(0,_lib.getLightColor)("#5f5f5f",76)},tooltipStyle.header);tooltipStyle.body=Object.assign({"font-size":(0,_lib.pluck)(tooltipStyle.container["font-size"],"11px"),"font-weight":(0,_lib.pluck)(tooltipStyle.container["font-weight"],"normal"),"font-family":tooltipStyle.container["font-family"],padding:"0 5px 5px"},tooltipStyle.body);toolTipController.setStyle(tooltipStyle.container);toolTipController.setRestrictionWithinCanvas({bottom:true});tooltipStyle.headerStyleString=createStyleStr(tooltipStyle.header);tooltipStyle.bodyStyleString=createStyleStr(tooltipStyle.body)};_proto.sanitizeData=function sanitizeData(attrs){var _this2=this;if(attrs.yaxis&&attrs.yaxis.format){if(attrs.yaxis.format.suffix){attrs.yaxis.format.suffix=(0,_lib.parseUnsafeString)(attrs.yaxis.format.suffix)}if(attrs.yaxis.format.prefix){attrs.yaxis.format.prefix=(0,_lib.parseUnsafeString)(attrs.yaxis.format.prefix)}}_CommonAPI.prototype.sanitizeData.call(this,attrs);var _expanderAxis=(0,_axis.default)(columnsFilter(attrs.data,isTemporalScheme),attrs.xaxis,false),xAxis=_expanderAxis.expandedAxis,xActions=_expanderAxis.actions,_expanderAxis2=(0,_axis.default)(columnsFilter(attrs.data,isNumericScheme),attrs.yaxis),yAxis=_expanderAxis2.expandedAxis,yActions=_expanderAxis2.actions;attrs.xaxis=xAxis;attrs.yaxis=yAxis;xActions.forEach((function(action){return actionsReducer(action,"x",_this2)}));yActions.forEach((function(action){return actionsReducer(action,"y",_this2)}))};_proto.getDSdef=function getDSdef(){return _line.default};_proto._updateVisuals=function _updateVisuals(){_CommonAPI.prototype._updateVisuals.call(this);this.getFromEnv("paper").config.noDefaultAttribs=true};_proto.setPixelLimit=function setPixelLimit(pixelLimit,scale,direction,event){if(direction===void 0){direction=["up","up"]}var startPx=pixelLimit[0],endPx=pixelLimit[1],applyEvent,_scale$applicableClip=scale.applicableClippings,repeatClips=_scale$applicableClip.repeatClips,singleClips=_scale$applicableClip.singleClips,startVal=(0,_clipUtils.getUnclippedValue)(scale.getDomainValue(startPx),repeatClips,singleClips,{clampDirection:direction[0]}),endVal=(0,_clipUtils.getUnclippedValue)(scale.getDomainValue(endPx),repeatClips,singleClips,{clampDirection:direction[1]});if((applyEvent=this.setFocusLimit([startVal,endVal]))&&event){this.getFromEnv("fireChartEvents")(event.name,[startVal,endVal],event.eventArgs,event.options)}return applyEvent};_proto.domainValidator=function domainValidator(currentDomain,totalDomain,prevDomain){if(prevDomain===void 0){prevDomain=[]}var chart=this,mode,rangeThreshold=chart.getFromEnv("contextBins")[0].getBinMin(),focusScale=chart.getFromEnv("focusScalesX")[0],currentDomainStartValue=currentDomain[0],currentDomainEndValue=currentDomain[1],totalDomainStartValue=totalDomain[0],validatedDomainDiff,totalDomainEndValue=totalDomain[1],currentDomainStartValuems=+currentDomain[0],currentDomainEndValuems=+currentDomain[1],totalDomainStartValuems=+totalDomain[0],totalDomainEndValuems=+totalDomain[1],febGutter=0;if(prevDomain.length){mode=Math.abs(currentDomainEndValuems-currentDomainStartValuems-(+prevDomain[1]-+prevDomain[0]))>1?"squeeze":"drag"}if(currentDomainStartValuems<totalDomainStartValuems){currentDomainStartValue=totalDomainStartValue;currentDomainEndValue=mode==="drag"?new Date(currentDomainEndValuems+(totalDomainStartValuems-currentDomainStartValuems)):currentDomainEndValue}if(currentDomainEndValuems>totalDomainEndValuems){currentDomainEndValue=totalDomainEndValue;currentDomainStartValue=mode==="drag"?new Date(currentDomainStartValuems-(currentDomainEndValuems-totalDomainEndValuems)):currentDomainStartValue}if(currentDomainEndValuems<totalDomainStartValuems){currentDomainEndValue=totalDomainStartValue}if(currentDomainStartValuems>totalDomainEndValuems){currentDomainStartValue=totalDomainEndValue}if(currentDomainStartValuems>currentDomainEndValuems){var _ref8=[currentDomainEndValue,currentDomainStartValue];currentDomainStartValue=_ref8[0];currentDomainEndValue=_ref8[1]}if(Object.keys(focusScale.applicableClippings).length){validatedDomainDiff=focusScale.distance(currentDomainStartValue,currentDomainEndValue)}else{validatedDomainDiff=currentDomainEndValue-currentDomainStartValue}if(rangeThreshold[0].name()==="month"&&rangeThreshold[1]===1){febGutter=864e5}if(validatedDomainDiff>=3*rangeThreshold[2]-febGutter){chart.fireEvent("domainValidated");currentDomainStartValue=(0,_lib.clampNumber)(+currentDomainStartValue,totalDomainStartValuems,totalDomainEndValuems);currentDomainEndValue=(0,_lib.clampNumber)(+currentDomainEndValue,totalDomainStartValuems,totalDomainEndValuems);return[+currentDomainStartValue,+currentDomainEndValue]}return chart.getFocusLimit()||chart.getContextLimit()};_proto.configureAttributes=function configureAttributes(attrs){var chart=this,config=chart.config,colorManager=new _colormanager.default(chart),ordinalScale=new _ordinal.default,chartAttrs=attrs.chart,colors=parsePaletteColor(chartAttrs.palettecolors),canvasHeightProportion=chartAttrs.canvasheightproportion,getStyleDef=chart.getFromEnv("getStyleDef"),legendConf=attrs.legend,baseTextStyle=getStyleDef(chartAttrs.style&&chartAttrs.style.text),timeSpread=Object.assign({},chartAttrs.timespread),unit=_datetimeEnums.DatetimeUnits[(0,_capsFirst.default)(String(timeSpread.unit))],dataSource=chart.getFromEnv("dataSource"),defaultTextStyle=(0,_lib.extend2)(chart.getFromEnv("textStyle"),baseTextStyle),tooltipConfig=(0,_isObject.default)(attrs.tooltip)?attrs.tooltip:{},tooltipStyle=(0,_isObject.default)(tooltipConfig.style)?tooltipConfig.style:{},dataObj=this.getFromEnv("dataSource");config.startOfWeek=parseInt(attrs.chart.startofweek,10)===0?_datetimeEnums.Weekdays.Sunday:_datetimeEnums.Weekdays.Monday;var legendStyle=getStyleDef(legendConf&&legendConf.style&&legendConf.style.text),interimXExpand=[],dateColumn,isUTC,formatter,parser;chart.addToEnv("baseTextStyle",Object.assign({"font-family":_lib.DEFAULT_FT_FONT,stroke:"none"},baseTextStyle));legendStyle=Object.assign({},chart.getFromEnv("baseTextStyle"),legendStyle);config.mergedLegendStyle=(0,_lib.extend2)((0,_lib.extend2)({},config.defaultLegendTextStyle),legendStyle);if(config.focusTableMap){useFirstTables(config.focusTableMap,config.focusTableMap._fc_info.table,disposeFn);config.focusTableMap=_lib.UNDEF}if(config.contextTableMap){useFirstTables(config.contextTableMap,config.contextTableMap._fc_info.table,disposeFn);config.contextTableMap=_lib.UNDEF}chart.addToEnv("chart-attrib",chartAttrs);colorManager.configure();chart.addToEnv("color-manager",colorManager);if(colors.length){config.palettecolors=colors}var _dataObj$data$getData=dataObj.data.getData(),schema=_dataObj$data$getData.schema;for(var key in schema){if(schema.hasOwnProperty(key)){var itemInfo=schema[key];if(typeof itemInfo.paletteColor==="string"&&itemInfo.paletteColor!==""){config.palettecolors[key-1]=itemInfo.paletteColor}}}ordinalScale.setRange(config.palettecolors);chart.addToEnv("ordinalScale",ordinalScale);config.dataTable=attrs.data;config.showLegend=(0,_lib.pluckNumber)(legendConf&&legendConf.enabled,chartAttrs.showlegend,1);config.navigatorEnabled=(0,_lib.pluckNumber)(dataSource.navigator&&dataSource.navigator.enabled,chartAttrs.enablenavigator,1);config.navigatorHeight=(0,_lib.pluckNumber)(dataSource.navigator&&dataSource.navigator.height);config.showTooltip=(0,_lib.pluckNumber)(tooltipConfig.enabled,chartAttrs.showtooltip,1);config.interCanvasSpace=(0,_lib.pluckNumber)(chartAttrs.intercanvasspace,DEFAULT_CANVAS_DISTANCE);config.multiCanvas=(0,_lib.pluckNumber)(chartAttrs.multicanvas,1);config.applycsstransform=(0,_lib.pluckNumber)(chartAttrs.applycsstransform,0);isUTC=(0,_lib.pluck)(chartAttrs.enableutc,false);chart.addToEnv("UTC",isUTC);chart.addToEnv("dateAPI",(function(dt,param,utc){return dt["get"+(utc?"UTC":"")+param]()}));interimXExpand=attrs.xaxis.slice(0,1).map((function(ob){return Object.assign({},ob,{bin:ob.plot.map((function(n){return n.value}))})}));config.focusAxesX=interimXExpand.map(filterInformation);config.focusAxesY=(0,_series.default)(columnsFilter(config.dataTable,isStringyScheme),attrs.yaxis,attrs.series,attrs.stack,attrs.group);config.contextAxesX=(0,_clone.default)(interimXExpand);config.contextAxesY=(0,_clone.default)(config.focusAxesY);config.dateColumnIndex=config.dataTable.indexOf(config.contextAxesX[0].plot[0].value);dateColumn=config.dataTable.getSchema()[config.dateColumnIndex];parser=dateColumn.format?isUTC?_timeConverter.default.utcParser(dateColumn.format):_timeConverter.default.parser(dateColumn.format):{parse:date};formatter=dateColumn.format?isUTC?_timeConverter.default.utcFormatter(dateColumn.format):_timeConverter.default.formatter(dateColumn.format):{format:toString};config.baseTimeConverter={toString:function toString(){return parser.toString()},parse:function parse(s){return parser.parse(s)},format:function format(d){return formatter.format(d)}};chart.addToEnv("baseTimeConverter",config.baseTimeConverter);chart.addToEnv("dateColumn",dateColumn);if(unit){timeSpread.unit=unit;timeSpread.multiplier=(0,_safeMax.default)([(0,_lib.pluckNumber)(timeSpread.multiplier-1),1],Number);timeSpread.duration=timeSpread.unit.ms*timeSpread.multiplier;timeSpread.interval=isUTC?utcStandardTimeIntervals[unit.name.toLowerCase()]:standardTimeIntervals[unit.name.toLowerCase()];config.timeSpread=timeSpread}config.focusPanels=permuteIndices((0,_panel2.default)(config.focusAxesX,config.focusAxesY,attrs.canvas,config.multiCanvas?defaultPanelsMulticanvas:defaultPanelsSingleCanvas));config.canvasHeightProportion=getValidProportions(canvasHeightProportion,config.focusPanels.length);chart._createLegendMap();chart.addToEnv("fireChartEvents",(function(eventType,limit,args,options){if(args===void 0){args={}}if(options===void 0){options={}}var currFocusLimit=chart.getFocusLimit(),contextLimit=chart.getContextLimit(),limitsAfterValidation=chart.domainValidator(limit,contextLimit,currFocusLimit),eventArguments,fmtr;eventArguments={start:limitsAfterValidation[0],end:limitsAfterValidation[1]};if(fmtr=options.timeFormatter){eventArguments.startText=fmtr.format(limitsAfterValidation[0]);eventArguments.endText=fmtr.format(limitsAfterValidation[1])}(0,_lib.extend2)(eventArguments,args);chart.fireChartInstanceEvent(eventType,eventArguments)}));(0,_x.default)(chart);(0,_y.default)(chart);config.focusTableMap={_fc_info:{table:config.dataTable}};mapper(chart);config.contextPanels=permuteIndices((0,_panel2.default)(config.contextAxesX,config.contextAxesY,[],(function(xs,ys){return xs.map((function(cx,ix){return{x:[{index:ix}],y:ys.map((function(cy,iy){return{index:iy,visible:false}}))}}))})));config.contextTableMap={_fc_info:{table:config.dataTable}};mapper(chart,true);tableCreator(config.focusTableMap);tableCreator(config.contextTableMap);config.printOption={enabled:(0,_lib.pluckNumber)(chartAttrs.printshowbutton,chartAttrs.showprintmenuitem,0)};config.toolbarPosition=toolbarPositionParser((0,_lib.pluck)(chartAttrs.toolbarposition,"tr").toLowerCase());config.toolbarHAlign=(""+chartAttrs.toolbarhalign).toLowerCase()==="left"?"l":config.toolbarPosition.charAt(1);config.toolbarVAlign=(""+chartAttrs.toolbarvalign).toLowerCase()==="bottom"?"b":config.toolbarPosition.charAt(0);config.link=chartAttrs.clickurl;chart.addToEnv("linkClickFN",(0,_lib.getLinkAction)(chart.getFromEnv("dataSource"),chart));chart.addToEnv("chartConfig",config);chart.addToEnv("tooltipStyle",{container:getStyleDef(tooltipStyle.container),text:getStyleDef(tooltipStyle.text),header:getStyleDef(tooltipStyle.header),body:getStyleDef(tooltipStyle.body)});chart.addToEnv("style",{outCancolor:defaultTextStyle.fill,fontSize:defaultTextStyle["font-size"],outCanfontFamily:defaultTextStyle["font-family"]});chart.createBaseComponent();chart.getFromEnv("animationManager").setAnimationState(chart._firstConfigure?"initial":"update");config.prediction=parsePrediction(dataSource,getStyleDef);chart.addToEnv("prediction",config.prediction);chart.configureChildren();chart.setTooltipStyle()};_proto._createLegendMap=function _createLegendMap(preserveVisibilityState){if(preserveVisibilityState===void 0){preserveVisibilityState=false}var chart=this,config=chart.config,legendMap=config.legendMap={},legendConf=chart.getFromEnv("dataSource").legend,uniqueItems={},prevLegendMap=chart.getFromEnv("legendMap"),legend=chart.getChildren("legend")&&chart.getChildren("legend")[0],createLegend=function createLegend(info){if(info===void 0){info={}}for(var key in info){if(info.hasOwnProperty(key)){var itemInfo=info[key];if(itemInfo.hasOwnProperty("visibility")){chart._addLegend(itemInfo)}else{createLegend(itemInfo)}}}};config.pixelMultiplier=1;config.focusAxesY.forEach((function(_ref9){var plot=_ref9.plot;var count=0,colItemsArr;plot.forEach((function(_ref10){var stack=_ref10.stack,group=_ref10.group,value=_ref10.value,type=_ref10.type,name=_ref10.name;var isColumn=type==="column";if(isColumn){colItemsArr=group?config.dataTable.unique(group):new Array(1);count+=colItemsArr.length}if(stack){uniqueItems[stack]=config.dataTable.unique(stack);config.hasSeries=true}else if(group){uniqueItems[group]=isColumn?colItemsArr:config.dataTable.unique(group);config.hasSeries=true}else if(type==="column-range"||type==="area-range"){if(name){uniqueItems[name]=[name]}}else if(type!=="ohlc"&&type!=="candlestick"){uniqueItems[value]=[value]}}));config.pixelMultiplier=Math.max(count,config.pixelMultiplier)}));for(var key in uniqueItems){if(uniqueItems.hasOwnProperty(key)){var uniqueArr=uniqueItems[key];uniqueArr.forEach((function(name){if(!legendMap[name]){var obj=config.showLegend&&legendConf&&legendConf.item&&Array.isArray(legendConf.item)&&legendConf.item.find((function(o){return o.value===name})),hidden=(0,_lib.pluckNumber)(obj&&obj.initiallyhidden,0);legendMap[name]={visibility:!hidden,initiallyhidden:!!hidden,series:name}}}))}}chart.addToEnv("legendMap",legendMap);if(prevLegendMap){var newLegendMap=legendMap,reuseLegend=function reuseLegend(oldObj,newObj){for(var _key2 in oldObj){if(oldObj.hasOwnProperty(_key2)){var newItem=newObj&&newObj[_key2],oldItem=oldObj[_key2];if(oldItem.hasOwnProperty("visibility")){if(newItem){if(!preserveVisibilityState){if(!oldItem.visibility){legend&&legend.getItem(oldItem.legendItemId).removeLegendState("hidden");oldItem.visibility=true}if(!newItem.initiallyhidden){legend&&legend.getItem(oldItem.legendItemId).removeLegendState("hidden");oldItem.visibility=true;oldItem.initiallyhidden=false}else if(newItem.initiallyhidden){legend&&legend.getItem(oldItem.legendItemId).setLegendState("hidden");oldItem.visibility=false;oldItem.initiallyhidden=true}}newObj[_key2]=oldItem}else{legend&&legend.disposeItem(oldItem.legendItemId)}}else{reuseLegend(oldItem,newItem)}}}};reuseLegend(prevLegendMap,newLegendMap)}if(legend){createLegend(chart.getFromEnv("legendMap"));legend.asyncDraw()}};_proto._updateAffectedVisuals=function _updateAffectedVisuals(configs){if(configs===void 0){configs={}}var chart=this,config=chart.config,childs=chart.getChildren();Object.keys(config.canvasAxisMap).forEach((function(key){return childs[key].forEach((function(canvas){return!canvas.getState("removed")&&canvas.setData(configs,true)}))}));childs.timeNavigator&&childs.timeNavigator.forEach((function(navi){if(!navi.getState("removed")){navi.setData(configs,true);navi.setDimension()}}));chart.manageSpace()};_proto._addLegend=function _addLegend(info){var chart=this,fillColor,config,legendItem,chartConfig=chart.config,mergedLegendStyle=chartConfig.mergedLegendStyle,series=info.series,itemConfig,color=chart.getFromEnv("ordinalScale").getRangeValue(series),legend=chart.getFromEnv("legend"),strokeColor=(0,_lib.getLightColor)(color,60).replace(dropHash,_lib.HASHSTRING);if(chartConfig.showLegend){fillColor={FCcolor:{color:color,angle:0,ratio:"0",alpha:"100"}};legendItem=legend.getItem(info.legendItemId);config={label:series,eventArguments:{datasetName:series,visible:info.visibility}};if(!legendItem){info.legendItemId=legend.createItem();legendItem=legend.getItem(info.legendItemId);if(info.initiallyhidden){info.visibility=false;legendItem.config.eventArguments.visible=false;legendItem.setLegendState("hidden")}chart.addExtEventListener("fc-click",(function(){var visibility=info.visibility;itemConfig=legendItem.config;if(visibility){info.visibility=false;itemConfig.eventArguments.visible=false;legendItem.setLegendState("hidden")}else{info.visibility=true;itemConfig.eventArguments.visible=true;legendItem.removeLegendState("hidden")}chart._updateAffectedVisuals({legendInteracted:true})}),legendItem)}legendItem.configure(config);legendItem.setStateCosmetics("default",{symbol:{fill:(0,_lib.toRaphaelColor)(fillColor),rawFillColor:color,stroke:(0,_lib.toRaphaelColor)(strokeColor)},text:Object.assign({},mergedLegendStyle,{fill:(0,_lib.convertColor)(mergedLegendStyle.fill,mergedLegendStyle.opacity*mergedLegendStyle["fill-opacity"]*100)})})}};_proto._createGroup=function _createGroup(attr,container){if(attr===void 0){attr={}}var animationManager=this.getFromEnv("animationManager");return animationManager.setAnimation({attr:attr,container:container,el:"group",component:this,label:"group"})};_proto._createLayers=function _createLayers(){var animationManager=this.getFromEnv("animationManager");var parentGroup=this.getContainer("parentgroup"),exo;!parentGroup&&(parentGroup=this.addContainer("parentgroup",animationManager.setAnimation({el:parentGroup||"group",attr:{name:"parentgroup"},component:this})));if(!this.getChildContainer("tropo")){this.addChildContainer("tropo",this._createGroup({name:"chart-tropo"},parentGroup))}if(!this.getChildContainer("strato")){this.addChildContainer("strato",this._createGroup({name:"chart-strato"},parentGroup))}if(!this.getChildContainer("meso")){this.addChildContainer("meso",this._createGroup({name:"chart-meso"},parentGroup))}if(!this.getChildContainer("thermo")){this.addChildContainer("thermo",this._createGroup({name:"chart-thermo"},parentGroup))}if(!this.getChildContainer("exo")){exo=this.addChildContainer("exo",this._createGroup({name:"chart-exo"},parentGroup))}if(!this.getChildContainer("toolbar-master")){this.addChildContainer("toolbar-master",this._createGroup({name:"toolbar-master"},exo))}if(!this.getChildContainer("legendGroup")){this.addChildContainer("legendGroup",this._createGroup({name:"legend-group"},exo))}};_proto.checkValidLegendPosition=function checkValidLegendPosition(){var chart=this,dataSource=chart.getFromEnv("dataSource"),legendConf=dataSource.legend,legendPosition=legendConf.position?legendConf.position.toLowerCase():"",legendAlignment=legendConf.alignment?legendConf.alignment.toLowerCase():"";if(!legendPosition){if(legendAlignment===_lib.POSITION_START||legendAlignment===_lib.POSITION_MIDDLE||legendAlignment===_lib.POSITION_END){return true}}else if(legendPosition===_lib.POSITION_TOP||legendPosition===_lib.POSITION_BOTTOM||legendPosition===_lib.POSITION_LEFT||legendPosition===_lib.POSITION_RIGHT){if(!legendAlignment){return true}else if(legendAlignment===_lib.POSITION_START||legendAlignment===_lib.POSITION_MIDDLE||legendAlignment===_lib.POSITION_END){return true}}return false};_proto.manageSpace=function manageSpace(){var chart=this,config=chart.config,focusPanels=config.focusPanels,canvasAxisMap=config.canvasAxisMap,xScales=chart.getFromEnv("focusScalesX"),caption=chart.getChildren("caption"),selectorToolBar=chart.getFromEnv("selectorToolbar"),menubar=chart.getFromEnv("toolbar"),menuSpace=menubar.getLogicalSpace(),legend=chart.getChildren("legend")&&chart.getChildren("legend")[0],background=chart.getChildren("background")[0],firstCanvas=chart.getChildren("canvas_0"),timeNavigators=chart.getChildren("timeNavigator"),dataSource=chart.getFromEnv("dataSource"),legendConf=dataSource.legend,totalWidth,totalHeight,availableHeight,userNavHeight=config.navigatorHeight,timeNavScrollbarAndLabelHeight,totalTimeNavHeight=0,availableWidth,intermediateCanvasHeight,maxVAxisWidth={left:0,right:0},left=0,top=0,right=totalWidth=+chart.getFromEnv("chartWidth"),bottom=totalHeight=+chart.getFromEnv("chartHeight"),captionDim,leftAxesMaxWidth=0,rightAxesMaxWidth=0,marginHorizontal=.03*totalWidth,marginVertical=16,axisHeight=0,heightTaken,yAxesDimensions,xAxesDimensions,intermediateTimeNavSelectionHeight,actualTimeNavSelectionHeight,timeNavHeight,brush,legendHeight,legendWidth,mid,legendPosition=_lib.POSITION_BOTTOM,legendAlignment=_lib.POSITION_START,legendX,legendY,validLegendPosition,toolHeight,capHeight,canvasBorder={topBorder:0,bottomBorder:0,leftBorder:0,rightBorder:0},captionWidth,heightProportion=config.canvasHeightProportion,interCanvasSpace=config.interCanvasSpace,watermarkSpace=marginVertical>37?0:37-marginVertical;top+=(0,_lib.pluckNumber)(config.marginTop,marginVertical);bottom-=(0,_lib.pluckNumber)(config.marginBottom,marginVertical+watermarkSpace);left+=(0,_lib.pluckNumber)(config.marginLeft,marginHorizontal);right-=(0,_lib.pluckNumber)(config.marginRight,marginHorizontal);background.setDimension({height:totalHeight,width:totalWidth});background.setTranslation(0,0);focusPanels.forEach((function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],yIds=canvasInfo.y,yAxisWidth=DEFAULT_AXIS_HEIGHT_RATIO*(right-left)/(yIds.length||1),setYAxisDim=function setYAxisDim(axisId){var index=getIndex(axisId),dim=chart.getChildren(axisId)[0].setDimension({width:yAxisWidth});return panelInfo.y[index].overlap?{}:dim};yAxesDimensions=yIds.map(setYAxisDim);yAxesDimensions.forEach((function(dim){if(typeof dim.left==="number"){maxVAxisWidth.left=Math.max(maxVAxisWidth.left,dim.left)}else{maxVAxisWidth.right=Math.max(maxVAxisWidth.right,dim.right)}}))}));focusPanels.forEach((function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],yIds=canvasInfo.y,axesLeftWidth=0,axesRightWidth=0,axis,dim,align;yIds.forEach((function(axisId){axis=chart.getChildren(axisId)[0];align=axis.getAlignment();dim=axis.updateMaxLabelSpace(maxVAxisWidth[align]);axesLeftWidth+=(0,_lib.pluckNumber)(dim.left,0);axesRightWidth+=(0,_lib.pluckNumber)(dim.right,0)}));leftAxesMaxWidth=(0,_safeMax.default)([leftAxesMaxWidth,axesLeftWidth]);rightAxesMaxWidth=(0,_safeMax.default)([rightAxesMaxWidth,axesRightWidth])}));focusPanels.forEach((function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],xIds=canvasInfo.x,xAxisHeight=DEFAULT_AXIS_HEIGHT_RATIO*(bottom-top)/(xIds.length||1),setXAxisDim=function setXAxisDim(axisId){var index=getIndex(axisId),dim=chart.getChildren(axisId)[0].setDimension({height:xAxisHeight});return panelInfo.x[index].overlap?{}:dim};xAxesDimensions=xIds.map(setXAxisDim);xAxesDimensions.forEach((function(dim){axisHeight+=(0,_lib.pluckNumber)(dim.top,dim.bottom,0)}))}));availableHeight=bottom-top;availableWidth=Math.max(0,right-left);if(legendConf&&(legendConf.position||legendConf.alignment)){validLegendPosition=this.checkValidLegendPosition()}if(validLegendPosition){legendPosition=legendConf.position?legendConf.position.toLowerCase():_lib.POSITION_BOTTOM;legendAlignment=legendConf.alignment?legendConf.alignment.toLowerCase():_lib.POSITION_START}if(legend&&(legendPosition===_lib.POSITION_LEFT||legendPosition===_lib.POSITION_RIGHT)){legend.config.numColumns=1;legendWidth=Math.max(0,legend.setDimension({height:"auto",width:availableWidth}).width);legendHeight=legend.config.height;if(legendPosition===_lib.POSITION_LEFT){legendX=left;if(leftAxesMaxWidth>0){left+=legendWidth}else{left+=legendWidth+(0,_lib.pluckNumber)(config.marginLeft,marginHorizontal)}}else if(legendPosition===_lib.POSITION_RIGHT){if(rightAxesMaxWidth>0){right-=legendWidth;legendX=right}else{right-=legendWidth+(0,_lib.pluckNumber)(config.marginRight,marginHorizontal);legendX=right+(0,_lib.pluckNumber)(config.marginRight,marginHorizontal)}}}left+=leftAxesMaxWidth;right-=rightAxesMaxWidth;if(menuSpace.height){menubar.setDimension({x:right-menuSpace.width,y:top});menubar.manageSpace()}if(caption[0].config.captionAlignment==="right"||caption[0].config.subCaptionAlignment==="right"){top+=menuSpace.height;captionWidth=right-left}else{captionWidth=right-left-menuSpace.width}if(caption&&caption.length){captionDim=caption[0].setDimension({width:captionWidth,height:DEFAULT_CAPTION_HEIGHT_RATIO*availableHeight});caption[0].setTranslation(left,top);capHeight=Math.max(captionDim.height,menuSpace.height)}else{capHeight=menuSpace.height}top+=capHeight;availableWidth=Math.max(0,right-left);if(legend&&(legendPosition===_lib.POSITION_TOP||(legendPosition===_lib.POSITION_RIGHT||legendPosition===_lib.POSITION_LEFT)&&legendAlignment===_lib.POSITION_START)){legend.setDimension({height:"auto",width:availableWidth});legendWidth=legend.config.width;legendHeight=legend.config.height;legendY=top;if(legendPosition===_lib.POSITION_TOP){top+=legendHeight}}if(legend&&legendPosition===_lib.POSITION_BOTTOM){legend.setDimension({height:availableHeight*DEFAULT_LEGEND_RATIO,width:availableWidth});legendWidth=legend.config.width;legendHeight=legend.config.height}toolHeight=selectorToolBar.getLogicalSpace().height;selectorToolBar.setDimension({x:left,y:top,width:availableWidth});selectorToolBar.manageSpace();top+=toolHeight;heightTaken=axisHeight+(focusPanels.length-1)*interCanvasSpace;availableHeight=Math.max(0,bottom-top-heightTaken);if(legend){legendHeight=legendHeight||Math.max(0,legend.setDimension({height:availableHeight*DEFAULT_LEGEND_RATIO,width:availableWidth}).height);legendWidth=legendWidth||legend.config.width;if(legendPosition===_lib.POSITION_TOP){if(legendAlignment===_lib.POSITION_END){legend.setTranslation(right-legendWidth+LEGEND_ALIGNMENT,legendY)}else if(legendAlignment===_lib.POSITION_MIDDLE){mid=(left+right-legendWidth)/2;legend.setTranslation(mid,legendY)}else{legend.setTranslation(left-LEGEND_ALIGNMENT,legendY)}}else if(legendPosition===_lib.POSITION_RIGHT||legendPosition===_lib.POSITION_LEFT){if(legendAlignment===_lib.POSITION_END){bottom-=legendHeight;legend.setTranslation(legendX,bottom);bottom+=legendHeight}else if(legendAlignment===_lib.POSITION_MIDDLE){mid=(top+bottom-legendHeight)/2;legend.setTranslation(legendX,mid)}else{legend.setTranslation(legendX,legendY)}}else{bottom-=legendHeight;availableHeight-=legendHeight;if(legendAlignment===_lib.POSITION_END){legend.setTranslation(right-legendWidth+LEGEND_ALIGNMENT,bottom)}else if(legendAlignment===_lib.POSITION_MIDDLE){mid=(left+right-legendWidth)/2;legend.setTranslation(mid,bottom)}else{legend.setTranslation(left-LEGEND_ALIGNMENT,bottom)}}}if(timeNavigators&&timeNavigators.length){intermediateCanvasHeight=(1-DEFAULT_TIMENAV_HEIGHT_RATIO)*availableHeight/(focusPanels.length||1);intermediateTimeNavSelectionHeight=DEFAULT_TIMENAV_HEIGHT_RATIO*availableHeight/(timeNavigators.length||1);timeNavigators.forEach((function(timeNavigator,index){timeNavigator.config.formatter=_timeConverter.default.formatter(dataSource.navigator&&dataSource.navigator.outputtimeformat?(0,_lib.pluck)(dataSource.navigator.outputtimeformat):timeNavigator.config.formatter);if(timeNavigator.getState("removed"))return;brush=timeNavigator.getChildren("brush")[0];timeNavScrollbarAndLabelHeight=brush.getLabelSpace()+timeNavigator.config.scrollbarHeight;actualTimeNavSelectionHeight=userNavHeight?Math.min(Math.max(userNavHeight,44),84):Math.min(Math.max(Math.min(intermediateTimeNavSelectionHeight,.8*intermediateCanvasHeight),48),60);timeNavHeight=actualTimeNavSelectionHeight+timeNavScrollbarAndLabelHeight;timeNavigator.setDimension({width:availableWidth,height:timeNavHeight});timeNavigator.setTranslation(left,bottom-(timeNavigators.length-index)*timeNavHeight);totalTimeNavHeight+=timeNavHeight}));if(totalTimeNavHeight>availableHeight){timeNavigators.forEach((function(nav){return nav.setDimension({width:0,height:0})}))}else{availableHeight-=totalTimeNavHeight}}if(firstCanvas&&firstCanvas[0]){canvasBorder=firstCanvas[0].getCanvasBorder()}xScales.forEach((function(scale){return scale.setRange([canvasBorder.leftBorder,availableWidth-(canvasBorder.leftBorder+canvasBorder.rightBorder)/2])}));focusPanels.forEach((function(panelConfig,index){var canvasId="canvas_"+index,_canvasAxisMap$canvas=canvasAxisMap[canvasId],xIds=_canvasAxisMap$canvas.x,yIds=_canvasAxisMap$canvas.y,x=panelConfig.x,y=panelConfig.y,tempLeft=left,tempRight=left+availableWidth,canvas=chart.getChildren(canvasId)[0],tempTop=top+canvasBorder.topBorder,tempBottom=tempTop+availableHeight/heightProportion.totalProportions*heightProportion.proportions[index],overlappedXAxis=[];y.forEach((function(yValue,i){yValue.scale.setRange([availableHeight/heightProportion.totalProportions*heightProportion.proportions[index]-canvasBorder.bottomBorder-CANVAS_TOP_PADDING,canvasBorder.topBorder])}));if(canvas.getState("removed"))return;canvasBorder=canvas.getCanvasBorder();canvas.setPadding({top:CANVAS_TOP_PADDING});canvas.setDimension({width:availableWidth,height:availableHeight/heightProportion.totalProportions*heightProportion.proportions[index]});xIds.forEach((function(id){var axisInfo=x[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.overlap){overlappedXAxis.push(id);return}if(axisInfo.align==="top"){axis.setTranslation(left+canvasBorder.leftBorder,tempTop);tempTop+=dim.top}else if(axisInfo.align==="bottom"){axis.setTranslation(left+canvasBorder.leftBorder,tempBottom);tempBottom+=dim.bottom}}));canvas.setTranslation(left,tempTop);overlappedXAxis.forEach((function(id){var axisInfo=x[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.align==="top"){axis.setTranslation(left+canvasBorder.leftBorder,tempTop)}else if(axisInfo.align==="bottom"){axis.setTranslation(left+canvasBorder.leftBorder,tempTop+availableHeight/heightProportion.totalProportions*heightProportion.proportions[index]-dim.bottom)}}));yIds.forEach((function(id){var axisTop=tempTop+CANVAS_TOP_PADDING;var axisInfo=y[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.overlap){if(axisInfo.align==="left"){axis.setTranslation(left,axisTop)}else if(axisInfo.align==="right"){axis.setTranslation(left+availableWidth-dim.right,axisTop)}}else{if(axisInfo.align==="left"){tempLeft-=dim.left;axis.setTranslation(tempLeft,axisTop)}else if(axisInfo.align==="right"){axis.setTranslation(tempRight,axisTop);tempRight+=dim.right}}}));top=tempBottom+interCanvasSpace}))};_proto._setDataLabelStyle=function _setDataLabelStyle(){return this};_proto._checkInvalidData=function _checkInvalidData(){var dataObj=this.getFromEnv("dataSource"),chartInstance=this.getFromEnv("chartInstance");if(!dataObj.data){chartInstance.__state.dataReady=false;chartInstance.jsVars.hasNativeMessage=true;chartInstance.jsVars.drawCount+=1;return true}return false};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){var dataObj=this.getFromEnv("dataSource");if(dataObj.data&&typeof dataObj.data.getData==="function"){var _dataObj$data$getData2=dataObj.data.getData(),schema=_dataObj$data$getData2.schema;if(!Array.isArray(schema)||!schema.filter((function(obj){return obj.type==="date"})).length||!schema.filter((function(obj){return obj.type==="number"})).length){return true}return false}return true};_proto.setYScaleLimit=function setYScaleLimit(scaleId,dsId,limit,baseRequired){if(baseRequired===void 0){baseRequired=true}var chart=this,config=chart.config,scaleDsMap=config.scaleDsMap,scaleMap=scaleDsMap[scaleId],dsInfo,dataMin,dataMax,visibilityLimit={start:_lib.UNDEF,end:_lib.UNDEF},isBaseRequired,findFn=function findFn(_ref11){var scale=_ref11.scale;return scale&&scale.getId()===scaleId},focusY=config.focusAxesY.find(findFn),contextY=config.contextAxesY.find(findFn),y=focusY||contextY,scale=y&&y.scale;if(!scale)return;if(!scaleMap){scaleMap=scaleDsMap[scaleId]={}}if(!(dsInfo=scaleMap[dsId])){dsInfo=scaleMap[dsId]={}}dsInfo.limit=limit;dsInfo.baseRequired=baseRequired;for(var key in scaleMap){if(scaleMap.hasOwnProperty(key)){var dsInf=scaleMap[key];var _extent=(0,_extent3.default)([dataMin,dataMax].concat(dsInf.limit));dataMin=_extent[0];dataMax=_extent[1];isBaseRequired=isBaseRequired||dsInf.baseRequired}}if(scale.getType()==="log"){scale.setDomain(getLogMinMax(dataMin,dataMax,y.min,y.max,y.base,isBaseRequired))}else{scale.setDomain(getLinearMinMax(dataMin,dataMax,y.min,y.max,isBaseRequired))}if((0,_lib.defined)(dataMin)){visibilityLimit.start=-Infinity;visibilityLimit.end=Infinity}if(focusY){config.focusPanels.forEach((function(panelInfo,i){var canvasId="canvas_"+i,yInf=config.canvasAxisMap[canvasId],yIds=yInf&&yInf.y;if(!yIds)return;yIds.forEach((function(id){var axes=chart.getChildren(id);axes.forEach((function(axis){if(axis.getScale()===scale){axis.setTickVisibilityLimit(visibilityLimit);axis.placeAxis();axis.asyncDraw()}}))}))}))}};_proto.setXScaleLimit=function setXScaleLimit(scaleId,dsId,limit){var chart=this,config=chart.config,scaleDsMap=config.scaleDsMap,scaleMap=scaleDsMap[scaleId],dsInfo,dataMin,dataMax,min,isUTC=chart.getFromEnv("UTC"),timeIntervals=isUTC?utcStandardTimeIntervals:standardTimeIntervals,max,visibilityLimit={start:config.rawDataXStart,end:Infinity},_chart$getContextLimi=chart.getContextLimit(),tMin=_chart$getContextLimi[0],tMax=_chart$getContextLimi[1],findFn=function findFn(_ref12){var scale=_ref12.scale;return scale&&scale.getId()===scaleId},focusX=config.focusAxesX.find(findFn),contextX=config.contextAxesX.find(findFn),x=focusX||contextX,binDecider=this.getFromEnv("contextBins")[0],atomicity=binDecider.getBinMin()[2],rangeThreshold=binDecider.getRangeThreshold(),timeIntervalName=rangeThreshold[0]._name,scale=x&&x.scale;if(!scale)return;if(!scaleMap){scaleMap=scaleDsMap[scaleId]={}}if(!(dsInfo=scaleMap[dsId])){dsInfo=scaleMap[dsId]={}}dsInfo.limit=limit;for(var key in scaleMap){if(scaleMap.hasOwnProperty(key)){var dsInf=scaleMap[key];var _extent2=(0,_extent3.default)([dataMin,dataMax].concat(dsInf.limit));dataMin=_extent2[0];dataMax=_extent2[1]}}if((0,_lib.defined)(dataMin)){visibilityLimit.start=Math.min(dataMin,config.rawDataXStart);visibilityLimit.end=Infinity}if(focusX){var _chart$getFocusLimit2=chart.getFocusLimit();min=_chart$getFocusLimit2[0];max=_chart$getFocusLimit2[1];if(+min===tMin&&(0,_isValidNumber.default)(dataMin)){min=Math.min(min,dataMin)}if(+max===tMax&&(0,_isValidNumber.default)(dataMax)){max=Math.max(max,dataMax)}if(Math.ceil((max-min)/rangeThreshold[2])<3&&atomicity===rangeThreshold[2]){min=+timeIntervals[timeIntervalName].offset(max,-3*rangeThreshold[1])}scale.setDomain([min,max]);config.focusPanels.forEach((function(panelInfo,i){var canvasId="canvas_"+i,canvases=chart.getChildren(canvasId),canvas=canvases&&canvases[0],xInf=config.canvasAxisMap[canvasId],xIds=xInf&&xInf.x;if(!xIds||!canvas)return;canvas.asyncDraw();xIds.forEach((function(id){chart.getChildren(id).forEach((function(axis){if(axis.getScale()===scale){axis.setTickVisibilityLimit(visibilityLimit);axis.placeAxis();axis.asyncDraw()}}))}))}))}else{min=(0,_isValidNumber.default)(dataMin)?Math.min(tMin,dataMin):tMin;max=(0,_isValidNumber.default)(dataMax)?Math.max(tMax,dataMax):tMax;if(Math.ceil((max-min)/rangeThreshold[2])<3&&atomicity===rangeThreshold[2]){min=+timeIntervals[timeIntervalName].offset(max,-3*rangeThreshold[1])}scale.setDomain([min,max]);chart.getChildren("timeNavigator")&&chart.getChildren("timeNavigator").forEach((function(navi){if(!navi.getState("removed")){var axis=navi.getChildren("timeAxis")&&navi.getChildren("timeAxis")[0];if(!axis.getState("removed")){axis.setTickVisibilityLimit(visibilityLimit);axis.placeAxis();axis.asyncDraw()}}}))}};_proto.setFocusLimit=function setFocusLimit(limit,validateDomain){if(limit===void 0){limit=[]}if(validateDomain===void 0){validateDomain=true}var chart=this,config=chart.config,dataLimit=validateDomain?this.domainValidator(limit,this.getContextLimit(),config.focusLimit):limit,focusAxis=config.focusAxesX[0],focusBin=this.getFromEnv("focusBins")[0],focusScale=this.getFromEnv("focusScalesX")[0],focusLimit=chart.getFocusLimit(),currentBin=focusBin.getRangeThreshold();config.focusLimit=dataLimit;chart.fireChartInstanceEvent("selectionChange",{start:+dataLimit[0],end:+dataLimit[1],binUnit:currentBin[0].name(),binMuliplier:currentBin[1]});if((0,_equals.default)(dataLimit,focusLimit)){return false}focusBin.setBinDomain(dataLimit);var threshold=focusBin.getRangeThreshold();focusScale.setRangeThreshold(threshold);chart.fireEvent("focusLimitChanged");if(focusAxis.filterInfo&&focusAxis.filterInfo.query){focusAxis.filterInfo.query._updateArgs(+threshold[0].offset(+dataLimit[0],-2*threshold[1]),+threshold[0].offset(+dataLimit[1],2*threshold[1]));focusAxis.filterInfo.table.flushResults();chart.updateVerticalAxesWidth()}if(focusLimit!==_lib.UNDEF){chart._updateAffectedVisuals({legendInteracted:null})}return true};_proto.updateVerticalAxesWidth=function updateVerticalAxesWidth(){var chart=this,canvasAxisMap=chart.config.canvasAxisMap,canvasAxisMapAr=Object.keys(canvasAxisMap),canvas,maxVAxesWidth={left:0,right:0},axisDim,axes;canvasAxisMapAr.forEach((function(canvasId){canvas=canvasAxisMap[canvasId];canvas.y.forEach((function(yId){axes=chart.getChildren(yId);axes.forEach((function(axis){axisDim=axis.getDimension();if(typeof axisDim.left==="number"){maxVAxesWidth.left=Math.max(maxVAxesWidth.left,axisDim.left)}else if(typeof axisDim.right==="number"){maxVAxesWidth.right=Math.max(maxVAxesWidth.right,axisDim.right)}}))}))}));canvasAxisMapAr.forEach((function(canvasId){canvas=canvasAxisMap[canvasId];canvas.y.forEach((function(yId){axes=chart.getChildren(yId);axes.forEach((function(axis){axis.updateMaxLabelSpace(maxVAxesWidth[axis.getAlignment()])}))}))}))};_proto.getFocusLimit=function getFocusLimit(){var focusLimit=this.config.focusLimit;return focusLimit&&focusLimit.slice()};_proto.setContextLimit=function setContextLimit(limit){if(limit===void 0){limit=[]}var config=this.config,contextScalesX=this.getFromEnv("contextScalesX")[0];var contextBins=this.getFromEnv("contextBins");if((0,_equals.default)(limit,this.getContextLimit())){return}config.contextLimit=limit.slice();contextBins[0].setBinDomain(limit);contextScalesX.setRangeThreshold(contextBins[0].getRangeThreshold());!config.navigatorEnabled&&contextScalesX.setDomain(config.contextLimit);this.fireEvent("contextLimitChanged")};_proto.getContextLimit=function getContextLimit(){return(this.config.contextLimit||[]).slice()};return TimeSeries}(_commonchartapi.default);var _default=TimeSeries;exports.default=_default;