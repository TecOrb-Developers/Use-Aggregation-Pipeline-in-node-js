"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _core=_interopRequireDefault(require("../../../../fusioncharts/core"));var _index=_interopRequireDefault(require("./index"));var _marimekko=_interopRequireDefault(require("../../../../../smoke-test/test-sanity/marimekko.sanity"));var _ignoreCaseExt=_interopRequireDefault(require("../../../../fc-features/src/ignore-case-ext"));var _utility=require("../../../../../smoke-test/test-sanity/utility");var _lib=require("../../../../fc-core/src/lib/");var _common=_interopRequireDefault(require("../../../../../smoke-test/test-sanity/common.sanity"));var chartData=_interopRequireWildcard(require("../../../../../smoke-test/test-data/data-by-chart"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}_core.default.addDep(_index.default);_core.default.addDep(_ignoreCaseExt.default);var svgElement,chartName=_index.default.getName(),chartID=chartName.toLowerCase(),doc=window.document;describe("Running common chart tests for "+chartName,(function(){var chart={type:chartID,renderAt:_utility.CONTAINER_ID,width:_utility.initDimensions.width,height:_utility.initDimensions.height,dataFormat:"json",dataSource:{}},config={chartID:chartID,chart:chart,document:doc,chartWrapperId:_utility.CONTAINER_ID};_common.default.forEach((function(test){var itArr;if(test.name&&test.run){it(test.name,(function(done){test.run(config,(function(result){expect(result).toBe(true);done()}))}))}else if(test.iterator){itArr=test.iterator(chart);itArr.forEach((function(subTest){it(subTest.name,(function(done){subTest.run(config,(function(result){expect(result).toBe(true);done()}))}))}))}}))}));describe("Chart basic testing: "+chartName,(function(){var chart,chartObj,itResize,renderData=_marimekko.default.BASIC.newChart,updateData=_marimekko.default.BASIC.updateChart;chart={type:chartID,renderAt:_utility.CONTAINER_ID};(0,_lib.extend2)(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));it("Rendered chart validation passes",(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=_marimekko.default.BASIC.validate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.render();chartObj.addEventListener("renderComplete",renderComplete)}));it("Chart update passes",(function(done){expect(chartObj).toBeDefined();var called=0;var renderComplete=function renderComplete(){if(called===0){called++;chartObj.setChartData(updateData||chart.dataSource,"json")}else if(called===1){var response=_marimekko.default.BASIC.updateValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}));itResize=function itResize(resizeDimensions){it("Chart resize passes for "+resizeDimensions.width+" x "+resizeDimensions.height,(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=_marimekko.default.BASIC.resizeValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render((function(){chartObj.resizeTo(resizeDimensions.width,resizeDimensions.height)}))}))};for(var index=0;index<_utility.resizeDimensions.length;index++){itResize(_utility.resizeDimensions[index])}}));describe("Chart EI testing: "+_index.default.getName(),(function(){var chart,chartObj,eiMethods,renderData=_marimekko.default.EI.newChart;chart={type:chartID,renderAt:_utility.CONTAINER_ID};(0,_lib.extend2)(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));eiMethods=function eiMethods(methodObj){it(methodObj.name,(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){svgElement=(0,_utility.getSVG)(chartObj);methodObj.fn(svgElement,chartObj,(function(result){expect(result).toBe(true);done()}))};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}))};for(var key in _marimekko.default.EI.methods){if(_marimekko.default.EI.methods.hasOwnProperty(key)){eiMethods(_marimekko.default.EI.methods[key])}}}));describe("marimekko minPLotHeightForValue testing",(function(){var chartObj,renderInfo={type:"marimekko",renderAt:_utility.CONTAINER_ID,width:"600",height:"350",dataFormat:"json"},data={chart:{caption:"Business Results 2005 v 2006",xaxisname:"Month",yaxisname:"Revenue",showvalues:"1",numberprefix:"$",animation:"1"},categories:[{category:[{label:"Jan"},{label:"Feb"},{label:"Mar"},{label:"Apr"},{vline:"true"},{label:"May"},{label:"Jun"},{label:"Jul"},{label:"Aug"},{label:"Sep"},{label:"Oct"},{label:"Nov"},{label:"Dec"}]}],dataset:[{seriesname:"2006",data:[{showValue:"1",value:"27400"},{showValue:"0",value:"29800"},{minPlotHeightForValue:"20",value:"25800"},{minPlotHeightForValue:"2000",value:"26800"},{value:"29600"},{value:"32600"},{value:"31800"},{value:"36700"},{value:"29700"},{value:"31900"},{value:"34800"},{value:"24800"}]},{seriesname:"2005",data:[{value:"10000"},{value:"11500"},{value:"12500"},{value:"15000"},{value:"11000"},{value:"9800"},{value:"11800"},{value:"19700"},{value:"21700"},{value:"21900"},{value:"22900"},{value:"20800"}]}],trendlines:[{line:[{startvalue:"26000",color:"91C728",displayvalue:"Target",showontop:"1"}]}],styles:{definition:[{name:"CanvasAnim",type:"animation",param:"_xScale",start:"0",duration:"1"}],application:[{toobject:"Canvas",styles:"CanvasAnim"}]}};beforeEach((function(){renderInfo.dataSource=data;chartObj=(0,_utility.setup)(_core.default,renderInfo)}));afterEach((function(){chartObj&&!chartObj.disposed&&chartObj.dispose()}));it("chart dataplot will appear when plotLavel ShowValue is set one",(function(done){chartObj.addEventListener("renderComplete",(function(){var dataLabelObj=document.querySelectorAll('[class*="label-group fusioncharts-datalabels"]')[0].children[0];if(dataLabelObj.innerHTML==="$27.4K"){done()}}));chartObj.render()}));it("chart dataplot will not appear when plotLavel ShowValue is set zero",(function(done){chartObj.addEventListener("renderComplete",(function(){var dataLabelObj=document.querySelectorAll('[class*="label-group fusioncharts-datalabels"]')[0].children[1];if(dataLabelObj.innerHTML!=="$29.8K"){done()}}));chartObj.render()}));it("chart dataplot will appear when plotLavel ShowValue is not set, parent has showValue 1 and plot height is equal or more than minPlotHeightForValue",(function(done){chartObj.addEventListener("renderComplete",(function(){var dataLabelObj=document.querySelectorAll('[class*="label-group fusioncharts-datalabels"]')[0].children[1];if(dataLabelObj.innerHTML==="$25.8K"){done()}}));chartObj.render()}));it("chart dataplot will not appear when plotLavel ShowValue is not set, parent has showValue 1 and plot height is less than minPlotHeightForValue",(function(done){chartObj.addEventListener("renderComplete",(function(){var dataLabelObj=document.querySelectorAll('[class*="label-group fusioncharts-datalabels"]')[0].children[2];if(dataLabelObj.innerHTML!=="$26.8K"){done()}}));chartObj.render()}))}));describe("Text outline testing "+chartName,(function(){var chart,chartObj,itResize,renderData={chart:{showvalues:"1",animation:"1",textoutline:"1"},categories:[{category:[{label:"Desktop"},{label:"Laptop"},{label:"Notebook"}]}],dataset:[{seriesname:"C",data:[{value:"298000"},{value:"109300"},{value:"153600"}]}]},updateDataWithNoOutline={chart:{showvalues:"1",animation:"1"},categories:[{category:[{label:"Desktop"},{label:"Laptop"},{label:"Notebook"}]}],dataset:[{seriesname:"A",data:[{value:"335000"},{value:"225100"},{value:"164200"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"},{value:"120000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"},{value:"153600"}]}]};chart={type:chartID,renderAt:_utility.CONTAINER_ID,dataSource:renderData};beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));it("Text outline should get applied",(function(done){var renderComplete=function renderComplete(){var labelElement=document.querySelector('[class$="label-group fusioncharts-datalabels"]').getElementsByTagName("text")[0];expect(labelElement.getAttribute("filter")).not.toBe(null);done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}));it("Text outline should be removed",(function(done){var updateFlag=0,renderComplete=function renderComplete(){if(!updateFlag){updateFlag=1;chartObj.setJSONData(updateDataWithNoOutline)}else{var labelElement=document.querySelector('[class$="label-group fusioncharts-datalabels"]').getElementsByTagName("text")[0];expect(labelElement.getAttribute("filter")).toBe(null);done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}))}));describe("valueFontColor, valueBgColor, valueBorderColor",(function(){var chartObj;afterEach((function(){return chartObj.dispose()}));it("Without valueFontColor, valueBgColor and valueBorderColor, chart should render normally",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{showvalues:"1",caption:"Market Share Analysis",subcaption:"2009",numberprefix:"$",xaxisname:"Market Segment",yaxisname:"Market Share",legendcaption:"Manufacturer",animation:"0"},categories:[{category:[{label:"Desktop"},{label:"Laptop"}]}],dataset:[{seriesname:"A",data:[{value:"335000"},{value:"225100"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[2],rects=dataLabelGroup.getElementsByTagName("rect"),texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(0);expect(texts.length).toBe(2);expect(texts[0].getAttribute("fill")).toBe("#555555");expect(texts[1].getAttribute("fill")).toBe("#555555");done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor should work from dataset level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{showvalues:"1",caption:"Market Share Analysis",subcaption:"2009",numberprefix:"$",xaxisname:"Market Segment",yaxisname:"Market Share",legendcaption:"Manufacturer",animation:"0"},categories:[{category:[{label:"Desktop"},{label:"Laptop"}]}],dataset:[{seriesname:"A",valuefontcolor:"0000ff",valuebgcolor:"fff000",valuebordercolor:"ff0000",data:[{value:"335000"},{value:"225100"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[2],rects=dataLabelGroup.getElementsByTagName("rect"),texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);expect(rects[0].getAttribute("fill")).toBe("#fff000");expect(rects[0].getAttribute("stroke")).toBe("#ff0000");expect(rects[1].getAttribute("fill")).toBe("#fff000");expect(rects[1].getAttribute("stroke")).toBe("#ff0000");expect(texts[0].getAttribute("fill")).toBe("#0000ff");expect(texts[1].getAttribute("fill")).toBe("#0000ff");done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor should work from data level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{showvalues:"1",caption:"Market Share Analysis",subcaption:"2009",numberprefix:"$",xaxisname:"Market Segment",yaxisname:"Market Share",legendcaption:"Manufacturer",animation:"0"},categories:[{category:[{label:"Desktop"},{label:"Laptop"}]}],dataset:[{seriesname:"A",data:[{value:"335000",valuefontcolor:"0000ff",valuebgcolor:"fff000",valuebordercolor:"ff0000"},{value:"225100"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[2],rects=dataLabelGroup.getElementsByTagName("rect"),texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(1);expect(texts.length).toBe(2);expect(rects[0].getAttribute("fill")).toBe("#fff000");expect(rects[0].getAttribute("stroke")).toBe("#ff0000");expect(texts[0].getAttribute("fill")).toBe("#0000ff");expect(texts[1].getAttribute("fill")).toBe("#555555");done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor at data level should overwrite same attributes from dataset level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{showvalues:"1",caption:"Market Share Analysis",subcaption:"2009",numberprefix:"$",xaxisname:"Market Segment",yaxisname:"Market Share",legendcaption:"Manufacturer",animation:"0"},categories:[{category:[{label:"Desktop"},{label:"Laptop"}]}],dataset:[{seriesname:"A",valuefontcolor:"0000ff",valuebgcolor:"fff000",valuebordercolor:"ff0000",data:[{value:"335000",valuefontcolor:"ff0000",valuebgcolor:"ffffff",valuebordercolor:"000000"},{value:"225100"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[2],rects=dataLabelGroup.getElementsByTagName("rect"),texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);expect(rects[0].getAttribute("fill")).toBe("#ffffff");expect(rects[0].getAttribute("stroke")).toBe("#000000");expect(rects[1].getAttribute("fill")).toBe("#fff000");expect(rects[1].getAttribute("stroke")).toBe("#ff0000");expect(texts[0].getAttribute("fill")).toBe("#ff0000");expect(texts[1].getAttribute("fill")).toBe("#0000ff");done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor at data level should overwrite same attributes from dataset as well as chart level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{showvalues:"1",caption:"Market Share Analysis",subcaption:"2009",numberprefix:"$",xaxisname:"Market Segment",yaxisname:"Market Share",legendcaption:"Manufacturer",valuefontcolor:"00ff00",valuebgcolor:"0000ff",valuebordercolor:"fff000",animation:"0"},categories:[{category:[{label:"Desktop"},{label:"Laptop"}]}],dataset:[{seriesname:"A",valuefontcolor:"0000ff",valuebgcolor:"fff000",valuebordercolor:"ff0000",data:[{value:"335000",valuefontcolor:"ff0000",valuebgcolor:"ffffff",valuebordercolor:"000000"},{value:"225100"}]},{seriesname:"B",data:[{value:"215000"},{value:"198000"}]},{seriesname:"C",data:[{value:"298000"},{value:"109300"}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[2],rects=dataLabelGroup.getElementsByTagName("rect"),texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);expect(rects[0].getAttribute("fill")).toBe("#ffffff");expect(rects[0].getAttribute("stroke")).toBe("#000000");expect(rects[1].getAttribute("fill")).toBe("#fff000");expect(rects[1].getAttribute("stroke")).toBe("#ff0000");expect(texts[0].getAttribute("fill")).toBe("#ff0000");expect(texts[1].getAttribute("fill")).toBe("#0000ff");dataLabelGroup=document.querySelectorAll('[class$="fusioncharts-datalabels"]')[3];rects=dataLabelGroup.getElementsByTagName("rect");texts=dataLabelGroup.getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);expect(rects[0].getAttribute("fill")).toBe("#0000ff");expect(rects[0].getAttribute("stroke")).toBe("#fff000");expect(rects[1].getAttribute("fill")).toBe("#0000ff");expect(rects[1].getAttribute("stroke")).toBe("#fff000");expect(texts[0].getAttribute("fill")).toBe("#00ff00");expect(texts[1].getAttribute("fill")).toBe("#00ff00");done()}));chartObj.render()}))}));