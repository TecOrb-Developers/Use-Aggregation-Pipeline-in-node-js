"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.configurer=exports.default=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _dragbase=_interopRequireDefault(require("../_internal/dragbase"));var _dragnode=require("../../dataset/dragnode");var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _dragnodeDataset=_interopRequireDefault(require("../../factories/dragnode-dataset"));var _editableCharts=require("../_internal/editable-charts");var _xyAxis=_interopRequireDefault(require("@fusioncharts/charts/src/factories/xy-axis"));var _baseChart=require("@fusioncharts/core/src/base-chart");var DRAGNODE="dragnode";var configurer,UNDEF;exports.configurer=configurer;var DragNode=function(_DragBase){(0,_inheritsLoose2.default)(DragNode,_DragBase);DragNode.getName=function getName(){return"DragNode"};function DragNode(){var _this;_this=_DragBase.call(this)||this;var chart=(0,_assertThisInitialized2.default)(_this);chart.fireGroupEvent=true;chart.usesXYinCategory=true;chart.dontShowLegendByDefault=true;_this.registerFactory("dataset",_dragnodeDataset.default,["vCanvas"]);_this.registerFactory("axis",_xyAxis.default,["canvas"]);return _this}var _proto=DragNode.prototype;_proto.getName=function getName(){return"DragNode"};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){var datasetsJSON=this.getFromEnv("dataSource").dataset;if(!datasetsJSON){return true}};_proto._mouseEvtHandler=function _mouseEvtHandler(e,data){(0,_baseChart._mouseEvtHandler)(this,e,data)};_proto.parseChartAttr=function parseChartAttr(dataObj){var iapi=this,chartAttr=iapi.getFromEnv("dataSource").chart,config,transcoders=(0,_dependencyManager.getDepsByType)("transcoder");_DragBase.prototype.parseChartAttr.call(this,dataObj);config=iapi.config;config.formAction=(0,_lib.getValidValue)(chartAttr.formaction);config.showLegend=(0,_lib.pluckNumber)(chartAttr.showlegend,0);if(chartAttr.submitdataasxml===_lib.ZEROSTRING&&!chartAttr.formdataformat){chartAttr.formdataformat=transcoders.csv().format}config.formDataFormat=(0,_lib.pluck)(chartAttr.formdataformat,transcoders.xml().format);config.formTarget=(0,_lib.pluck)(chartAttr.formtarget,"_self");config.formMethod=(0,_lib.pluck)(chartAttr.formmethod,"POST");config.submitFormAsAjax=(0,_lib.pluckNumber)(chartAttr.submitformusingajax,1);config.viewMode=(0,_lib.pluckNumber)(chartAttr.viewmode,0);config.drawTrendRegion=0};_proto.__setDefaultConfig=function __setDefaultConfig(){_DragBase.prototype.__setDefaultConfig.call(this);var chartConf=this.config;chartConf.hasLegend=true;chartConf.defaultDatasetType=DRAGNODE;chartConf.limitUpdaterEnabled=false;chartConf.skipClipping=true;chartConf.numVDivLines=0;chartConf.numDivLines=0;chartConf.setadaptivexmin=1;chartConf.showLimits=0;chartConf.showdivlinevalues=0;chartConf.showzeroplane=0;chartConf.showyaxisvalues=0;chartConf.enablemousetracking=true;chartConf.showzeroplaneontop=0};_proto.addConfigureOptions=function addConfigureOptions(){var chart=this,chartConf=chart.config,restore,submit,toolbar=chart.getFromEnv("toolbar"),hamburgerMenu=toolbar.getChild("hamburgerMenu-"+toolbar.getId()+"-"+chart.getId()+"-0"),configureTools=[{name:"Add Node",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showNodeAddUI()},action:"click"},{name:"Add Connector",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showConnectorAddUI()},action:"click"},{name:"Add Label",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showLabelUpdateUI()},action:"click"}];if(chartConf.showRestoreBtn){restore={name:chartConf.restoreBtnTitle,handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.restoreData()},action:"click"};configureTools.push(restore)}if(chartConf.showFormBtn){submit={name:chartConf.submitBtnTitle,handler:function handler(){_editableCharts.submitData.call(chart)},action:"click"};configureTools.push(submit)}if(!chart.config.viewMode){hamburgerMenu.appendInMenu(configureTools)}};_proto.getDSdef=function getDSdef(dsType){switch(dsType){case"connector":return _dragnode.DragNodeConnector;case"dragnode":return _dragnode.DragNodeDataset;case"dragableLabels":return _dragnode.DragNodeLabels}};_proto.getDSGroupdef=function getDSGroupdef(){return _dragnode.DragNodeGroup};_proto._setCategories=function _setCategories(){var iapi=this,dataObj=iapi.getFromEnv("dataSource"),xAxis=iapi.getChildren("xAxis"),categories=dataObj.categories&&dataObj.categories[0].category||[],catLen=categories.length,catArr=[],i,catObj;for(i=0;i<catLen;i++){catObj=categories[i]||{};if(catObj.x!==UNDEF){catArr.push(catObj)}}xAxis&&xAxis[0].setTickValues(catArr)};_proto.getJSONData=function getJSONData(){var chart=this,canvas=chart.getChildren("canvas")[0],vCanvas=canvas.getChildren("vCanvas")[0],groupManager=vCanvas.getChildren("datasetGroup_dragNode")[0],datasetsArr={},jsonObj;if(groupManager){datasetsArr=groupManager.getJSONData()}jsonObj=(0,_lib.extend2)({},chart.getFromEnv("dataSource"));jsonObj.dataset=datasetsArr.dataset;jsonObj.connectors=datasetsArr.connectors;jsonObj.labels=datasetsArr.labels;return jsonObj};return DragNode}(_dragbase.default);exports.configurer=configurer=DragNode.prototype.configure;var _default=DragNode;exports.default=_default;