"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _core=_interopRequireDefault(require("../../../../fusioncharts/core"));var _index=_interopRequireDefault(require("./index"));var _multiaxisline=_interopRequireDefault(require("../../../../../smoke-test/test-sanity/multiaxisline.sanity"));var _ignoreCaseExt=_interopRequireDefault(require("../../../../fc-features/src/ignore-case-ext"));var _inputExt=_interopRequireDefault(require("../../../../fc-features/src/input-ext"));var _utility=require("../../../../../smoke-test/test-sanity/utility");var _lib=require("../../../../fc-core/src/lib/");var _common=_interopRequireDefault(require("../../../../../smoke-test/test-sanity/common.sanity"));var _lib2=require("../../../../../packages/fc-core/src/lib");var chartData=_interopRequireWildcard(require("../../../../../smoke-test/test-data/data-by-chart"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj.default=obj;if(cache){cache.set(obj,newObj)}return newObj}_core.default.addDep(_index.default);_core.default.addDep(_ignoreCaseExt.default);_core.default.addDep(_inputExt.default);var svgElement,chartName=_index.default.getName(),chartID=chartName.toLowerCase(),doc=window.document;describe("Running common chart tests for "+chartName,(function(){var chart={type:chartID,renderAt:_utility.CONTAINER_ID,width:_utility.initDimensions.width,height:_utility.initDimensions.height,dataFormat:"json",dataSource:{}},config={chartID:chartID,chart:chart,document:doc,chartWrapperId:_utility.CONTAINER_ID};_common.default.forEach((function(test){var itArr;if(test.name&&test.run){it(test.name,(function(done){test.run(config,(function(result){expect(result).toBe(true);done()}))}))}else if(test.iterator){itArr=test.iterator(chart);itArr.forEach((function(subTest){it(subTest.name,(function(done){subTest.run(config,(function(result){expect(result).toBe(true);done()}))}))}))}}))}));describe("Chart basic testing: "+chartName,(function(){var chart,chartObj,itResize,renderData=_multiaxisline.default.BASIC.newChart,updateData=_multiaxisline.default.BASIC.updateChart;chart={type:chartID,renderAt:_utility.CONTAINER_ID};(0,_lib.extend2)(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));it("Rendered chart validation passes",(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=_multiaxisline.default.BASIC.validate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.render();chartObj.addEventListener("renderComplete",renderComplete)}));it("Chart update passes",(function(done){expect(chartObj).toBeDefined();var called=0;var renderComplete=function renderComplete(){if(called===0){called++;chartObj.setChartData(updateData||chart.dataSource,"json")}else if(called===1){var response=_multiaxisline.default.BASIC.updateValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}));itResize=function itResize(resizeDimensions){it("Chart resize passes for "+resizeDimensions.width+" x "+resizeDimensions.height,(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=_multiaxisline.default.BASIC.resizeValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render((function(){chartObj.resizeTo(resizeDimensions.width,resizeDimensions.height)}))}))};for(var index=0;index<_utility.resizeDimensions.length;index++){itResize(_utility.resizeDimensions[index])}}));describe("Chart EI testing: "+_index.default.getName(),(function(){var chart,chartObj,eiMethods,renderData=_multiaxisline.default.EI.newChart;chart={type:chartID,renderAt:_utility.CONTAINER_ID};(0,_lib.extend2)(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));eiMethods=function eiMethods(methodObj){it(methodObj.name,(function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){svgElement=(0,_utility.getSVG)(chartObj);methodObj.fn(svgElement,chartObj,(function(result){expect(result).toBe(true);done()}))};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()}))};for(var key in _multiaxisline.default.EI.methods){if(_multiaxisline.default.EI.methods.hasOwnProperty(key)){eiMethods(_multiaxisline.default.EI.methods[key])}}}));describe("Running yaxisvaluecosmetics tests for "+chartName,(function(){var chart={type:chartID,renderAt:_utility.CONTAINER_ID,dataSource:{chart:{yaxisvaluefontcolor:"#ff0000",yaxisvaluelink:"https://www.google.com",yaxisvaluefontsize:30,yaxisvaluealpha:50,yaxisvaluefontbold:1,yaxisvaluefontitalic:1,yaxisvaluebgcolor:"#0000ff",yaxisvaluebordercolor:"#ffffff",yaxisvalueborderalpha:20,yaxisvalueborderdashed:1,yaxisvalueborderdashlen:6,yaxisvalueborderdashgap:5,labelalpha:50,animation:0},categories:[{category:[{label:"00:00s"},{label:"00:04s"},{label:"00:08s"},{label:"00:12s"},{label:"00:16s"},{label:"00:20s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",data:[{value:"6"},{value:"26"},{value:"16"},{value:"27"},{value:"28"},{value:"33"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"},{value:"336"},{value:"371"},{value:"389"},{value:"393"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"},{value:"36"},{value:"49"},{value:"68"},{value:"88"}]}]}]}},chartObj;beforeEach((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterEach((function(){chartObj.dispose()}));it("yAxisCosmetics-FontColor",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fill).toBe("rgb(255, 0, 0)");done()}));chartObj.render()}));it("yAxisCosmetics-FontSize",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fontSize).toBe(chart.dataSource.chart.yaxisvaluefontsize+_lib2.PXSTRING);done()}));chartObj.render()}));it("yAxisCosmetics-yaxislabelAlpha",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fillOpacity).toBe((chart.dataSource.chart.yaxisvaluealpha/100).toString());done()}));chartObj.render()}));it("yAxisCosmetics-labelLink",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).cursor).toBe(_lib2.POINTER);done()}));chartObj.render()}));it("yAxisCosmetics-BGColor",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).fill).toBe("rgb(0, 0, 255)");done()}));chartObj.render()}));it("yAxisCosmetics-BDRColor",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).stroke).toBe("rgb(255, 255, 255)");done()}));chartObj.render()}));it("yAxisCosmetics-BdrAlpha",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).strokeOpacity).toBe((chart.dataSource.chart.yaxisvalueborderalpha/100).toString());done()}));chartObj.render()}));it("yAxisCosmetics-xaxislabelAlpha",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fillOpacity).toBe((chart.dataSource.chart.labelalpha/100).toString());done()}));chartObj.render()}));it("yAxisCosmetics-BdrDashed",(function(done){chartObj.addEventListener("renderComplete",(function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).strokeDasharray).toBe("6px, 5px");done()}));chartObj.render()}))}));describe("Axis position testing",(function(){var chartObj,data={chart:{caption:"Power Generator",xaxisname:"Time",showvalues:"0",divlinealpha:"100",numvdivlines:"4",vdivlinealpha:"0",showalternatevgridcolor:"1",alternatevgridalpha:"5",animation:"0",xaxisposition:"top"},categories:[{category:[{label:"00:00s"},{label:"00:04s"},{label:"00:08s"},{label:"00:12s"},{label:"00:16s"},{label:"00:20s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",data:[{value:"6"},{value:"26"},{value:"16"},{value:"27"},{value:"28"},{value:"33"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"},{value:"336"},{value:"371"},{value:"389"},{value:"393"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"},{value:"36"},{value:"49"},{value:"68"},{value:"88"}]}]}]},chart={type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:400,dataFormat:"json",dataSource:data};beforeAll((function(){chartObj=(0,_utility.setup)(_core.default,chart)}));afterAll((function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()}));it("xAxis will be rendered on top",(function(done){chartObj.addEventListener("renderComplete",(function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(74.6);expect(dim.opposite).toBe(350.5);expect(label.getAttribute("y")).toBe("68");done()}));chartObj.render()}));it("xAxis will be updated to render on bottom",(function(done){chartObj.addEventListener("renderComplete",(function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(317.5);expect(dim.opposite).toBe(41.6);expect(label.getAttribute("y")).toBe("331");done()}));data.chart.xaxisposition=undefined;chartObj.setJSONData(data)}))}));describe("valueFontColor, valueBgColor, valueBorderColor",(function(){var chartObj;afterEach((function(){return chartObj.dispose()}));it("Without valueFontColor, valueBgColor and valueBorderColor, chart should render normally",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{caption:"Power Generator",xaxisname:"Time",showvalues:"1",divlinealpha:"100",numvdivlines:"4",vdivlinealpha:"0",showalternatevgridcolor:"1",alternatevgridalpha:"5",animation:"0"},categories:[{category:[{label:"00:00s"},{label:"00:04s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",data:[{value:"6"},{value:"26"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"}]}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroups=document.querySelectorAll('[class$="fusioncharts-datalabels"]'),rects,texts,i,j;for(i=0;i<dataLabelGroups.length;i++){if(i===0){continue}rects=dataLabelGroups[i].getElementsByTagName("rect");texts=dataLabelGroups[i].getElementsByTagName("text");expect(rects.length).toBe(0);expect(texts.length).toBe(2);for(j=0;j<texts.length;j++){expect(texts[j].getAttribute("fill")).toBe("#555555")}}done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor should work from dataset level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{caption:"Power Generator",xaxisname:"Time",showvalues:"1",divlinealpha:"100",numvdivlines:"4",vdivlinealpha:"0",showalternatevgridcolor:"1",alternatevgridalpha:"5",animation:"0",valuefontcolor:"000000",valuebgcolor:"ffffff",valuebordercolor:"ff0000"},categories:[{category:[{label:"00:00s"},{label:"00:04s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",valuefontcolor:"00ff00",valuebgcolor:"0000ff",valuebordercolor:"fff000",data:[{value:"6"},{value:"26"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"}]}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroups=document.querySelectorAll('[class$="fusioncharts-datalabels"]'),rects,texts,i,j;var result=[[],[["#00ff00","#0000ff","#fff000"],["#00ff00","#0000ff","#fff000"]],[["#000000","#ffffff","#ff0000"],["#000000","#ffffff","#ff0000"]],[["#000000","#ffffff","#ff0000"],["#000000","#ffffff","#ff0000"]]];for(i=0;i<dataLabelGroups.length;i++){if(i===0){continue}rects=dataLabelGroups[i].getElementsByTagName("rect");texts=dataLabelGroups[i].getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);for(j=0;j<texts.length;j++){expect(texts[j].getAttribute("fill")).toBe(result[i][j][0]);expect(rects[j].getAttribute("fill")).toBe(result[i][j][1]);expect(rects[j].getAttribute("stroke")).toBe(result[i][j][2])}}done()}));chartObj.render()}));it("valueFontColor, valueBgColor and valueBorderColor should work from data level",(function(done){chartObj=(0,_utility.setup)(_core.default,{type:chartID,renderAt:_utility.CONTAINER_ID,width:600,height:350,dataSource:{chart:{caption:"Power Generator",xaxisname:"Time",showvalues:"1",divlinealpha:"100",numvdivlines:"4",vdivlinealpha:"0",showalternatevgridcolor:"1",alternatevgridalpha:"5",animation:"0",valuefontcolor:"000000",valuebgcolor:"ffffff",valuebordercolor:"ff0000"},categories:[{category:[{label:"00:00s"},{label:"00:04s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",valuefontcolor:"00ff00",valuebgcolor:"0000ff",valuebordercolor:"fff000",data:[{value:"6",valuefontcolor:"ff0000",valuebgcolor:"fff000",valuebordercolor:"0000ff"},{value:"26"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"}]}]}]}});chartObj.addEventListener("renderComplete",(function(){var dataLabelGroups=document.querySelectorAll('[class$="fusioncharts-datalabels"]'),rects,texts,i,j;var result=[[],[["#ff0000","#fff000","#0000ff"],["#00ff00","#0000ff","#fff000"]],[["#000000","#ffffff","#ff0000"],["#000000","#ffffff","#ff0000"]],[["#000000","#ffffff","#ff0000"],["#000000","#ffffff","#ff0000"]]];for(i=0;i<dataLabelGroups.length;i++){if(i===0){continue}rects=dataLabelGroups[i].getElementsByTagName("rect");texts=dataLabelGroups[i].getElementsByTagName("text");expect(rects.length).toBe(2);expect(texts.length).toBe(2);for(j=0;j<texts.length;j++){expect(texts[j].getAttribute("fill")).toBe(result[i][j][0]);expect(rects[j].getAttribute("fill")).toBe(result[i][j][1]);expect(rects[j].getAttribute("stroke")).toBe(result[i][j][2])}}done()}));chartObj.render()}))}));