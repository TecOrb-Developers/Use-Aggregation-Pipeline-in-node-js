"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.submitData=submitData;var _ajax=_interopRequireDefault(require("@fusioncharts/core/src/ajax"));var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _lib=require("@fusioncharts/core/src/lib");var UNDEF,transcoders=(0,_dependencyManager.getDepsByType)("transcoder");function submitData(){var chart=this,ajaxObj=new _ajax.default,chartConf=chart.config,json=transcoders.json(),csv=transcoders.csv&&transcoders.csv()||"csv",xml=transcoders.xml(),url=chartConf.formAction,chartInstance=chart.getFromEnv("chartInstance"),requestType,data,paramObj,tempSpan,formEle;if(chartConf.formDataFormat===json.format){requestType=json.format;if(chart.getJSONData){data=JSON.stringify(chart.getJSONData())}if(chart.getCollatedData){data=JSON.stringify(chart.getCollatedData())}}else if(chartConf.formDataFormat&&chartConf.formDataFormat===csv.format){requestType=csv.format;data=chart.getCSVString&&chart.getCSVString();if(data===UNDEF||data===""){if(chart.getJSONData){data=csv.fromJSON(chart.getJSONData()).data}if(chart.getCollatedData){data=csv.fromJSON(chart.getCollatedData()).data}}}else{requestType=xml.format;if(chart.getCollatedData){data=xml.fromJSON(chart.getCollatedData()).data}if(chart.getJSONData){data=xml.fromJSON(chart.getJSONData()).data}}chart.fireChartInstanceEvent("beforeDataSubmit",{data:data},UNDEF,(function(){if(!chartConf.submitFormAsAjax){tempSpan=window.document.createElement("span");tempSpan.innerHTML='<form style="display:none" action="'+url+'" method="'+chartConf.formMethod+'" target="'+chartConf.formTarget+'"> <input type="hidden" name="strXML" value="'+(0,_lib.xssEncode)(data)+'"><input type="hidden" name="dataFormat" value="'+requestType.toUpperCase()+'" /></form>';formEle=tempSpan.removeChild(tempSpan.firstChild);window.document.body.appendChild(formEle);formEle.submit&&formEle.submit();formEle.parentNode.removeChild(formEle);tempSpan=formEle=null}else{ajaxObj.onError=function(response,wrapper,ajaxData,url){chart.fireChartInstanceEvent("dataSubmitError",{xhrObject:wrapper.xmlhttp,url:url,statusText:response,httpStatus:wrapper.xmlhttp&&wrapper.xmlhttp.status?wrapper.xmlhttp.status:-1,data:data},[chartInstance.id,response,wrapper.xmlhttp&&wrapper.xmlhttp.status])};ajaxObj.onSuccess=function(response,wrapper,ajaxData,url){chart.fireChartInstanceEvent("dataSubmitted",{xhrObject:ajaxObj,response:response,url:url,data:data},[chartInstance.id,response])};paramObj={};paramObj["str"+requestType.toUpperCase()]=data;if(ajaxObj.open){ajaxObj.abort()}ajaxObj.post(url,paramObj)}}),(function(){chart.fireChartInstanceEvent("dataSubmitCancelled",{data:data})}))}