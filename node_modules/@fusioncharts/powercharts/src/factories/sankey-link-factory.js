"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=_default;var _lib=require("@fusioncharts/core/src/lib");var _sankeyLink=_interopRequireDefault(require("../dataset/sankey/sankey-link"));var SOURCE="source",TARGET="target",BLEND="blend",BUTT="butt",HORIZONTAL="horizontal";function _default(dataset){var dsConfig=dataset.config,links=dsConfig.links,orientation=dataset.getFromEnv("orientation"),numberFormatter=dataset.getFromEnv("number-formatter"),linkComponent,gradientAngle,chartAttr=dataset.getFromEnv("dataSource").chart,linkPadding=(0,_lib.pluckNumber)(chartAttr.nodelinkpadding,0),linkColor,linkCss,linkFocusCss,linkFocusOutCss,rawCosmetics,sourceFill,targetFill,fromNode,toNode,from,fromValue,toValue,to,toolText,id;links.forEach((function(link){link.props.index+=_lib.BLANK;id=link.props.index;from=(0,_lib.parseUnsafeString)((0,_lib.pluck)(link.from));to=(0,_lib.parseUnsafeString)((0,_lib.pluck)(link.to));fromNode=dataset.getChild(from,"nodes");toNode=dataset.getChild(to,"nodes");toolText=(0,_lib.parseUnsafeString)((0,_lib.pluck)(link.tooltext,chartAttr.linktooltext,_lib.UNDEF));fromValue=fromNode.config.value;toValue=toNode.config.value;linkColor=(0,_lib.pluck)(link.color,chartAttr.linkcolor,SOURCE);sourceFill=fromNode.config.rawCosmetics.fill;targetFill=toNode.config.rawCosmetics.fill;switch(linkColor.toLowerCase()){case SOURCE:linkColor=sourceFill;break;case TARGET:linkColor=targetFill;break;case BLEND:linkColor=sourceFill+","+targetFill;break}rawCosmetics={fill:linkColor,alpha:(0,_lib.pluckNumber)(link.alpha,chartAttr.linkalpha,20),focusAlpha:(0,_lib.pluckNumber)(link.hoveralpha,chartAttr.linkhoveralpha,75),focusOutAlpha:10};gradientAngle=orientation===HORIZONTAL?0:90;linkCss={stroke:(0,_lib.toRaphaelColor)({color:rawCosmetics.fill,alpha:rawCosmetics.alpha,angle:gradientAngle}),"stroke-linecap":BUTT,fill:"none"};linkFocusCss=({},linkCss,{stroke:(0,_lib.toRaphaelColor)({color:rawCosmetics.fill,alpha:rawCosmetics.focusAlpha,angle:gradientAngle})});linkFocusOutCss=({},linkCss,{stroke:(0,_lib.toRaphaelColor)({color:rawCosmetics.fill,alpha:rawCosmetics.focusOutAlpha,angle:gradientAngle})});linkComponent=dataset.attachChild(_sankeyLink.default,"links",id);linkComponent.setData({from:from,to:to,mode:"normal",linkValue:(0,_lib.pluckNumber)(link.value),value:numberFormatter.dataLabels((0,_lib.pluckNumber)(link.value)),fromValue:fromValue,toValue:toValue,toolText:toolText,color:rawCosmetics.linkColor,alpha:rawCosmetics.alpha,curvature:(0,_lib.clampNumber)((0,_lib.pluckNumber)(link.curvature,chartAttr.linkcurvature,.5),0,1),linkType:(0,_lib.pluck)(link.type,chartAttr.linktype),linkPadding:linkPadding,sourceFill:sourceFill,targetFill:targetFill,props:link.props,rawCosmetics:rawCosmetics,eventArgs:{color:rawCosmetics.fill,alpha:rawCosmetics.alpha,value:link.value,from:link.props.source.label,to:link.props.target.label},style:{link:{normal:linkCss,focus:linkFocusCss,focusOut:linkFocusOutCss}}})}));dataset.attachListeners()}