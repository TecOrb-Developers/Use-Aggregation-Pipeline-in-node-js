"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=_default;var _lib=require("@fusioncharts/core/src/lib");var _sankeyNode=_interopRequireDefault(require("../dataset/sankey/sankey-node"));var NONE="none",validPosition=["start","inside","end"];function _default(dataset){var dsConfig=dataset.config,nodes=dsConfig.nodes,enableDrag=dsConfig.enableDrag,style=dsConfig.style,nodeComponent,labelCss,nodeCss,nodeFocusCss,nodeFocusOutCss,rawCosmetics,rawLabelCosmetics,labelBgColor,labelBorderColor,labelPosition,cursor,chartAttr=dataset.getFromEnv("dataSource").chart,nodeLabelStyle=style.node.label,nodeLabelAlpha,inheritFromPlot=(0,_lib.pluckNumber)(chartAttr.inheritlabelcolorfromnode,1),colorM=dataset.getFromEnv("color-manager"),numberFormatter=dataset.getFromEnv("number-formatter"),_dataset$getFromEnv=dataset.getFromEnv("chartConfig"),dataLabelStyle=_dataset$getFromEnv.dataLabelStyle,showLegend=_dataset$getFromEnv.showLegend,id;nodes.forEach((function(node,index){id=(0,_lib.pluck)(node.id,node.label);rawCosmetics={fill:(0,_lib.pluck)(node.color,chartAttr.nodecolor,colorM.getPlotColor(index)),alpha:(0,_lib.pluckNumber)(node.alpha,chartAttr.nodealpha,100),focusAlpha:(0,_lib.pluckNumber)(node.hoveralpha,chartAttr.nodehoveralpha,100),focusOutAlpha:40,stroke:NONE};nodeLabelAlpha=(0,_lib.pluck)(node.labelalpha,chartAttr.nodelabelalpha,chartAttr.labelalpha,inheritFromPlot?rawCosmetics.alpha:100);labelBgColor=(0,_lib.pluck)(node.labelbgcolor,chartAttr.nodelabelbgcolor,chartAttr.labelbgcolor);labelBgColor=labelBgColor?(0,_lib.convertColor)(labelBgColor,nodeLabelAlpha):_lib.BLANK;labelBorderColor=(0,_lib.pluck)(node.labelbordercolor,chartAttr.nodelabelbordercolor,chartAttr.labelbordercolor);labelBorderColor=labelBorderColor?(0,_lib.convertColor)(labelBorderColor,nodeLabelAlpha):_lib.BLANK;rawLabelCosmetics=Object.assign({},dataLabelStyle,{labelFill:(0,_lib.pluck)(node.labelfontcolor,chartAttr.nodelabelfontcolor,chartAttr.labelfontcolor,chartAttr.basefontcolor,inheritFromPlot?rawCosmetics.fill:"#5f5f5f"),labelAlpha:nodeLabelAlpha,focusAlpha:rawCosmetics.focusAlpha,focusOutAlpha:rawCosmetics.focusOutAlpha,border:labelBgColor?nodeLabelStyle.borderThickness+"px solid":_lib.BLANK,borderColor:labelBorderColor,backgroundColor:labelBgColor});cursor=enableDrag?"move":"default";labelCss={cursor:cursor,"text-bound":[labelBgColor,labelBorderColor,nodeLabelStyle.borderThickness,nodeLabelStyle.borderPadding,nodeLabelStyle.borderRadius,nodeLabelStyle.borderDash],fill:(0,_lib.convertColor)(rawLabelCosmetics.labelFill,rawLabelCosmetics.labelAlpha)};labelPosition=(0,_lib.pluck)(node.labelposition,chartAttr.nodelabelposition,_lib.preDefStr.POSITION_END).toLowerCase();if(validPosition.indexOf(labelPosition)<0){labelPosition=_lib.preDefStr.POSITION_END}nodeCss={fill:(0,_lib.convertColor)(rawCosmetics.fill,rawCosmetics.alpha),cursor:cursor,stroke:rawCosmetics.stroke};nodeFocusCss={fill:(0,_lib.convertColor)(rawCosmetics.fill,rawCosmetics.focusAlpha)};nodeFocusOutCss={fill:(0,_lib.convertColor)(rawCosmetics.fill,rawCosmetics.focusOutAlpha)};nodeComponent=dataset.attachChild(_sankeyNode.default,"nodes",id);nodeComponent.setData({id:id,index:index,mode:"normal",label:(0,_lib.pluck)(node.label,node.id),value:numberFormatter.dataLabels(node.props.value),labelPadding:numberFormatter.getCleanValue((0,_lib.pluck)(node.labelpadding,chartAttr.nodelabelpadding,5)),visible:(0,_lib.pluckNumber)(node.visible,chartAttr.shownodes,1),showLabel:(0,_lib.pluckNumber)(node.showlabel,chartAttr.shownodelabels,1),showValue:(0,_lib.pluckNumber)(node.showvalue,chartAttr.shownodevalues,0),rotateLabel:(0,_lib.pluckNumber)(node.rotatelabel,chartAttr.rotatenodelabels,0),labelPosition:labelPosition,valuePosition:(0,_lib.pluck)(node.labelposition,chartAttr.nodelabelposition,_lib.preDefStr.POSITION_MIDDLE),plotToolText:(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(node.tooltext,chartAttr.plottooltext))),toolText:(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(node.tooltext,node.tooltext))),nodeValue:(0,_lib.pluckNumber)(node.nodevalue,chartAttr.nodevalue,0),nodeDataValue:numberFormatter.dataLabels(node.nodedatavalue),textOutline:(0,_lib.pluckNumber)(node.textoutline,chartAttr.textoutline,0),rawCosmetics:rawCosmetics,rawLabelCosmetics:rawLabelCosmetics,props:node.props,eventArgs:{color:rawCosmetics.fill,alpha:rawCosmetics.alpha,labelFill:rawLabelCosmetics.labelFill,labelAlpha:rawLabelCosmetics.labelAlpha,value:node.props.value,label:node.label,sourceLinks:node.props.sourceLinks.map((function(link){return link.to})),targetLinks:node.props.targetLinks.map((function(link){return link.from}))},style:{node:{normal:nodeCss,focus:nodeFocusCss,focusOut:nodeFocusOutCss},label:{normal:labelCss,focus:Object.assign({},labelCss,{fill:(0,_lib.convertColor)(rawLabelCosmetics.labelFill,rawLabelCosmetics.focusAlpha)}),focusOut:Object.assign({},labelCss,{fill:(0,_lib.convertColor)(rawLabelCosmetics.labelFill,rawLabelCosmetics.focusOutAlpha)})}}})}));showLegend&&dataset._addLegend()}