"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _column=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/column"));var _lib=require("@fusioncharts/core/src/lib");var _candlestick=require("./candlestick");var colorStrings=_lib.preDefStr.colors,COLOR_B90000=colorStrings.B90000,DASH_DEF="none",SHOWSHADOW="showShadow",COLOR_FFFFFF=colorStrings.FFFFFF;var Volume=function(_Column){(0,_inheritsLoose2.default)(Volume,_Column);function Volume(){return _Column.apply(this,arguments)||this}var _proto=Volume.prototype;_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return false}this.trimData(datasetJSON);this.config.JSONData=datasetJSON;var dataset=this,conf=dataset.config,JSONData=dataset.config.JSONData,dataArr=JSONData.data||[],chartAttr=dataset.getFromEnv("chart-attrib"),chartConfig=dataset.getFromEnv("chartConfig"),dataLength=dataArr.length,colorM=dataset.getFromEnv("color-manager"),setColor,setAlpha,pointShadow,index,dataObj,open,close,volume,x,borderAlpha,numberFormatterAttrs,plotLineDashLen,plotLineDashGap,bearBorderColor=conf.bearBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bearbordercolor,chartConfig.vplotbordercolor,COLOR_B90000)),bearFillColor=conf.bearFillColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bearfillcolor,COLOR_B90000)),bullBorderColor=conf.bullBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bullbordercolor,chartConfig.vplotbordercolor,colorM.getColor("canvasBorderColor"))),bullFillColor=conf.bullFillColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bullfillcolor,COLOR_FFFFFF)),showVPlotBorder=(0,_lib.pluckNumber)(chartConfig.showplotborder,1),vPlotBorderThickness=showVPlotBorder?(0,_lib.pluckNumber)(chartAttr.vplotborderthickness,1):0,dataStore,setData,config,plotSpacePercent,numberFormatter=dataset.getFromEnv("number-formatter"),yMax=-Infinity,yMin=+Infinity,xMax=-Infinity,xMin=+Infinity;dataset.setState("visible",(0,_lib.pluckNumber)(JSONData.visible,1)===1);if(dataset.getState("visible")===true){dataset._conatinerHidden=false}else{dataset._containerHidden=true}conf.minAbsNonZeroValue=Infinity;conf.minAbsNonZeroData={};conf.parentYAxis=1;conf.volumeToolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(JSONData.volumetooltext,chartAttr.volumetooltext,chartAttr.plottooltext),false));conf.name=(0,_lib.getValidValue)(JSONData.seriesname);conf.showTooltip=(0,_lib.pluckNumber)(chartAttr.showtooltip,1);conf.showShadow=(0,_lib.pluckNumber)(chartAttr.showshadow,colorM.getColor(SHOWSHADOW));conf.maxColWidth=Math.abs((0,_lib.pluckNumber)((0,_lib.pluck)(chartAttr.maxcolwidth),50))||1;plotSpacePercent=Math.max((0,_lib.pluckNumber)(chartAttr.plotspacepercent,20)%100,0);conf.plotSpacePercent=conf.groupPadding=plotSpacePercent/200;conf.plotborderthickness=vPlotBorderThickness;dataStore=dataset.components.data=dataset.components.data||(dataset.components.data=[]);numberFormatterAttrs=(0,_lib.extend2)((0,_lib.extend2)({},chartAttr),{sforcedecimals:(0,_lib.getFirstValue)(chartAttr.forcevdecimals,chartAttr.forcedecimals),sforceyaxisvaluedecimals:(0,_lib.getFirstValue)(chartAttr.forcevyaxisvaluedecimals,chartAttr.forceyaxisvaluedecimals),syaxisvaluedecimals:(0,_lib.getFirstValue)(chartAttr.vyaxisvaluedecimals,chartAttr.yaxisvaluedecimals),sformatnumber:(0,_lib.getFirstValue)(chartAttr.vformatnumber,chartAttr.formatnumber),sformatnumberscale:(0,_lib.getFirstValue)(chartAttr.vformatnumberscale,chartAttr.formatnumberscale,"1"),sdefaultnumberscale:(0,_lib.getFirstValue)(chartAttr.vdefaultnumberscale,chartAttr.defaultnumberscale),snumberscaleunit:(0,_lib.getFirstValue)(chartAttr.vnumberscaleunit,chartAttr.numberscaleunit),vnumberscalevalue:(0,_lib.getFirstValue)(chartAttr.vnumberscalevalue,chartAttr.numberscalevalue),sscalerecursively:(0,_lib.getFirstValue)(chartAttr.vscalerecursively,chartAttr.scalerecursively),smaxscalerecursion:(0,_lib.getFirstValue)(chartAttr.vmaxscalerecursion,chartAttr.maxscalerecursion),sscaleseparator:(0,_lib.getFirstValue)(chartAttr.vscaleseparator,chartAttr.scaleseparator),snumberprefix:(0,_lib.getFirstValue)(chartAttr.vnumberprefix,chartAttr.numberprefix),snumbersuffix:(0,_lib.getFirstValue)(chartAttr.vnumbersuffix,chartAttr.numbersuffix),sdecimals:(0,_lib.getFirstValue)(chartAttr.vdecimals,chartAttr.decimals)});plotLineDashLen=conf.plotLineDashLen=(0,_lib.pluckNumber)(chartAttr.plotlinedashlen,5);plotLineDashGap=conf.plotLineDashGap=(0,_lib.pluckNumber)(chartAttr.plotlinedashgap,4);dataset.getFromEnv("number-formatter").configure(numberFormatterAttrs);for(index=0;index<dataLength;index+=1){setData=dataArr[index];dataObj=dataStore[index];if(!dataObj){dataObj=dataStore[index]={}}!dataObj.config&&(dataObj.config={});!dataObj.graphics&&(dataObj.graphics={});config=dataObj.config;if(setData&&!setData.vline){open=config.open=numberFormatter.getCleanValue(setData.open);close=config.close=numberFormatter.getCleanValue(setData.close);volume=config.volume=numberFormatter.getCleanValue(setData.volume,true);config.high=numberFormatter.getCleanValue(setData.high);config.low=numberFormatter.getCleanValue(setData.low);x=config.x=numberFormatter.getCleanValue(setData.x);yMax=Math.max(yMax,volume);yMin=Math.min(yMin,volume);xMax=Math.max(xMax,x);xMin=Math.min(xMin,x);config.borderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.bordercolor,close<open?bearBorderColor:bullBorderColor));setAlpha=(0,_lib.pluckNumber)(setData.alpha,100);borderAlpha=(0,_lib.pluckNumber)(chartConfig.vplotborderalpha,setData.alpha,100);setColor=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.color,close<open?bearFillColor:bullFillColor));pointShadow={opacity:conf.showShadow?setAlpha/100:0};config.color=setColor;config.alpha=setAlpha;config.setLink=setData.link;config.borderWidth=vPlotBorderThickness;config.borderAlpha=borderAlpha;config.y=volume;config.colorArr=[{color:config.color,alpha:config.alpha},{color:config.borderColor,alpha:config.borderAlpha}];config.toolText=dataset._parseToolText(index);config.toolTipValue=_lib.BLANKSTRING;config.setValue=config._y=config.y;if(volume!==0&&conf.minAbsNonZeroValue>Math.abs(volume)){conf.minAbsNonZeroValue=Math.abs(volume);conf.minAbsNonZeroData=config}config.dashed=(0,_lib.pluckNumber)(conf.plotLineDashed,setData.dashed,0);config.plotBorderDashStyle=(0,_lib.pluckNumber)(setData.dashed)?(0,_lib.getDashStyle)(plotLineDashLen,plotLineDashGap):DASH_DEF;x=x!==null?x:index+1;config._x=x;config.shadow=pointShadow}}conf.defaultPadding={left:0,right:0};conf.yMax=yMax;conf.yMin=yMin;conf.xMax=xMax;conf.xMin=xMin;dataset.setState("dirty",true)};_proto._parseToolText=function _parseToolText(i){return _candlestick._parseToolText.call(this,i)};_proto.getPlotIndices=function getPlotIndices(x){var dataset=this,i,minX=Math.floor(x),maxX=Math.ceil(x),data,returnIndices=[],sortedData=dataset.config.JSONData&&dataset.config.JSONData.data;for(i=sortedData.length;i--;){data=sortedData[i];if(data.x>=minX&&data.x<=maxX){returnIndices.push(i)}}return returnIndices};_proto._getHoveredPlot=function _getHoveredPlot(chartXVal,chartYVal){var dataset=this,chartX=chartXVal,chartY=chartYVal,xAxis=dataset.getFromEnv("xAxis"),x,i,hoveredInfo,pXs,pX;chartX+=xAxis.getTranslation();x=xAxis.getValue(chartX);pXs=dataset.getPlotIndices(x);for(i=pXs.length-1;i>-1;i--){pX=pXs[i];hoveredInfo=pX-x>0?dataset._checkPointerOverColumn(pX,chartX,chartY)||dataset._checkPointerOverColumn(pX-1,chartX,chartY):dataset._checkPointerOverColumn(pX+1,chartX,chartY)||dataset._checkPointerOverColumn(pX,chartX,chartY);if(hoveredInfo){break}}return hoveredInfo};_proto.getDataLimits=function getDataLimits(){var conf=this.config;return{max:conf.yMax,min:conf.yMin,xMax:conf.xMax,xMin:conf.xMin}};_proto.addDatasetSpecificEvtArgs=function addDatasetSpecificEvtArgs(_dataObj){var dataObj=_dataObj,config=dataObj.config,trackerConfig=dataObj.trackerConfig,eventArgs=trackerConfig.eventArgs;Object.assign(eventArgs,{open:config.open,close:config.close,high:config.high,low:config.low,volume:config.volume,alpha:config.alpha,x:config.x,displayValue:config.displayValue,color:config.color,borderColor:config.borderColor,dashed:config.dashed})};_proto.calculateScrollRange=function calculateScrollRange(){var dataset=this,conf=dataset.config;conf.scrollMinVal=0;conf.scrollMaxVal=dataset.components.data&&dataset.components.data.length;conf.scrollMinValForLabel=conf.scrollMinVal;conf.scrollMaxValForLabel=conf.scrollMaxVal};_proto.drawLabel=function drawLabel(){};_proto.getName=function getName(){return"volume"};return Volume}(_column.default);var _default=Volume;exports.default=_default;