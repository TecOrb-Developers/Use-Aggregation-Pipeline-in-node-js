"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _lib=require("@fusioncharts/core/src/lib");var _line=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/line"));var _candlestick=require("./candlestick");var colorStrings=_lib.preDefStr.colors,COLOR_B90000=colorStrings.B90000,COLOR_FFFFFF=colorStrings.FFFFFF,UNDERSCORE="_",BLANK="",SHOWSHADOW="showShadow",LINE_STR="line",ZEROSTRING="0",HUNDRED="100";var CandleStickline=function(_Line){(0,_inheritsLoose2.default)(CandleStickline,_Line);function CandleStickline(){return _Line.apply(this,arguments)||this}var _proto=CandleStickline.prototype;_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return false}this.trimData(datasetJSON);this.config.JSONData=datasetJSON;var dataset=this,conf=dataset.config,JSONData=dataset.config.JSONData,dataArr=JSONData.data||[],chartAttr=dataset.getFromEnv("chart-attrib"),dataLength=dataArr.length,numberFormatter=dataset.getFromEnv("number-formatter"),colorM=dataset.getFromEnv("color-manager"),setColor,setBorderColor,setAlpha,dashStyle,bearBorderColor=conf.bearBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bearbordercolor,COLOR_B90000)),bearFillColor=conf.bearFillColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bearfillcolor,COLOR_B90000)),bullBorderColor=conf.bullBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bullbordercolor,colorM.getColor("canvasBorderColor"))),bullFillColor=conf.bullFillColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.bullfillcolor,COLOR_FFFFFF)),plotLineThickness=conf.linethickness=conf.plotBorderThickness=(0,_lib.pluckNumber)(chartAttr.plotlinethickness,2),drawAnchors=!!(0,_lib.pluckNumber)(chartAttr.drawanchors,0),setAnchorAngle=(0,_lib.pluckNumber)(chartAttr.anchorstartangle,90),setAnchorRadius=(0,_lib.pluckNumber)(chartAttr.anchorradius,this.anchorRadius,3),setAnchorBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.anchorbordercolor,bullBorderColor)),setAnchorBorderThickness=(0,_lib.pluckNumber)(chartAttr.anchorborderthickness,this.anchorBorderThickness,1),setAnchorBgColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.anchorbgcolor,colorM.getColor("anchorBgColor"))),setAnchorAlpha=(0,_lib.pluck)(chartAttr.anchoralpha,ZEROSTRING),setAnchorBgAlpha=(0,_lib.pluck)(chartAttr.anchorbgalpha,setAnchorAlpha),pointShadow,index,dataObj,open,close,high,low,minValue,maxValue,x,dataStore,setData,config,isCandleStick=false,plotSpacePercent,yMax=-Infinity,yMin=+Infinity,xMax=-Infinity,xMin=+Infinity;dataset.setState("visible",(0,_lib.pluckNumber)(JSONData.visible,1)===1);conf.plotLineDashLen=(0,_lib.pluckNumber)(chartAttr.plotlinedashlen,5);conf.plotLineDashGap=(0,_lib.pluckNumber)(chartAttr.plotlinedashgap,4);dataset._conatinerHidden=!!dataset.getState("visible");conf.defaultPadding={left:.5,right:.5};conf.plotType=LINE_STR;conf.parentYAxis=0;conf.toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(JSONData.tooltext,chartAttr.plottooltext),false));conf.name=(0,_lib.getValidValue)(JSONData.seriesname);conf.showTooltip=(0,_lib.pluckNumber)(chartAttr.showtooltip,1);conf.maxColWidth=Math.abs((0,_lib.pluckNumber)((0,_lib.pluck)(chartAttr.maxcolwidth),50))||1;conf.enableAnimation=(0,_lib.pluckNumber)(chartAttr.animation,chartAttr.defaultanimation,1);conf.animation=!conf.enableAnimation?false:{duration:(0,_lib.pluckNumber)(chartAttr.animationduration,1)*1e3};conf.lineAlpha=(0,_lib.pluck)(chartAttr.plotlinealpha,HUNDRED);plotSpacePercent=Math.max((0,_lib.pluckNumber)(chartAttr.plotspacepercent,20)%100,0);conf.plotSpacePercent=conf.groupPadding=plotSpacePercent/200;dataStore=dataset.components.data=dataset.components.data||(dataset.components.data=[]);conf.valuePadding=(0,_lib.pluckNumber)(JSONData.valuepadding,chartAttr.valuepadding,2);conf.plotBorderThickness=plotLineThickness;conf.showvalues=1;conf.showShadow=(0,_lib.pluckNumber)(chartAttr.showshadow,colorM.getColor(SHOWSHADOW));for(index=0;index<dataLength;index+=1){setData=dataArr[index];dataObj=dataStore[index];if(!dataObj){dataObj=dataStore[index]={}}!dataObj.config&&(dataObj.config={});!dataObj.graphics&&(dataObj.graphics={});config=dataObj.config;if(setData&&!setData.vline){config.setLink=(0,_lib.pluck)(setData.link);open=config.open=numberFormatter.getCleanValue(setData.open);close=config.close=numberFormatter.getCleanValue(setData.close);high=config.high=numberFormatter.getCleanValue(setData.high);low=config.low=numberFormatter.getCleanValue(setData.low);config.volume=numberFormatter.getCleanValue(setData.volume,true);x=config.x=numberFormatter.getCleanValue(setData.x);config.closeVal=Math.min(open,close);config.yVal=Math.max(open,close);minValue=Math.min(open,close,high,low);maxValue=Math.max(open,close,high,low);config.valuePadding=(0,_lib.pluckNumber)(setData.valuepadding,conf.valuePadding);setBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.bordercolor,close<open?bearBorderColor:bullBorderColor));setAlpha=(0,_lib.pluck)(setData.alpha,conf.lineAlpha);setColor=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.color,close<open?bearFillColor:bullFillColor));dashStyle=(0,_lib.pluckNumber)(setData.dashed)?(0,_lib.getDashStyle)(conf.plotLineDashLen,conf.plotLineDashGap):"none";config.dashStyle=dashStyle;pointShadow={opacity:conf.showShadow?setAlpha/100:0};config.rawDataColor=setColor;config.color=isCandleStick?setColor:setBorderColor;config.alpha=setAlpha;config.dashed=(0,_lib.pluckNumber)(conf.plotLineDashed,setData.dashed,0);config.setColor=config.color;config.setAlpha=config.alpha;config.anchorImageUrl=(0,_lib.pluck)(setData.anchorimageurl,JSONData.anchorimageurl,chartAttr.anchorimageurl);config.borderColor=setBorderColor;config.borderAlpha=config.plotLineAlpha;config.colorArr=[{color:config.color,alpha:config.alpha},{color:config.borderColor,alpha:config.borderAlpha}];config.dataLabelStyle=dataset._configureDataLabelStyle(setData);config.anchorSides=(0,_lib.pluckNumber)(setData.anchorsides,JSONData.anchorsides,chartAttr.anchorsides);config.symbol=(0,_lib.mapSymbolName)(config.anchorSides).split(UNDERSCORE);config.anchorProps={enabled:drawAnchors,bgColor:setAnchorBgColor,symbol:config.symbol,bgAlpha:setAnchorBgAlpha*setAnchorAlpha/100+BLANK,borderColor:setAnchorBorderColor,borderAlpha:setAnchorAlpha,anchorAlpha:setAnchorAlpha,borderThickness:setAnchorBorderThickness,imageUrl:config.anchorImageUrl,radius:setAnchorRadius,imageScale:(0,_lib.pluckNumber)(setData.imagescale,JSONData.imagescale,chartAttr.imagescale,100),imagePadding:(0,_lib.pluckNumber)(setData.anchorimagepadding,JSONData.anchorimagepadding,chartAttr.anchorimagepadding,1),imageAlpha:(0,_lib.pluckNumber)(JSONData.anchorimagealpha,chartAttr.anchorimagealpha,100),startAngle:setAnchorAngle};config.showValue=setData.displayvalue?1:0;config.hoverEffects={};config.anchorSides=(0,_lib.pluckNumber)(setData.anchorsides,JSONData.anchorsides,chartAttr.anchorsides);config.symbol=(0,_lib.mapSymbolName)(config.anchorSides).split(UNDERSCORE);config.hoverEffects={};config.y=close;config.link=(0,_lib.pluck)(setData.link);config.toolText=dataset._parseToolText(index);config.toolTipValue=_lib.BLANKSTRING;config.setValue=config._y=config.y;config.displayValue=(0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.displayvalue,setData.valuetext,BLANK));if(minValue!==null){yMax=Math.max(yMax,minValue);yMin=Math.min(yMin,minValue)}if(maxValue!==null){yMax=Math.max(yMax,maxValue);yMin=Math.min(yMin,maxValue)}if(x!==null){xMax=Math.max(xMax,x);xMin=Math.min(xMin,x)}x=x||index+1;config._x=config.x=x;config.high=Math.max(open,close,high,low);config.low=Math.min(open,close,high,low);config.shadow=pointShadow}}conf.yMax=yMax;conf.yMin=yMin;conf.xMax=xMax;conf.xMin=xMin;dataset.setState("dirty",true)};_proto.__setDefaultConfig=function __setDefaultConfig(){_Line.prototype.__setDefaultConfig.call(this);this.config.drawLine=1};_proto.addDatasetSpecificEvtArgs=function addDatasetSpecificEvtArgs(_dataObj){var dataObj=_dataObj,config=dataObj.config,eventArgs=dataObj.config.eventArgs;Object.assign(eventArgs,{open:config.open,close:config.close,high:config.high,low:config.low,volume:config.volume,alpha:config.alpha,x:config.x,displayValue:config.displayValue,color:config.rawDataColor,borderColor:config.borderColor,dashed:config.dashed})};_proto.trimData=function trimData(datasetJSON){if(!this.components&&this.components.data&&this.components.data.length){return}var comps=this.components,prevData=comps&&comps.data,prevDataLength=prevData&&prevData.length,data=datasetJSON.data,currDataLength=Array.isArray(data)&&data.filter((function(v){return v.high||v.open||v.close||v.low})).length||0,dataDiff=prevDataLength-currDataLength;if(dataDiff>0){this.removeData(currDataLength,dataDiff,false)}};_proto.calculateScrollRange=function calculateScrollRange(){var dataset=this,conf=dataset.config,dataLen=dataset.components.data&&dataset.components.data.length;conf.scrollMinVal=conf.scrollMinValForLabel=0;conf.scrollMaxVal=conf.scrollMaxValForLabel=dataLen};_proto.getDataLimits=function getDataLimits(){var conf=this.config;return{max:conf.yMax,min:conf.yMin,xMax:conf.xMax,xMin:conf.xMin}};_proto.getPlotIndices=function getPlotIndices(x){var dataset=this,i,minX=Math.floor(x),maxX=Math.ceil(x),data,returnIndices=[],sortedData=dataset.config.JSONData&&dataset.config.JSONData.data;for(i=sortedData.length;i--;){data=sortedData[i];if(data.x>=minX&&data.x<=maxX){returnIndices.push(i)}}return returnIndices};_proto._parseToolText=function _parseToolText(i){return _candlestick._parseToolText.call(this,i)};_proto._getHoveredPlot=function _getHoveredPlot(chartXVal,chartYVal){var dataset=this,chartX=chartXVal,chartY=chartYVal,xAxis=dataset.getFromEnv("xAxis"),dataStore=dataset.components.data,pointObj,pXs,xMin,xMax,returnValue,conf=dataset.config,i,maxRadius=conf&&conf.radius||0;chartX+=xAxis.getTranslation();pXs=dataset.getPlotIndices(Math.floor(Math.max(xAxis.getValue(chartX-maxRadius),0)));xMin=pXs[0];pXs=dataset.getPlotIndices(Math.ceil(Math.min(xAxis.getValue(chartX+maxRadius),dataStore.length-1)));xMax=pXs[pXs.length-1];var _ref=xMin>xMax?[xMax,xMin]:[xMin,xMax];xMin=_ref[0];xMax=_ref[1];for(i=xMax;i>=xMin;i--){pointObj=dataStore[i];if(pointObj){returnValue=dataset.isWithinShape(pointObj,i,chartX,chartY);if(returnValue){break}}}return returnValue};_proto.getName=function getName(){return"candlestickline"};return CandleStickline}(_line.default);var _default=CandleStickline;exports.default=_default;