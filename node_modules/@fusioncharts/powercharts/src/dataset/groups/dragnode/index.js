"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _componentInterface=require("@fusioncharts/core/src/component-interface");var _dragablelabels=_interopRequireDefault(require("../../dragnode/dragablelabels"));var _lib=require("@fusioncharts/core/src/lib");var CLEAR_TIME_1000=1e3,shapesInfo={circle:"circ",rectangle:"rect",polygon:"poly"},UNDEF,INPUT=_lib.preDefStr.INPUT,BLANKSPACE=_lib.preDefStr.BLANKSPACE,BLANK=_lib.preDefStr.BLANK,COLOR_FFFFFF="ffffff",PX=_lib.preDefStr.PX,COLOR_000000="000000",OPTIONSTR="<option>",OPTIONCLOSESTR="</option>",LABEL=_lib.preDefStr.LABEL,DATASET=_lib.preDefStr.DATASET,COMMA=_lib.preDefStr.COMMA,DATASETSTATE="appearing",ONE_PX_BORDER="1px solid #cccccc",DISABLED="disabled",LABEL_ADDED="labeladded",OPTION_VALUE='<option value="',CLOSE_TAG='">',OPTION_STR="</option>",NODE_ADDED="nodeAdded",NODE_UPDATED="nodeupdated",NODE_DELETED="nodedeleted",CONNECTOR_ADDED="connectoradded",CONNECTOR_UPDATED="connectorupdated",CONNECTOR_DELETED="connectordeleted",TRANSPARENT="transparent",DIV_STR="div",COLOR_EFEFEF="efefef",SUBMIT_STR="Submit",DELETE_STR="Delete",CANCEL_STR="Cancel",UPDATE_STR="update",APPEARING_STR="appearing",LABEL_DELETED="labeldeleted",removeElems=function removeElems(graphics){for(var i in graphics){graphics[i].remove()}},defined=function defined(obj){return obj!==UNDEF&&obj!==null},makeShapeSpecificModifications=function makeShapeSpecificModifications(eventArgs,dataObj){switch(eventArgs.shape){case _lib.preDefStr.CIRCLE:eventArgs.radius=dataObj.radius;break;case _lib.preDefStr.POLYGON:eventArgs.radius=dataObj.radius;eventArgs.sides=dataObj.numsides;break;default:eventArgs.width=dataObj.width;eventArgs.height=dataObj.height;break}},_showNodeUpdateUI=function(){var manageShapeFields=function manageShapeFields(){var ui=this.getGraphicalElement("cacheUpdateUI"),ele=ui.fields.shape,shapeFields=["rectWidth","rectHeight","circPolyRadius","polySides"],i=shapeFields.length,key;while(i--){key=shapeFields[i];if(/rect|poly|circ/gi.test(key)){ui.labels[key].hide();ui.fields[key].hide()}if(new RegExp((0,_lib.pluck)(ele.val(),"rect"),"ig").test(key)){ui.labels[key].show();ui.fields[key].show()}}},showGivenColor=function showGivenColor(){var fields=this.getGraphicalElement("cacheUpdateUI").fields,color=(0,_lib.getValidColor)(fields.color.val());color&&fields.colorOut.css({background:(0,_lib.parseColor)(color)})},manageImageFields=function manageImageFields(animate){var manager=this,ui=manager.getGraphicalElement("cacheUpdateUI"),animationManager=manager.getFromEnv("animationManager"),chartHeight=manager.getFromEnv("chartConfig").height,padding=5,isChecked=ui.fields.image.val(),imgKey=["imgWidth","imgHeight","imgAlign","imgUrl"],dialogHeight,i,key;dialogHeight=isChecked?250:215;if(animate){ui.ok.hide();ui.cancel.hide();ui.removeItem.hide();ui.error.hide()}i=imgKey.length;while(!isChecked&&i--){key=imgKey[i];ui.labels[key].hide();ui.fields[key].hide()}animate&&animationManager.setAnimationState("uichange");animationManager.setAnimation({el:ui.dialog,state:"updating",attr:{top:(chartHeight-dialogHeight)/2,height:dialogHeight},component:manager,label:"uidialog",callback:function callback(){i=imgKey.length;while(i--&&isChecked){key=imgKey[i];ui.labels[key].show();ui.fields[key].show()}ui.ok.attr({y:dialogHeight-23-padding}).show();ui.cancel.attr({y:dialogHeight-23-padding}).show();ui.removeItem.attr({y:dialogHeight-23-padding});ui.error.attr({y:dialogHeight-23-padding+4}).show();if(ui.edit){ui.removeItem.show()}else{ui.removeItem.hide()}}})};return function(config,edit){var manager=this,ui=manager.getGraphicalElement("cacheUpdateUI"),paper=manager.getFromEnv("paper"),borderStyle=ONE_PX_BORDER,inputStyle={width:80+PX,border:borderStyle,fontSize:10+PX,lineHeight:15+PX,padding:2+PX,fontFamily:(manager.getFromEnv("style").inCanvasStyle||{}).fontFamily},noUIfound,labelStyle={textAlign:"right"},fields=ui&&ui.fields,labels=ui&&ui.labels,dialog,onSubmit=function onSubmit(event){event.stopPropagation();var uiFields=ui&&ui.fields,uiEdit=ui.edit,idFound,id,submitObj;if(fields){submitObj={x:(0,_lib.getFirstValue)(fields.x.val(),manager.getFromEnv("xAxis").getLimit().min),y:(0,_lib.getFirstValue)(fields.y.val(),manager.getFromEnv("yAxis").getLimit().min),id:id=fields.id.val(),datasetId:fields.dataset.val(),name:fields.label.val(),tooltext:fields.tooltip.val(),color:fields.color.val(),alpha:fields.alpha.val(),labelalign:fields.labelalign.val(),allowdrag:fields.draggable.val(),imagenode:fields.image.val(),imagewidth:fields.imgWidth.val(),imageheight:fields.imgHeight.val(),imagealign:fields.imgAlign.val(),imageurl:fields.imgUrl.val(),link:fields.link.val()};switch(uiFields.shape.val()){case"circ":submitObj.shape=_lib.preDefStr.CIRCLE;submitObj.radius=fields.circPolyRadius.val();break;case"poly":submitObj.shape=_lib.preDefStr.POLYGON;submitObj.radius=fields.circPolyRadius.val();submitObj.numsides=fields.polySides.val();break;default:submitObj.shape=_lib.preDefStr.RECTANGLE;submitObj.width=fields.rectWidth.val();submitObj.height=fields.rectHeight.val();break}if(manager.getNode(submitObj.id)){idFound=true}if(!idFound||uiEdit!==UNDEF){id=submitObj.datasetId;if(id!==_lib.BLANKSTRING||uiEdit){id=Number(id);uiEdit?manager.updateNode(submitObj):manager.addNode(submitObj);ui.hide();ui.visible=false}return}ui.error.attr({text:"ID already exist."});fields.label.focus()}ui.enableFields()},onCancel=function onCancel(event){event.stopPropagation();ui.hide();ui.visible=false;ui.enableFields();ui.error.attr({text:BLANK});ui.visible=false},onDelete=function onDelete(event){event.stopPropagation();manager.deleteNode(ui.fields.id.val());ui.hide();ui.visible=false};manager.getFromEnv("animationManager").setAnimationState("uichange");if(!ui){noUIfound=true}ui=manager.addGraphicalElement("cacheUpdateUI",manager.createHtmlDialog(350,215,onSubmit,onCancel,onDelete,ui));if(noUIfound){dialog=ui.dialog;labels=ui.labels={};fields=ui.fields={}}ui.config=config;ui.edit=edit;if(!ui.error){ui.error=paper.html("span",{color:"ff0000",x:30,y:228},UNDEF,dialog)}if(!ui.enableFields){ui.enableFields=function(){var key;for(key in config){if(config[key]&&config[key].disabled&&fields[key]){fields[key].element.removeAttribute("disabled")}}}}if(!ui.clearFields){ui.clearFields=function(){var key;for(key in ui.fields){if(!fields[key].element.disabled){fields[key].element.value=_lib.BLANKSTRING}}}}(0,_lib.fcEach)(this.nodeUpdateUIDefinition,(function(def){var field,key=def.key,attrs={},confObj=config[key]||{},innerHTML,value;!labels[key]&&(labels[key]=paper.html(LABEL,{x:def.x,y:def.y,width:def.labelWidth||45,text:def.text},labelStyle,dialog));if(def.noInput){return}field=fields[key];if(!field){inputStyle.border=def.type==="checkbox"?BLANK:borderStyle;field=fields[key]=paper.html(def.inputType||"input",{x:def.labelWidth&&def.labelWidth+5||50,y:-2+(def.inputPaddingTop||0),width:def.inputWidth||50,name:key||_lib.BLANKSTRING},inputStyle);if(def.inputType!=="select"){field.attr({type:def.type||"text"}).on("keyup",ui.handleKeyPress)}field.add(labels[key])}if(defined(innerHTML=(0,_lib.getFirstValue)(confObj.innerHTML,def.innerHTML))){attrs.innerHTML=innerHTML}if(confObj.disabled){attrs.disabled=DISABLED}else{field.element&&(field.element.disabled=false)}field.attr(attrs);if(defined(value=(0,_lib.getFirstValue)(confObj.value,def.value))){field.val(value)}key==="shape"&&field.on("change",(function(){manageShapeFields.call(manager)}));key==="image"&&field.on("fc-click",(function(){manageImageFields.call(manager,true)}));key==="color"&&field.on("keyup",(function(){showGivenColor.call(manager)}))}));showGivenColor.call(this);manageImageFields.call(this);manageShapeFields.call(this);ui.visible=true;ui.fields[edit?LABEL:"id"].focus()}}();var DragNodeGroup=function(_ComponentInterface){(0,_inheritsLoose2.default)(DragNodeGroup,_ComponentInterface);function DragNodeGroup(){var _this;_this=_ComponentInterface.call(this)||this;var manager=(0,_assertThisInitialized2.default)(_this);manager.setState("visible",true);manager.connectorUpdateUIDefinition=[{key:"fromid",text:"Connect From",inputType:"select",x:10,y:15,labelWidth:80,inputWidth:100},{key:"toid",text:"Connect To",inputType:"select",x:10,y:40,labelWidth:80,inputWidth:100},{key:"arratstart",text:"Arrow At Start",x:200,y:15,type:"checkbox",inputPaddingTop:3,labelWidth:80,inputWidth:15},{key:"arratend",text:"Arrow At End",x:200,y:40,type:"checkbox",inputPaddingTop:3,labelWidth:80,inputWidth:15},{key:LABEL,text:"Label",x:10,y:75,labelWidth:40,inputWidth:120},{key:"id",text:"Node ID",x:190,y:75,inputWidth:55},{key:"color",text:"Color",x:10,y:100,labelWidth:40,inputWidth:35},{key:"alpha",text:"Alpha",x:110,y:100,inputWidth:25,labelWidth:35},{key:"strength",text:"Strength",x:190,y:100,inputWidth:55,val:"0.1"},{key:"url",text:"Link",x:10,y:125,labelWidth:40,inputWidth:120},{key:"tooltext",text:"Tooltip",x:190,y:125,labelWidth:40,inputWidth:60},{key:"dashed",text:"Dashed",x:10,y:150,type:"checkbox",inputPaddingTop:3,inputWidth:15,labelWidth:40},{key:"dashgap",text:"Dash Gap",x:85,y:150,labelWidth:60,inputWidth:25},{key:"dashlen",text:"Dash Length",x:190,y:150,labelWidth:70,inputWidth:30}];manager.nodeUpdateUIDefinition=[{key:"id",text:"Id",inputWidth:60,x:10,y:15},{key:DATASET,text:DATASET,inputType:"select",inputWidth:110,innerHTML:UNDEF,x:170,y:15},{key:"x",text:"Value",x:10,y:40,inputWidth:21},{key:"y",text:COMMA,x:88,y:40,inputWidth:21,labelWidth:5},{text:"(x, y)",x:125,y:40,labelWidth:33,noInput:true},{key:"tooltip",text:"Tooltip",inputWidth:105,x:170,y:40},{key:LABEL,text:"Label",inputWidth:92,x:10,y:65},{key:"labelalign",text:"Align",labelWidth:70,inputWidth:110,inputType:"select",innerHTML:'<option></option><option value="top">Top</option><option value="middle">Middle</option>'+'<option value="bottom">Bottom</option>',x:145,y:63},{key:"color",text:"Color",x:10,y:90,inputWidth:60},{key:"colorOut",innerHTML:"&nbsp;",x:85,y:90,inputWidth:15,inputType:"span"},{key:"alpha",text:"Alpha",x:170,y:90,inputWidth:20},{key:"draggable",text:"Allow Drag",value:true,inputWidth:20,x:250,y:90,labelWidth:58,inputPaddingTop:3,type:"checkbox"},{key:"shape",text:"Shape",inputType:"select",inputWidth:97,innerHTML:'<option value="rect">Rectangle</option><option value="circ">Circle</option><option '+'value="poly">Polygon</option>',x:10,y:115},{key:"rectHeight",text:"Height",x:170,y:115,inputWidth:20},{key:"rectWidth",text:"Width",x:255,y:115,inputWidth:20},{key:"circPolyRadius",text:"Radius",x:170,y:115,inputWidth:20},{key:"polySides",text:"Sides",x:255,y:115,inputWidth:20},{key:"link",text:"Link",x:10,y:140,inputWidth:92},{key:"image",text:"Image",type:"checkbox",inputPaddingTop:4,inputWidth:20,x:10,y:170},{key:"imgUrl",text:"URL",inputWidth:105,x:170,y:170},{key:"imgWidth",text:"Width",inputWidth:20,x:10,y:195},{key:"imgHeight",text:"Height",inputWidth:20,x:82,y:195},{key:"imgAlign",text:"Align",inputType:"select",inputWidth:75,innerHTML:'<option value="top">Top</option><option value="middle">Middle</option><option '+'value="bottom">Bottom</option>',x:170,y:195}];manager.labelUpdateUIDefinition=[{key:LABEL,text:"Label*",x:10,y:15,inputWidth:235},{key:"size",text:"Size",x:10,y:40},{key:"padding",text:"Padding",x:10,y:65},{key:"x",text:"Position",x:120,y:65,labelWidth:70,inputWidth:25},{key:"y",text:COMMA,x:225,y:65,labelWidth:10,inputWidth:25},{key:"xy",text:"(x, y)",x:260,y:65,noInput:true},{key:"allowdrag",text:"Allow Drag",x:120,y:40,inputType:"checkbox",inputPaddingTop:3,inputWidth:15,labelWidth:70,val:1},{key:"color",text:"Color",x:10,y:90},{key:"alpha",text:"Alpha",x:145,y:90,inputWidth:30,val:_lib.preDefStr.HUNDREDSTRING},{key:"bordercolor",text:"Border Color",x:10,y:125,labelWidth:100},{key:"bgcolor",text:"Background Color",x:10,y:150,labelWidth:100}];return _this}var _proto=DragNodeGroup.prototype;_proto.configure=function configure(){this.setState("configured",true)};_proto.getType=function getType(){return"group"};_proto.getName=function getName(){return"dragNodeGroup"};_proto.showLabelUpdateUI=function showLabelUpdateUI(options){if(options===void 0){options={}}var manager=this,paper=manager.getFromEnv("paper"),ui=manager.getGraphicalElement("cacheLabelUpdateUI"),inputStyle={border:"1px solid #cccccc",fontSize:10+PX,lineHeight:15+PX,fontFamily:(manager.getFromEnv("style").inCanvasStyle||{}).fontFamily,padding:2+PX},labelStyle={textAlign:"right"},noUIfound,fields=ui&&ui.fields,labels=ui&&ui.labels,field,value,dialog;manager.getFromEnv("animationManager").setAnimationState("uichange");if(!ui){noUIfound=true}ui=manager.addGraphicalElement("cacheLabelUpdateUI",manager.createHtmlDialog(315,205,(function(){var uiFields=ui&&ui.fields,submitObj;if(uiFields){submitObj={text:uiFields.label.val(),x:uiFields.x.val(),y:uiFields.y.val(),color:uiFields.color.val(),alpha:uiFields.alpha.val(),bgcolor:uiFields.bgcolor.val(),bordercolor:uiFields.bordercolor.val(),fontsize:uiFields.size.val(),allowdrag:uiFields.allowdrag.val(),padding:uiFields.padding.val()};if(submitObj.text){manager.addLabel&&manager.addLabel(submitObj);ui.hide()}else{ui.error.attr({text:"Label cannot be blank."});fields.label.focus()}}}),(function(){ui.error.attr({text:_lib.BLANKSTRING});ui.hide()}),UNDEF,ui));if(noUIfound){dialog=ui.dialog;labels=ui.labels={};fields=ui.fields={}}(0,_lib.fcEach)(manager.labelUpdateUIDefinition,(function(def){var key=def.key;if(!labels[key]){labels[key]=paper.html(LABEL,{x:def.x,y:def.y,width:def.labelWidth||45,text:def.text},labelStyle,dialog)}if(def.noInput){return}if(!(field=fields[key])){field=fields[key]=paper.html(INPUT,{y:-2+(def.inputPaddingTop||0),x:def.labelWidth&&def.labelWidth+5||50,width:def.inputWidth||50,type:def.inputType||"text",name:key||_lib.BLANKSTRING},inputStyle,labels[key]).on("keyup",ui.handleKeyPress)}if(defined(value=(0,_lib.getFirstValue)(options[key],def.val))){field.val(value)}}));if(!ui.error){ui.error=paper.html("span",{color:"ff0000",x:10,y:180},UNDEF,dialog)}ui.fields.label.focus()};_proto.restoreData=function restoreData(){var manager=this,datasets=manager.getChildren("dataset"),chart=manager.getFromEnv("chart"),showlegend=(0,_lib.pluckNumber)(chart.config.showlegend,0),connectors=manager.getChildren("connector"),jsonData=chart.getFromEnv("dataSource"),i,dataset,dataStore,dataObj,graphics,labelObj,len,labelSet=manager.getChildren("labels"),removeElements=function removeElements(datastore){var j,ele;for(j=0;j<(datastore&&datastore.length);j++){dataObj=datastore[j];delete dataObj.removed;if(dataObj.config.add){graphics=datastore[j].graphics;for(ele in graphics){graphics[ele].remove()}datastore.splice(j,1);j--}}},restoreDatasets=function restoreDatasets(k,dataSets,json){dataset=dataSets[k];dataStore=dataset.components.data;removeElements(dataStore);dataset.drawn=false;dataset.configure(json[k])};for(i=0,len=datasets&&datasets.length;i<len;i++){restoreDatasets(i,datasets,jsonData.dataset)}for(i=0,len=connectors&&connectors.length;i<len;i++){restoreDatasets(i,connectors,jsonData.connectors)}if(labelSet&&labelSet.length){labelObj=labelSet[0];dataStore=labelObj.components.data;dataStore&&removeElements(dataStore);labelObj.configure(jsonData.labels)}chart.fireChartInstanceEvent("dataRestored");manager.asyncDraw();showlegend&&manager.getFromEnv("legend").asyncDraw()};_proto.addLabel=function addLabel(labelObj){var manager=this,labelDS=manager.getChildren("labels"),sourceEvent=LABEL_ADDED,dataStore,eventArgs,chart=manager.getFromEnv("chart"),len;labelObj.add=true;if(labelDS&&labelDS[0]){labelDS=labelDS[0]}else{(0,_lib.componentFactory)(manager,_dragablelabels.default,"labels",1,[{}]);labelDS=manager.getChildren("labels")[0]}dataStore=labelDS.components.data||(labelDS.components.data=[]);len=dataStore.length;labelDS._setConfigure(len,labelObj);eventArgs={text:labelObj.text,x:labelObj.x,y:labelObj.y,allowdrag:labelObj.allowdrag,sourceType:"labelnode",link:labelObj.link};chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);labelDS.asyncDraw()};_proto.showNodeAddUI=function showNodeAddUI(){var manager=this,datasets=manager.getChildren("dataset"),datasetDropDownStr=_lib.BLANKSTRING,conf,dataset,type,i;for(i=0;i<datasets.length;i++){dataset=datasets[i]||{};conf=dataset.config;type=dataset.getName();if(type==="dragNode"){datasetDropDownStr+=OPTION_VALUE+dataset.config.datasetIndex+CLOSE_TAG+(conf.name!==BLANK&&conf.name!==UNDEF&&conf.name+_lib.COMMASTRING+BLANKSPACE||BLANK)+dataset.config.datasetIndex+OPTION_STR}}manager.showNodeUpdateUI({dataset:{innerHTML:datasetDropDownStr}})};_proto.showConnectorAddUI=function showConnectorAddUI(){var manager=this,nodes=manager.getNode(),nodeStr=_lib.BLANKSTRING,id,i,config,node;for(i in nodes){node=nodes[i];config=node.config;id=config.id;nodeStr+=OPTION_VALUE+id+CLOSE_TAG+id+OPTION_STR}manager.showConnectorUpdateUI({fromid:{innerHTML:nodeStr},toid:{innerHTML:nodeStr}})};_proto.showConnectorUpdateUI=function showConnectorUpdateUI(config,edit){var manager=this,renderer=manager.getFromEnv("paper"),uiName="cacheConnectorUpdateUI"+(edit?"edit":"new"),ui=manager.getGraphicalElement(uiName),inputStyle={border:"1px solid #cccccc",fontSize:10+PX,lineHeight:15+PX,fontFamily:(manager.getFromEnv("style").inCanvasStyle||{}).fontFamily,padding:2+PX},noUIfound,labelStyle={textAlign:"right"},fields=ui&&ui.fields,labels=ui&&ui.labels,innerHTML,field,value,onDelete=function onDelete(){var uiFields=ui&&ui.fields;manager.deleteConnector({from:uiFields.fromid.val(),to:uiFields.toid.val(),id:uiFields.id.val()});ui.hide()},dialog;manager.getFromEnv("animationManager").setAnimationState("uichange");if(!ui){noUIfound=true}ui=manager.addGraphicalElement(uiName,manager.createHtmlDialog(315,215,(function(){var uiFields=ui&&ui.fields,submitObj;if(uiFields){submitObj={from:uiFields.fromid.val(),to:uiFields.toid.val(),id:uiFields.id.val(),label:uiFields.label.val(),color:uiFields.color.val(),alpha:uiFields.alpha.val(),link:uiFields.url.val(),tooltext:uiFields.tooltext.val(),strength:uiFields.strength.val(),arrowatstart:uiFields.arratstart.val(),arrowatend:uiFields.arratend.val(),dashed:uiFields.dashed.val(),dashlen:uiFields.dashlen.val(),dashgap:uiFields.dashgap.val()};if(submitObj.from){if(submitObj.to){if(submitObj.from!==submitObj.to){edit?manager.editConnector(submitObj):manager.addConnector(submitObj);ui.enableFields();ui.hide();ui.clearFields()}else{ui.error.attr({text:"Connector cannot start and end at the same node!"});fields.fromid.focus()}}else{ui.error.attr({text:"Please select a valid connector end."});fields.toid.focus()}}else{ui.error.attr({text:"Please select a valid connector start."});fields.fromid.focus()}}}),(function(){ui.error.attr({text:_lib.BLANKSTRING});ui.enableFields();ui.hide()}),onDelete,ui));if(noUIfound){dialog=ui.dialog;labels=ui.labels={};fields=ui.fields={}}ui.config=config;if(!ui.enableFields){ui.enableFields=function(){var key;for(key in config){if(config[key]&&config[key].disabled&&fields[key]){fields[key].element.removeAttribute("disabled")}}}}if(!ui.clearFields){ui.clearFields=function(){var key,uiFields=ui.fields;for(key in uiFields){if(!uiFields[key].element.disabled){uiFields[key].element.value=_lib.BLANKSTRING}}}}(0,_lib.fcEach)(manager.connectorUpdateUIDefinition,(function(def){var key=def.key,attr=config[key]||{};if(!labels[key]){labels[key]=renderer.html(LABEL,{x:def.x,y:def.y,width:def.labelWidth||45,text:def.text},labelStyle,dialog)}if(def.noInput){return}if(!(field=fields[key])){field=fields[key]=renderer.html(def.inputType||INPUT,{y:-2+(def.inputPaddingTop||0),x:def.labelWidth&&def.labelWidth+5||50,width:def.inputWidth||50,name:key||_lib.BLANKSTRING},inputStyle);if(def.inputType!=="select"){field.attr({type:def.type||"text"}).on("keyup",ui.handleKeyPress)}field.add(labels[key])}if(innerHTML=(0,_lib.pluck)(attr.innerHTML,def.innerHTML)){field.attr({innerHTML:innerHTML})}if((value=(0,_lib.pluck)(attr.val,def.val))!==UNDEF){field.val(value)}if(attr.disabled){field.attr({disabled:"disabled"})}else{field.element&&(field.element.disabled=false)}}));ui.checkDash=function(){var showHideFn=fields.dashed&&fields.dashed.val()?"show":"hide";labels.dashgap&&labels.dashgap[showHideFn]();fields.dashgap&&fields.dashgap[showHideFn]();labels.dashlen&&labels.dashlen[showHideFn]();fields.dashlen&&fields.dashlen[showHideFn]()};ui.checkDash();fields.dashed.on("fc-click",ui.checkDash);if(!ui.error){ui.error=renderer.html("span",{color:"ff0000",x:10,y:170},UNDEF,dialog)}ui.removeItem[edit?"show":"hide"]()};_proto.showNodeUpdateUI=function showNodeUpdateUI(){return _showNodeUpdateUI.apply(this,arguments)};_proto.addNode=function addNode(dataObj){var manager=this,datasets=manager.getChildren("dataset"),len=datasets.length,dataset,index,idFound,id,i,eventArgs,sourceEvent=NODE_ADDED,chart=manager.getFromEnv("chart"),dataStore;for(i=0;i<len;i++){dataset=datasets[i]||{};id=dataset.config.datasetIndex;if(id!==UNDEF){id=id.toString()}if(id===dataObj.datasetId){idFound=true;break}}if(dataset&&idFound){dataStore=dataset.components.data;dataObj.add=true;index=dataStore.length;eventArgs={index:index,dataIndex:index,link:dataObj.link,y:dataObj.y,x:dataObj.x,shape:dataObj.shape,label:dataObj.name,toolText:dataObj.tooltext,id:dataObj.id,datasetIndex:dataset.config.datasetIndex,datasetName:dataset.config.seriesname,sourceType:"dataplot"};makeShapeSpecificModifications(eventArgs,dataObj);dataset._setConfigure(index,dataObj);dataset.parsePlotAttributes(index);dataset._drawNode(index);dataset.setState("dirty",true);chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);dataset._setupKdTree()}};_proto.updateNode=function updateNode(updateObj){var groupManager=this,datasets=groupManager.getChildren("dataset"),len=datasets.length,dataLen,idFound,dataset,dataObj,i,dataStore,eventArgs,sourceEvent=NODE_UPDATED,chart=groupManager.getFromEnv("chart"),j;updateObj.update=true;for(i=0;i<len;i++){dataset=datasets[i];dataStore=dataset.components.data||[];dataLen=dataStore.length;for(j=0;j<dataLen;j++){dataObj=dataStore[j];if(dataObj.config.id===updateObj.id){idFound=true;break}}}if(dataset&&idFound){eventArgs={index:j,dataIndex:j,link:updateObj.link,y:updateObj.y,x:updateObj.x,shape:updateObj.shape,label:updateObj.name,toolText:updateObj.tooltext,id:updateObj.id,datasetIndex:dataset.config.datasetIndex,datasetName:dataset.config.seriesname,sourceType:"dataplot"};makeShapeSpecificModifications(eventArgs,updateObj);dataset._setConfigure(j,updateObj);dataset.parsePlotAttributes(j);dataset._drawNode(j);dataset.setState("dirty",true);chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);dataset._setupKdTree()}};_proto.deleteNode=function deleteNode(id){var manager=this,node=manager.getNode(id),dataset,dataStore,startConnectors,endConnectors,i,graphics,connector,dataObj,prop,len,eventArgs,config,idFound,sourceEvent=NODE_DELETED,chart=manager.getFromEnv("chart");if(node){dataset=node.dataset;dataStore=dataset.components.data;startConnectors=node.config.startConnectors;endConnectors=node.config.endConnectors;len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];if(dataObj.config.id===id){idFound=true;break}}if(idFound===true){graphics=dataObj.graphics;removeElems(graphics);for(prop in startConnectors){connector=startConnectors[prop]||{};graphics=connector.graphics;removeElems(graphics);delete connector.graphics;connector.removed=true}for(prop in endConnectors){connector=endConnectors[prop]||{};graphics=connector.graphics;removeElems(graphics);delete connector.graphics;connector.removed=true}dataObj.removed=true;config=dataObj.config||{};eventArgs={index:i,dataIndex:i,link:config.link,y:config.y,x:config.x,shape:config.shape,label:config.displayValue,toolText:config.toolText,id:config.id,datasetIndex:dataset.config.datasetIndex,datasetName:dataset.config.seriesname,sourceType:"dataplot"};makeShapeSpecificModifications(eventArgs,{width:config.width,height:config.height,radius:config.radius,numsides:config.numSides});chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);dataset._setupKdTree()}}};_proto.addConnector=function addConnector(connectorObj){var manager=this,connectors=manager.getChildren("connector")[0],sourceEvent=CONNECTOR_ADDED,eventArgs,chart=manager.getFromEnv("chart");connectorObj.add=true;connectors._setConfigure(connectors.components.data.length,connectorObj);eventArgs={arrowAtEnd:Boolean(connectorObj.arrowatend),arrowAtStart:Boolean(connectorObj.arrowatstart),fromNodeId:connectorObj.from,id:connectorObj.id,label:connectorObj.label,link:connectorObj.connectorLink,sourceType:"connector",toNodeId:connectorObj.to};chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);connectors.asyncDraw()};_proto.editConnector=function editConnector(connectorObj){var manager=this,connectorSets=manager.getChildren("connector"),i,conLen,data,dataObj,fromId,toId,j,idFound,connectors,config,eventArgs,chart=manager.getFromEnv("chart"),sourceEvent=CONNECTOR_UPDATED,len=connectorSets.length;for(i=0;i<len;i++){connectors=connectorSets[i];data=connectors&&connectors.components.data||[];conLen=data.length;for(j=0;j<conLen;j++){dataObj=data[j];config=dataObj.config;fromId=config.from;toId=config.to;if(fromId===connectorObj.from&&toId===connectorObj.to){idFound=true;break}}}connectorObj.update=true;if(idFound){connectors._setConfigure(j,connectorObj);eventArgs={arrowAtEnd:Boolean(connectorObj.arrowatend),arrowAtStart:Boolean(connectorObj.arrowatstart),fromNodeId:connectorObj.from,id:connectorObj.id,label:connectorObj.label,link:connectorObj.link,sourceType:"connector",toNodeId:connectorObj.to};chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);connectors.asyncDraw()}};_proto.deleteConnector=function deleteConnector(config){var manager=this,connectorSets=manager.getChildren("connector"),i,j,dataObj,dataStore,dataLen,connFound=false,connectors,eventArgs,connConfig,len=connectorSets.length,sourceEvent=CONNECTOR_DELETED,chart=manager.getFromEnv("chart");for(i=0;i<len;i++){connectors=connectorSets[i];dataStore=connectors.components.data;dataLen=dataStore.length;for(j=0;j<dataLen;j++){dataObj=dataStore[j];if(dataObj.config.from===config.from&&dataObj.config.to===config.to){connFound=true;break}}}if(connFound){connConfig=dataObj.config||{};eventArgs={arrowAtEnd:connConfig.arrowAtEnd,arrowAtStart:connConfig.arrowAtStart,fromNodeId:connConfig.from,id:connConfig.id,label:connConfig.label,link:connConfig.connectorLink,sourceType:"connector",toNodeId:connConfig.to};removeElems(dataObj.graphics);delete dataObj.graphics;dataObj.removed=true;chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs)}};_proto.createHtmlDialog=function createHtmlDialog(dialogWidth,dialogHeight,onsubmit,oncancel,onremove,cacheUI){var manager=this,conf=manager.getFromEnv("chartConfig"),inCanvasStyle=manager.getFromEnv("style").inCanvasStyle||{},chartWidth=Number(conf.width),chartHeight=Number(conf.height),animationManager=manager.getFromEnv("animationManager"),padding=5,uiok,uicancel,uiremove,dialogAttrs,okAttrs,cancelAttrs,removeAttrs,buttonStyle={color:(0,_lib.hashify)(inCanvasStyle.color),textAlign:"center",paddingTop:1+PX,border:"1px solid #cccccc",borderRadius:4+PX,cursor:_lib.preDefStr.POINTER,_cursor:"hand",backgroundColor:_lib.HASHSTRING+COLOR_FFFFFF,zIndex:21,"-webkit-border-radius":4+PX},ui=cacheUI,attrObj;attrObj={width:chartWidth,height:chartHeight};if(!cacheUI){attrObj.fill=TRANSPARENT;attrObj.type=DIV_STR}ui=animationManager.setAnimation({el:cacheUI||"html",attr:attrObj,component:manager,label:"ui",state:DATASETSTATE,css:{fontSize:10+PX,lineHeight:15+PX,fontFamily:inCanvasStyle.fontFamily,display:"block"},container:!cacheUI&&manager.getFromEnv("chart-container")});attrObj={width:chartWidth,height:chartHeight,opacity:.3};if(!ui.veil){attrObj.fill=COLOR_000000;attrObj.type=DIV_STR}ui.veil=animationManager.setAnimation({el:ui.veil||"html",attr:attrObj,component:manager,state:DATASETSTATE,label:"uiveil",container:!ui.veil&&ui});dialogAttrs={x:(chartWidth-dialogWidth)/2,y:(chartHeight-dialogHeight)/2,width:dialogWidth,height:dialogHeight};if(!ui.dialog){dialogAttrs.fill=COLOR_EFEFEF;dialogAttrs.strokeWidth=1;dialogAttrs.stroke=COLOR_000000;dialogAttrs.type=DIV_STR}ui.dialog=animationManager.setAnimation({el:ui.dialog||"html",attr:dialogAttrs,component:manager,state:DATASETSTATE,label:"uidialog",container:!ui.dialog&&ui,css:{borderRadius:5+PX,boxShadow:"1px 1px 3px #000000","-webkit-border-radius":5+PX,"-webkit-box-shadow":"1px 1px 3px #000000",filter:'progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color="#000000")'}});okAttrs={x:dialogWidth-70-padding,y:dialogHeight-23-padding,width:65,height:17};if(!ui.ok){okAttrs.text=SUBMIT_STR;okAttrs.tabIndex=1;okAttrs.type=DIV_STR}uiok=animationManager.setAnimation({el:ui.ok||"html",state:DATASETSTATE,attr:okAttrs,component:manager,label:"uiok",css:buttonStyle,container:!ui.ok&&ui.dialog});!ui.ok&&(ui.ok=uiok)&&uiok.on("fc-mousedown",onsubmit);cancelAttrs={x:dialogWidth-140-padding,y:dialogHeight-23-padding,width:65,height:17};if(!ui.cancel){cancelAttrs.text=CANCEL_STR;cancelAttrs.tabIndex=2;cancelAttrs.type=DIV_STR}uicancel=animationManager.setAnimation({el:ui.cancel||"html",state:DATASETSTATE,attr:cancelAttrs,component:manager,label:"uicancel",css:buttonStyle,container:!ui.cancel&&ui.dialog});!ui.cancel&&(ui.cancel=uicancel)&&uicancel.on("fc-mousedown",oncancel);removeAttrs={x:dialogWidth-210-padding,y:dialogHeight-23-padding,width:65,height:17};if(!ui.removeItem){removeAttrs.text=DELETE_STR;removeAttrs.tabIndex=3;removeAttrs.type=DIV_STR}uiremove=animationManager.setAnimation({el:ui.removeItem||"html",state:DATASETSTATE,attr:removeAttrs,component:manager,label:"uiremove",css:buttonStyle,container:!ui.removeItem&&ui.dialog});!ui.removeItem&&(ui.removeItem=uiremove)&&uiremove.on("fc-mousedown",onremove);if(!ui.handleKeyPress){ui.handleKeyPress=function(e){if(e.keyCode===13){ui.ok.element&&onsubmit(e)}else if(e.keyCode===27){ui.cancel.element&&oncancel(e)}}}return ui};_proto.getNode=function getNode(nodeId){var node,nodes={},datasets=this.getChildren("dataset");for(var i=0,len=datasets.length;i<len;i++){if(nodeId){if(node=datasets[i].getNode(nodeId)){return node}}else{Object.assign(nodes,datasets[i].getNode())}}return!nodeId&&nodes};_proto.createContainer=function createContainer(){var manager=this,animationManager=manager.getFromEnv("animationManager"),keys=["connectorGroup","defaultVcanvasGroup","vcanvasLabelGroup","cloneGroup"],parentChildContainers=manager.getLinkedParent().getChildContainer();keys.forEach((function(key){!manager.getChildContainer(key)&&manager.addChildContainer(key,animationManager.setAnimation({el:"group",attr:{name:"manager-"+key},component:manager,container:parentChildContainers[key]||parentChildContainers.defaultVcanvasGroup}))}));!manager.getContainer("waitContainer")&&manager.addContainer("waitContainer",animationManager.setAnimation({el:"group",attr:{name:"manager-waitContainer"},container:parentChildContainers.defaultVcanvasGroup,component:manager}))};_proto.draw=function draw(){var manager=this,graphicalMap={cacheUpdateUI:[350,215],cacheLabelDeleteUI:[250,100],cacheLabelUpdateUI:[350,205],cacheConnectorUpdateUIedit:[315,215],cacheConnectorUpdateUInew:[315,215]},graphics,elem;if(!manager.getState("configured")){DATASETSTATE=UPDATE_STR;for(graphics in graphicalMap){if((elem=manager.getGraphicalElement(graphics))&&elem.isVisible()){if(graphics==="cacheUpdateUI"){var fields=elem.fields,ele=fields.image,isChecked=ele.val();graphicalMap[graphics][1]=isChecked?250:215}manager.createHtmlDialog(graphicalMap[graphics][0],graphicalMap[graphics][1],UNDEF,UNDEF,UNDEF,elem)}}DATASETSTATE=APPEARING_STR}manager.setState("configured",false);manager.createContainer()};_proto.getDataLimits=function getDataLimits(){var datasets=this.getChildren("dataset"),i,yMin=+Infinity,yMax=-Infinity,xMax=-Infinity,xMin=+Infinity,conf;for(i=0;i<datasets.length;i++){conf=datasets[i].config;yMax=Math.max(yMax,conf.yMax);yMin=Math.min(yMin,conf.yMin);xMax=Math.max(xMax,conf.xMax);xMin=Math.min(xMin,conf.xMin)}return{max:yMax,min:yMin,xMax:xMax,xMin:xMin}};_proto.isVisible=function isVisible(){return!this.isNotVisible};_proto.childChanged=function childChanged(){return this};_proto.hideWaitElem=function hideWaitElem(){this.getGraphicalElement("waitElement")&&this.getGraphicalElement("waitElement").hide()};_proto.clearLongPress=function clearLongPress(){var manager=this;clearTimeout(manager.config._longpressactive);delete manager.config._longpressactive};_proto.triggerLabelUI=function triggerLabelUI(ele,labelObj){var manager=this;manager.config._longpressactive=setTimeout((function(){ele.data("fire_click_event",0);if(!ele.data("viewMode")){manager.showLabelDeleteUI(labelObj)}}),CLEAR_TIME_1000)};_proto.triggerConnectorUI=function triggerConnectorUI(ele){var manager=this,dataset=ele.data("dataset"),config=ele.data(_lib.preDefStr.configStr),options=config||{};manager.config._longpressactive=setTimeout((function(){ele.data("fire_click_event",0);if(!ele.data("viewMode")){manager.showConnectorUpdateUI({fromid:{val:options.from,innerHTML:OPTIONSTR+options.from+OPTIONCLOSESTR,disabled:true},toid:{val:options.to,innerHTML:OPTIONSTR+options.to+OPTIONCLOSESTR,disabled:true},datasetIndex:dataset.config.datasetIndex,index:config.index,arratstart:{val:Boolean((0,_lib.pluckNumber)(options.arrowatstart,1))},arratend:{val:Boolean((0,_lib.pluckNumber)(options.arrowatend,1))},dashed:{val:(0,_lib.pluckNumber)(options.dashed)},dashgap:{val:options.dashgap},dashlen:{val:options.dashlen},label:{val:options.label},tooltext:{val:options.tooltext},id:{val:dataset.config.id,disabled:true},strength:{val:options.conStrength},alpha:{val:options.alpha},color:{val:options.color.FCcolor.color}},true)}}),CLEAR_TIME_1000)};_proto.deleteLabel=function deleteLabel(i){var manager=this,labels=manager.getChildren("labels")[0],index=(0,_lib.pluckNumber)(i,labels.config.lastTappedLabelIndex),labelObj=labels.components.data[index],labelElement,trackerElement,chart=manager.getFromEnv("chart"),sourceEvent=LABEL_DELETED,eventArgs;labelElement=labelObj.graphics.element;trackerElement=labelObj.graphics.trackerElement;if(labelElement){eventArgs=labelElement.data("eventArgs");labelElement.remove();trackerElement&&trackerElement.remove();delete labelObj.graphics}chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs));chart.fireChartInstanceEvent(sourceEvent,eventArgs);labelObj.removed=true};_proto.showLabelDeleteUI=function showLabelDeleteUI(label){var manager=this,ui=manager.getGraphicalElement("cacheLabelDeleteUI");manager.getChildren("labels")[0].config.lastTappedLabelIndex=label.config.index;if(!ui){ui=manager.addGraphicalElement("cacheLabelDeleteUI",manager.createHtmlDialog(250,100,UNDEF,(function(){ui.hide()}),(function(){manager.deleteLabel();ui.hide()})));ui.message=manager.getFromEnv("paper").html("span",{x:10,y:10,width:230,height:80}).add(ui.dialog);ui.ok.hide();ui.removeItem.translate(175).show()}else{ui.show()}ui.message.attr({text:'Would you really like to delete the label: "'+label.config.text+'"?'})};_proto.drawWaitingRing=function drawWaitingRing(dataObj,datasetIndex){var manager=this,config=dataObj.config,conf=manager.getChildren("dataset")[datasetIndex].config,waitElement=manager.getGraphicalElement("waitElement");manager.clearLongPress();waitElement=manager.getFromEnv("animationManager").setAnimation({el:waitElement||"ringpath",attr:{ringpath:[config._xPos,config._yPos,8,11,0,0],fill:(0,_lib.toRaphaelColor)({alpha:"100,100",angle:120,color:"CCCCCC,FFFFFF",ratio:"30,50"}),"stroke-width":0},container:manager.getContainer("waitContainer"),component:manager});if(!manager.getGraphicalElement("waitElement")){manager.addGraphicalElement("waitElement",waitElement)}waitElement.show().animate({ringpath:[config._xPos,config._yPos,8,11,0,6.28]},CLEAR_TIME_1000);manager.config._longpressactive=setTimeout((function(){var seriesName=conf.name!==BLANK&&conf.name!==UNDEF?conf.name+_lib.preDefStr.BLANKSPACE:BLANK,seriesId=conf.id!==UNDEF?(seriesName?_lib.COMMASTRING:seriesName)+conf.id:BLANK;waitElement&&waitElement.hide();manager.showNodeUpdateUI({x:{value:config.x},y:{value:config.y},draggable:{value:(0,_lib.getFirstValue)(config.allowdrag,1)},color:{value:config.color},alpha:{value:config.alpha},label:{value:(0,_lib.getFirstValue)(config.label,config.name)},tooltip:{value:config.toolText},shape:{value:shapesInfo[config.shape]},rectWidth:{value:config.width},rectHeight:{value:config.height},circPolyRadius:{value:config.radius},polySides:{value:config.numsides},image:{value:config.imageNode},imgWidth:{value:config.imageWidth},imgHeight:{value:config.imageHeight},imgAlign:{value:config.imageAlign},imgUrl:{value:config.imageURL},id:{value:config.id,disabled:true},link:{value:config.link},dataset:{innerHTML:'<option value="'+seriesId+'">'+seriesName+seriesId+"</option>",disabled:true},datasetIndex:datasetIndex},true)}),CLEAR_TIME_1000)};_proto.drawNodeConnectors=function drawNodeConnectors(connectorsObj){var i,datasetIndex,connectorSet,connector,fromObj,toObj;if(!connectorsObj){return}for(i in connectorsObj){connector=connectorsObj[i];if(connector){datasetIndex=connector.config.datasetIndex;fromObj=connector.config.fromPointObj;toObj=connector.config.toPointObj;connectorSet=this.getChildren("connector")[datasetIndex];if(connectorSet){connectorSet&&connectorSet.parsePlotAttributes(connector,fromObj,toObj);connectorSet&&connectorSet.drawConnector(connector,fromObj,toObj)}}}};_proto._clearConnectors=function _clearConnectors(){var nodes=this.getNode(),id,startConnectors,endConnectors,graphics,j,node;for(id in nodes){node=nodes[id];if(node){startConnectors=node.config.startConnectors||{};endConnectors=node.config.endConnectors||{};for(j in startConnectors){graphics={graphics:startConnectors[j].graphics||{}};_lib.componentDispose.call(graphics)}for(j in endConnectors){graphics={graphics:endConnectors[j].graphics||{}};_lib.componentDispose.call(graphics)}}}};_proto.getJSONData=function getJSONData(){var children=this.getChildren(),nodeSets=children.dataset,connectorSets=children.connector,labelSets=children.labels,jsonData={},i,len,dataset;jsonData.dataset=[];jsonData.connectors=[];jsonData.labels=[];for(i=0,len=nodeSets&&nodeSets.length;i<len;i++){dataset=nodeSets[i];if(!jsonData.dataset[i]){jsonData.dataset[i]=(0,_lib.extend2)({},dataset.JSONData)}jsonData.dataset[i].data=dataset.getJSONData()}for(i=0,len=connectorSets&&connectorSets.length;i<len;i++){dataset=connectorSets[i];if(!jsonData.connectors[i]){jsonData.connectors[i]=(0,_lib.extend2)({},dataset.JSONData)}jsonData.connectors[i].connector=dataset.getJSONData()}for(i=0,len=labelSets&&labelSets.length;i<len;i++){dataset=labelSets[i];if(!jsonData.labels[i]){jsonData.labels[i]={label:[]}}jsonData.labels[i].label=dataset.getJSONData()}return jsonData};return DragNodeGroup}(_componentInterface.ComponentInterface);var _default=DragNodeGroup;exports.default=_default;