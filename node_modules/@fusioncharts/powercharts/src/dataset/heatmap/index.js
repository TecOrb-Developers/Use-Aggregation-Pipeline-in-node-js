"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _componentInterface=require("@fusioncharts/core/src/component-interface");var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _index=_interopRequireDefault(require("./index.animation"));var _schedular=require("@fusioncharts/core/src/schedular");var HUNDREDSTRING="100",PLOTGRADIENTCOLOR="plotGradientColor",PLOTBORDERCOLOR="plotBorderColor",COLOR_FFFFFF="FFFFFF",SHOWSHADOW="showShadow",UNDEF,MOUSEOVER="mouseOver",MOUSEOUT="mouseOut",NORMAL="normal",PXSTRING="px",pStr=_lib.preDefStr.pStr,sStr=_lib.preDefStr.sStr,COMMA=",",BOLDSTARTTAG="<b>",BOLDENDTAG="</b>",BREAKSTRING="<br />",visibleStr="visible",miterStr=_lib.preDefStr.miterStr,hiddenStr=_lib.preDefStr.hiddenStr,showHoverEffectStr=_lib.preDefStr.showHoverEffectStr,POSITION_START=_lib.preDefStr.POSITION_START,POSITION_TOP=_lib.preDefStr.POSITION_TOP,POSITION_END=_lib.preDefStr.POSITION_END,POSITION_BOTTOM=_lib.preDefStr.POSITION_BOTTOM,SETROLLOVERATTR="setRolloverAttr",SETROLLOUTATTR="setRolloutAttr",EVENTARGS="eventArgs",POINTER="pointer",tlLabelStr="tlLabel",blLabelStr="blLabel",trLabelStr="trLabel",brLabelStr="brLabel",ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",DEFAULT_CURSOR=_lib.preDefStr.DEFAULT,MAX_PERCENT_SPACE=.9,POINT_FIVE=.5,GUTTER_4=4,defined=function defined(obj){return obj!==UNDEF&&obj!==null},createGroup=function createGroup(attr,parentContainer,dataset){return dataset.getFromEnv("animationManager").setAnimation({el:"group",attr:attr,container:parentContainer,component:dataset,label:"group"})},TRACKER_FILL="rgba(192,192,192,"+(_lib.isIE?.002:1e-6)+")",HTP=_lib.hasTouch?_lib.TOUCH_THRESHOLD_PIXELS:_lib.CLICK_THRESHOLD_PIXELS,pInt=function pInt(s,mag){return parseInt(s,mag||10)},NONE="none",_rolloverResponseSetter=function _rolloverResponseSetter(chart,data,event,onlyHoverEffect,dataset){var dataGraphics=data.graphics,animationManager=chart.getFromEnv("animationManager"),elem=dataGraphics&&dataGraphics.element,elData=elem&&elem.getData();if(elData.draged!==true){animationManager.setAnimationState(MOUSEOVER);elem&&elData.showHoverEffect!==0&&animationManager.setAnimation({el:elem,attr:elem.getData().setRolloverAttr,component:dataset});!onlyHoverEffect&&elem&&chart.plotEventHandler(elem,event,ROLLOVER)}},_rolloutResponseSetter=function _rolloutResponseSetter(chart,data,event,onlyHoverEffect,dataset){var dataGraphics=data.graphics,animationManager=chart.getFromEnv("animationManager"),elem=dataGraphics&&dataGraphics.element,elData=elem&&elem.getData();if(elData.draged!==true){animationManager.setAnimationState(MOUSEOUT);elem&&elData.showHoverEffect!==0&&animationManager.setAnimation({el:elem,attr:elem.getData().setRolloutAttr,component:dataset});!onlyHoverEffect&&elem&&chart.plotEventHandler(elem,event,ROLLOUT)}},mathMax=Math.max,mathMin=Math.min,mathAbs=Math.abs;(0,_dependencyManager.addDep)({name:"heatmapAnimation",type:"animationRule",extension:_index.default});var HeatMapDataset=function(_ComponentInterface){(0,_inheritsLoose2.default)(HeatMapDataset,_ComponentInterface);function HeatMapDataset(){var _this;_this=_ComponentInterface.call(this)||this;_this.components={};_this.graphics={};_this.dataSetArray=[];return _this}var _proto=HeatMapDataset.prototype;_proto.getType=function getType(){return"dataset"};_proto.getName=function getName(){return"heatMap"};_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return false}this.trimData(datasetJSON);this.config.JSONData=datasetJSON;var dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=conf.JSONData,setDataArr=JSONData.data,len=setDataArr&&setDataArr.length,chartAttr=dataSet.getFromEnv("chart-attrib"),colorM=dataSet.getFromEnv("color-manager"),plotBorderDash=(0,_lib.pluckNumber)(JSONData.dashed,chartAttr.plotborderdashed),setData,setValue,dataObj,config,dataStore=dataSet.components.data,plotGrid=dataSet.components.plotGrid=[],isBar=chart.isBar,is3D=chart.config.is3D,enableAnimation,i,r,c,maxValue=-Infinity,minValue=+Infinity,totalRows=dataSet.getFromEnv("totalRows"),totalColumns=dataSet.getFromEnv("totalColumns");for(r=0;r<totalRows;r++){plotGrid.push([]);for(c=0;c<totalColumns;c++){plotGrid[r].push([])}}dataSet.setState("visible",(0,_lib.pluckNumber)(dataSet.getState("visible"),dataSet.config.JSONData.visible,!Number(dataSet.config.JSONData.initiallyhidden),1)===1);conf.showplotborder=(0,_lib.pluckNumber)(chartAttr.showplotborder,is3D?0:1);conf.plotDashLen=(0,_lib.pluckNumber)(chartAttr.plotborderdashlen,5);conf.plotDashGap=(0,_lib.pluckNumber)(chartAttr.plotborderdashgap,4);conf.showTextOutLine=(0,_lib.pluckNumber)(chartAttr.textoutline,0);conf.plotfillAngle=(0,_lib.pluckNumber)(360-chartAttr.plotfillangle,isBar?180:90);conf.plotFillAlpha=(0,_lib.pluck)(JSONData.alpha,chartAttr.plotfillalpha,HUNDREDSTRING);conf.plotColor=(0,_lib.pluck)(JSONData.color,colorM.getPlotColor(dataSet.index||dataSet.positionIndex));conf.isRoundEdges=(0,_lib.pluckNumber)(chartAttr.useroundedges,0);conf.plotRadius=(0,_lib.pluckNumber)(chartAttr.useRoundEdges,conf.isRoundEdges?1:0);conf.plotFillRatio=(0,_lib.pluck)(JSONData.ratio,chartAttr.plotfillratio);conf.plotgradientcolor=(0,_lib.getDefinedColor)(chartAttr.plotgradientcolor,colorM.getColor(PLOTGRADIENTCOLOR));conf.plotBorderAlpha=conf.showplotborder?(0,_lib.pluck)(chartAttr.plotborderalpha,conf.plotFillAlpha,HUNDREDSTRING):0;conf.plotBorderColor=(0,_lib.pluck)(chartAttr.plotbordercolor,is3D?COLOR_FFFFFF:colorM.getColor(PLOTBORDERCOLOR));conf.plotBorderThickness=(0,_lib.pluckNumber)(chartAttr.plotborderthickness,1);conf.plotBorderDashStyle=plotBorderDash?(0,_lib.getDashStyle)(conf.plotDashLen,conf.plotDashGap):NONE;conf.showValues=(0,_lib.pluckNumber)(JSONData.showvalues,chartAttr.showvalues,1);conf.valuePadding=(0,_lib.pluckNumber)(chartAttr.valuepadding,2);conf.enableAnimation=enableAnimation=(0,_lib.pluckNumber)(chartAttr.animation,chartAttr.defaultanimation,1);conf.animation=!enableAnimation?false:{duration:(0,_lib.pluckNumber)(chartAttr.animationduration,1)*1e3};conf.transposeAnimation=(0,_lib.pluckNumber)(chartAttr.transposeanimation,enableAnimation);conf.transposeAnimDuration=(0,_lib.pluckNumber)(chartAttr.transposeanimduration,.2)*1e3;conf.showShadow=conf.isRoundEdges||is3D?(0,_lib.pluckNumber)(chartAttr.showshadow,1):(0,_lib.pluckNumber)(chartAttr.showshadow,colorM.getColor(SHOWSHADOW));conf.showHoverEffect=(0,_lib.pluckNumber)(chartAttr.plothovereffect,chartAttr.showhovereffect,UNDEF);conf.showTooltip=(0,_lib.pluckNumber)(chartAttr.showtooltip,1);conf.definedGroupPadding=Math.max((0,_lib.pluckNumber)(chartAttr.plotspacepercent),0);conf.plotSpacePercent=Math.max((0,_lib.pluckNumber)(chartAttr.plotspacepercent,20)%100,0);conf.maxColWidth=(0,_lib.pluckNumber)(isBar?chartAttr.maxbarheight:chartAttr.maxcolwidth,50);conf.plotPaddingPercent=(0,_lib.pluckNumber)(chartAttr.plotpaddingpercent);conf.rotateValues=(0,_lib.pluckNumber)(chartAttr.rotatevalues)?270:0;conf.placeValuesInside=(0,_lib.pluckNumber)(chartAttr.placevaluesinside,0);conf.defaultPadding={left:.5,right:.5,top:.5,bottom:.5};conf.use3DLighting=(0,_lib.pluckNumber)(chartAttr.use3dlighting,1);conf.parentYAxis=(0,_lib.pluck)(JSONData.parentyaxis&&JSONData.parentyaxis.toLowerCase(),pStr)===sStr?1:0;if(!dataStore){dataStore=dataSet.components.data=[]}for(i=0;i<len;i++){setData=setDataArr&&setDataArr[i];dataObj=dataStore[i];config=dataObj&&dataObj.config;if(!dataObj){dataObj=dataStore[i]={graphics:{}}}if(!dataObj.config){config=dataStore[i].config={}}config.setValue=setValue=dataSet.getFromEnv("number-formatter").getCleanValue(setData.value);maxValue=Math.max(maxValue,setValue);minValue=Math.min(minValue,setValue)}conf.maxValue=maxValue;conf.minValue=minValue;dataSet._setConfigure();dataSet.setState("dirty",true)};_proto._setConfigure=function _setConfigure(){var dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=dataSet.config.JSONData,setDataArr=JSONData.data,len=setDataArr&&setDataArr.length,chartConfig=dataSet.getFromEnv("chartConfig"),chartAttr=dataSet.getFromEnv("chart-attrib"),showplotborder=conf.showplotborder,plotColor=conf.plotColor=dataSet.getFromEnv("color-manager").getPlotColor(dataSet.index||dataSet.positionIndex),showTooltip=(0,_lib.pluckNumber)(chartAttr.showtooltip,1),tooltipSepChar=(0,_lib.parseUnsafeString)((0,_lib.pluck)(chartAttr.tooltipsepchar,": ")),usePlotGradientColor=(0,_lib.pluckNumber)(chartAttr.useplotgradientcolor,1),formatedVal,parserConfig,setTooltext,macroIndices,toolText=_lib.BLANKSTRING,plotDashLen=conf.plotDashLen,plotDashGap=conf.plotDashGap,plotBorderThickness=conf.plotBorderThickness,isRoundEdges=conf.isRoundEdges,showHoverEffect=conf.showHoverEffect,plotfillAngle=conf.plotfillAngle,plotFillAlpha=conf.plotFillAlpha,plotFillRatio=conf.plotFillRatio,plotBorderAlpha=conf.plotBorderAlpha,plotBorderColor=conf.plotBorderColor,plotBorderDashStyle,setData,setValue,dataObj,config,colorRange=dataSet.getFromEnv("chartColorRange"),column,row,rowid,columnid,mapByPercent=conf.mapByPercent=(0,_lib.pluckNumber)(colorRange.mapbypercent,0),mapByCategory=conf.mapByCategory=(0,_lib.pluckNumber)(chartAttr.mapbycategory,0),useColorGradient=colorRange&&(0,_lib.pluckNumber)(colorRange.gradient),hoverColor,hoverAlpha,hoverGradientColor,hoverRatio,hoverAngle,hoverBorderColor,hoverBorderAlpha,hoverBorderThickness,hoverBorderDashed,hoverBorderDashGap,hoverBorderDashLen,hoverDashStyle,hoverColorArr,numberFormatter=dataSet.getFromEnv("number-formatter"),setDisplayValue,isBar=chart.isBar,is3D=chart.config.is3D,parentYAxis=conf.parentYAxis,i,maxValue=conf.maxValue,minValue=conf.minValue,heatRange,colorObj,tlType=(0,_lib.getValidValue)(chartAttr.tltype,_lib.BLANK),trType=(0,_lib.getValidValue)(chartAttr.trtype,_lib.BLANK),blType=(0,_lib.getValidValue)(chartAttr.bltype,_lib.BLANK),brType=(0,_lib.getValidValue)(chartAttr.brtype,_lib.BLANK),tlLabel,trLabel,blLabel,brLabel,tlTypeToolText=_lib.BLANK,trTypeToolText=_lib.BLANK,blTypeToolText=_lib.BLANK,brTypeToolText=_lib.BLANK,percentValue,toolTextValue,value,minMaxArray,minMaxArrayLen,toolTipValue,setDataDashed,setDataPlotDashLen,setDataPlotDashGap,colorManager=chart.getFromEnv("colorManager"),font,fontColor,fontSize,fontWeight,fontStyle;font=chartConfig.style.inCanfontFamily;fontSize=pInt(chartConfig.style.inCanfontSize,10);fontColor=chartConfig.style.inCancolor;fontWeight=NORMAL;fontStyle=NORMAL;heatRange=maxValue-minValue;if(!conf.eventAttached){dataSet.addExtEventListener("legendUpdate",(function(e,d){if(d.component==="legend"){if(d.legendItem.hasState("hidden")){dataSet.show(d.legendItem,e)}else{dataSet.hide(d.legendItem,e)}}else{minMaxArray=d.maxMinArray;minMaxArrayLen=minMaxArray.length;for(i=0;i<minMaxArrayLen;i++){dataSet.updatePlot(minMaxArray[i].min,minMaxArray[i].max)}}}),colorManager);conf.eventAttached=true}if(!useColorGradient||mapByCategory){conf.colorMap=[];if(colorRange.color){for(i=0;i<colorRange.color.length;i++){conf.colorMap[i]={config:colorRange.color[i],dataSet:dataSet};conf.colorMap[i].config.visible=true}}}for(i=0;i<len;i++){setData=setDataArr&&setDataArr[i];dataObj=dataSet.components.data[i];config=dataObj&&dataObj.config;setValue=config.setValue;config.showValue=(0,_lib.pluckNumber)(setData.showvalue,conf.showValues);config.setLink=(0,_lib.pluck)(setData.link);config.toolTipValue=toolTipValue=numberFormatter.dataLabels(setValue,parentYAxis);config.setDisplayValue=setDisplayValue=(0,_lib.parseUnsafeString)(setData.displayvalue);config.displayValue=(0,_lib.pluck)(setDisplayValue,toolTipValue);setDataDashed=(0,_lib.pluckNumber)(setData.dashed);setDataPlotDashLen=(0,_lib.pluckNumber)(setData.dashlen,plotDashLen);setDataPlotDashGap=plotDashGap=(0,_lib.pluckNumber)(setData.dashgap,plotDashGap);config.plotBorderDashStyle=setDataDashed===1?(0,_lib.getDashStyle)(setDataPlotDashLen,setDataPlotDashGap):setDataDashed===0?NONE:conf.plotBorderDashStyle;if(mapByPercent){config.percentValue=percentValue=setData.value&&Math.round((setData.value-minValue)/heatRange*1e4)/100}else{config.percentValue=UNDEF}config.dataLabelStyle=dataSet._configureDataLabelStyle(setData);config.value=value=mapByCategory?setData.colorrangelabel||setData.categoryid:mapByPercent?percentValue:config.setValue;colorObj=colorManager.getColor(value);config.colorRangeLabel=setData.colorrangelabel||colorObj.label;dataObj.legendItemIndex=colorObj.seriesIndex;config.legendItemId=colorObj.legendItemId;colorObj&&!colorObj.code&&(colorObj.code="ffffff");colorObj&&colorObj.outOfRange&&(colorObj.code="ffffff");config.plotFillAlpha=plotFillAlpha=(0,_lib.pluckNumber)(setData.alpha,colorObj&&colorObj.oriAlpha,conf.plotFillAlpha);plotColor=(0,_lib.pluck)(setData.color,colorObj&&colorObj.code);if(setValue<0&&!isRoundEdges){plotfillAngle=isBar?180-plotfillAngle:360-plotfillAngle}config.colorArr=(0,_lib.getColumnColor)(plotColor+COMMA+conf.plotgradientcolor,plotFillAlpha.toString(),plotFillRatio,plotfillAngle,isRoundEdges,plotBorderColor,plotBorderAlpha.toString(),isBar?1:0,!!is3D);config.visible=true;config.color=(0,_lib.convertColor)(plotColor,config.plotFillAlpha);config.rawPlotColor=plotColor;if(showHoverEffect!==0){hoverColor=(0,_lib.pluck)(setData.hovercolor,JSONData.hovercolor,chartAttr.plotfillhovercolor,chartAttr.columnhovercolor,plotColor);hoverAlpha=(0,_lib.pluck)(setData.hoveralpha,JSONData.hoveralpha,chartAttr.plotfillhoveralpha,chartAttr.columnhoveralpha,"25");hoverGradientColor=(0,_lib.pluck)(setData.hovergradientcolor,JSONData.hovergradientcolor,chartAttr.plothovergradientcolor,!usePlotGradientColor&&_lib.BLANKSTRING);!hoverGradientColor&&(hoverGradientColor=_lib.BLANKSTRING);hoverRatio=(0,_lib.pluck)(setData.hoverratio,JSONData.hoverratio,chartAttr.plothoverratio,plotFillRatio);hoverAngle=(0,_lib.pluckNumber)(360-setData.hoverangle,360-JSONData.hoverangle,360-chartAttr.plothoverangle,plotfillAngle);hoverBorderColor=(0,_lib.pluck)(setData.borderhovercolor,JSONData.borderhovercolor,chartAttr.plotborderhovercolor,plotBorderColor);hoverBorderAlpha=(0,_lib.pluck)(setData.borderhoveralpha,JSONData.borderhoveralpha,chartAttr.plotborderhoveralpha,plotBorderAlpha,plotFillAlpha);hoverBorderThickness=(0,_lib.pluckNumber)(setData.borderhoverthickness,JSONData.borderhoverthickness,chartAttr.plotborderhoverthickness,plotBorderThickness);hoverBorderDashed=(0,_lib.pluckNumber)(setData.borderhoverdashed,JSONData.borderhoverdashed,chartAttr.plotborderhoverdashed);hoverBorderDashGap=(0,_lib.pluckNumber)(setData.borderhoverdashgap,JSONData.borderhoverdashgap,chartAttr.plotborderhoverdashgap,plotDashLen);hoverBorderDashLen=(0,_lib.pluckNumber)(setData.borderhoverdashlen,JSONData.borderhoverdashlen,chartAttr.plotborderhoverdashlen,plotDashGap);hoverDashStyle=hoverBorderDashed?(0,_lib.getDashStyle)(hoverBorderDashLen,hoverBorderDashGap):conf.plotBorderDashStyle;if(showHoverEffect===1&&hoverColor===plotColor){hoverColor=(0,_lib.getLightColor)(hoverColor,70)}hoverColorArr=(0,_lib.getColumnColor)(hoverColor,hoverAlpha,hoverRatio,hoverAngle,isRoundEdges,hoverBorderColor,hoverBorderAlpha.toString(),isBar?1:0,!!is3D);config.setRolloutAttr={fill:(0,_lib.toRaphaelColor)(config.color),stroke:showplotborder&&(0,_lib.toRaphaelColor)(config.colorArr[1])||TRACKER_FILL,"stroke-width":plotBorderThickness,"stroke-dasharray":plotBorderDashStyle||[]};config.setRolloverAttr={fill:(0,_lib.toRaphaelColor)(hoverColorArr[0]),stroke:showplotborder&&(0,_lib.toRaphaelColor)(hoverColorArr[1])||TRACKER_FILL,"stroke-width":hoverBorderThickness,"stroke-dasharray":hoverDashStyle}}mapByPercent&&(percentValue=numberFormatter.percentValue(percentValue));config.setValue=setValue=numberFormatter.getCleanValue(setData.value);config.toolTipValue=numberFormatter.dataLabels(setValue,parentYAxis);formatedVal=config.toolTipValue;setTooltext=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.tooltext,JSONData.plottooltext,chartAttr.plottooltext),false));config.tlLabel=tlLabel=(0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.tllabel,setData.ltlabel));config.trLabel=trLabel=(0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.trlabel,setData.rtlabel));config.blLabel=blLabel=(0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.bllabel,setData.lblabel));config.brLabel=brLabel=(0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.brlabel,setData.rblabel));config.tlLabelStyle={fontFamily:(0,_lib.pluck)(colorObj.tlLabelFont,chartAttr.tlfont,font),fontSize:(0,_lib.pluckNumber)(colorObj.tlLabelFontSize,chartAttr.tlfontsize,fontSize)+PXSTRING,color:(0,_lib.convertColor)((0,_lib.pluck)(colorObj.tlLabelFontColor,chartAttr.tlfontcolor,fontColor),100),fontWeight:fontWeight,fontStyle:fontStyle};(0,_lib.setLineHeight)(config.tlLabelStyle);config.trLabelStyle={fontFamily:(0,_lib.pluck)(colorObj.trLabelFont,chartAttr.trfont,font),fontSize:(0,_lib.pluckNumber)(colorObj.trLabelFontSize,chartAttr.trfontsize,fontSize)+PXSTRING,color:(0,_lib.convertColor)((0,_lib.pluck)(colorObj.trLabelFontColor,chartAttr.trfontcolor,fontColor),100),fontWeight:fontWeight,fontStyle:fontStyle};config.brLabelStyle={fontFamily:(0,_lib.pluck)(colorObj.brLabelFont,chartAttr.brfont,font),fontSize:(0,_lib.pluckNumber)(colorObj.brLabelFontSize,chartAttr.brfontsize,fontSize)+PXSTRING,color:(0,_lib.convertColor)((0,_lib.pluck)(colorObj.brLabelFontColor,chartAttr.brfontcolor,fontColor),100),fontWeight:fontWeight,fontStyle:fontStyle};config.blLabelStyle={fontFamily:(0,_lib.pluck)(colorObj.blLabelFont,chartAttr.blfont,font),fontSize:(0,_lib.pluckNumber)(colorObj.blLabelFontSize,chartAttr.blfontsize,fontSize)+PXSTRING,color:(0,_lib.convertColor)((0,_lib.pluck)(colorObj.blLabelFontColor,chartAttr.blfontcolor,fontColor),100),fontWeight:fontWeight,fontStyle:fontStyle};setDisplayValue=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)(setData.displayvalue));toolTextValue=mapByCategory?setDisplayValue:(0,_lib.pluck)(setData.displayvalue,formatedVal);config.displayValue=(0,_lib.pluck)(setDisplayValue,percentValue,config.toolTipValue);if(tlType!==_lib.BLANK){tlTypeToolText=BOLDSTARTTAG+tlType+tooltipSepChar+BOLDENDTAG}if(trType!==_lib.BLANK){trTypeToolText=BOLDSTARTTAG+trType+tooltipSepChar+BOLDENDTAG}if(blType!==_lib.BLANK){blTypeToolText=BOLDSTARTTAG+blType+tooltipSepChar+BOLDENDTAG}if(brType!==_lib.BLANK){brTypeToolText=BOLDSTARTTAG+brType+tooltipSepChar+BOLDENDTAG}columnid=(0,_lib.getFirstValue)(setDataArr[i].columnid);rowid=(0,_lib.getFirstValue)(setDataArr[i].rowid);column=dataSet.getFromEnv("xAxis").getCategoryFromId(columnid.toLowerCase());row=dataSet.getFromEnv("yAxis").getCategoryFromId(rowid.toLowerCase());if(showTooltip){if(formatedVal===null){toolText=false}else if(setTooltext!==UNDEF){macroIndices=[1,2,5,6,7,14,93,94,95,96,97,98,112,113,114,115,116,117];parserConfig={formattedValue:formatedVal,value:setData.value,yaxisName:(0,_lib.parseUnsafeString)(chartAttr.yaxisname),xaxisName:(0,_lib.parseUnsafeString)(chartAttr.xaxisname),displayValue:setDisplayValue,percentValue:mapByPercent?percentValue:_lib.BLANK,tlLabel:tlLabel,trLabel:trLabel,blLabel:blLabel,brLabel:brLabel,rowLabel:row.tickObj&&row.tickObj.label,columnLabel:column.tickObj&&column.tickObj.label,percentDataValue:mapByPercent?percentValue:_lib.BLANK,trtype:trType,tltype:tlType,brType:brType,blType:blType,colorRangeLabel:config.colorRangeLabel};toolText=(0,_lib.parseTooltext)(setTooltext,macroIndices,parserConfig,setData,chartAttr,parserConfig)}else{toolText=(mapByPercent?BOLDSTARTTAG+"Value"+tooltipSepChar+BOLDENDTAG+formatedVal+BREAKSTRING+BOLDSTARTTAG+"Percentage"+tooltipSepChar+BOLDENDTAG+percentValue:toolTextValue)+(tlLabel!==_lib.BLANK?BREAKSTRING+(tlTypeToolText+tlLabel):_lib.BLANK)+(trLabel!==_lib.BLANK?BREAKSTRING+trTypeToolText+trLabel:_lib.BLANK)+(blLabel!==_lib.BLANK?BREAKSTRING+blTypeToolText+blLabel:_lib.BLANK)+(brLabel!==_lib.BLANK?BREAKSTRING+brTypeToolText+brLabel:_lib.BLANK)}}config.toolText=toolText;config.setTooltext=toolText}};_proto.hide=function hide(item){var dataset=this,entityComponents=dataset.components.data,colorRange=dataset.getFromEnv("chart").getChildren("colorRange")[0],i,len,config,legendItemColor,colorCode;legendItemColor=item.config.datasetObj.code;for(i=0,len=entityComponents.length;i<len;i++){if(!Object.keys(entityComponents[i]).length){continue}colorCode=colorRange.getColorObj(entityComponents[i].config.value).code;config=entityComponents[i].config;if(legendItemColor===colorCode){entityComponents[i].graphics.element&&dataset.getFromEnv("animationManager").setAnimation({el:entityComponents[i].graphics.element,attr:{"fill-opacity":0,"stroke-width":0},component:dataset});entityComponents[i].graphics.hotElement&&entityComponents[i].graphics.hotElement.hide();config.visible=false;entityComponents[i].visible=false}}item.setLegendState("hidden")};_proto.show=function show(item){var dataset=this,entityComponents=dataset.components.data,animationManager=dataset.getFromEnv("animationManager"),config,plotFillAlpha,colorObj,colorRange=dataset.getFromEnv("chart").getChildren("colorRange")[0],i,len,legendItemColor,colorCode;legendItemColor=item.config.datasetObj.code;for(i=0,len=entityComponents.length;i<len;i++){if(!Object.keys(entityComponents[i]).length){continue}config=entityComponents[i].config;plotFillAlpha=config.plotFillAlpha/100;colorObj=colorRange.getColorObj(entityComponents[i].config.value);colorCode=!colorObj.outOfRange&&colorObj.code;if(legendItemColor===colorCode){entityComponents[i].graphics.element&&animationManager.setAnimation({el:entityComponents[i].graphics.element,attr:{visibility:visibleStr},component:dataset});entityComponents[i].graphics.element&&animationManager.setAnimation({el:entityComponents[i].graphics.element,component:dataset,attr:{"fill-opacity":plotFillAlpha,"stroke-width":dataset.config.plotBorderThickness}});entityComponents[i].graphics.hotElement&&entityComponents[i].graphics.hotElement.show();entityComponents[i].graphics.valEle&&entityComponents[i].graphics.valEle.show();entityComponents[i].graphics.tlLabel&&entityComponents[i].graphics.tlLabel.show();entityComponents[i].graphics.trLabel&&entityComponents[i].graphics.trLabel.show();entityComponents[i].graphics.blLabel&&entityComponents[i].graphics.blLabel.show();entityComponents[i].graphics.brLabel&&entityComponents[i].graphics.brLabel.show();config.visible=true;entityComponents[i].visible=true}}item&&item.removeLegendState("hidden")};_proto.updatePlot=function updatePlot(minValue,maxValue){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),config,plotFillAlpha,entityComponents=dataset.components.data,i,len,value;for(i=0,len=entityComponents.length;i<len;i++){if(!Object.keys(entityComponents[i]).length){continue}config=entityComponents[i].config;plotFillAlpha=config.plotFillAlpha/100;value=entityComponents[i].config.value;if(value<minValue||value>maxValue){if(config.visible){entityComponents[i].graphics.element&&animationManager.setAnimation({el:entityComponents[i].graphics.element,attr:{"fill-opacity":0,"stroke-width":0},component:dataset});entityComponents[i].graphics.hotElement&&entityComponents[i].graphics.hotElement.hide();config.visible=false;entityComponents[i].visible=false}}else{if(!config.visible){entityComponents[i].graphics.element&&animationManager.setAnimation({el:entityComponents[i].graphics.element,attr:{"fill-opacity":plotFillAlpha,"stroke-width":dataset.config.plotBorderThickness},callback:function callback(){this.show()},component:dataset});entityComponents[i].graphics.hotElement&&entityComponents[i].graphics.hotElement.show();entityComponents[i].graphics.valEle&&entityComponents[i].graphics.valEle.show();entityComponents[i].graphics.tlLabel&&entityComponents[i].graphics.tlLabel.show();entityComponents[i].graphics.trLabel&&entityComponents[i].graphics.trLabel.show();entityComponents[i].graphics.blLabel&&entityComponents[i].graphics.blLabel.show();entityComponents[i].graphics.brLabel&&entityComponents[i].graphics.brLabel.show();config.visible=true;entityComponents[i].visible=true}}}};_proto._checkPointObj=function _checkPointObj(pX,pY,chartX,chartY){var dataset=this,plotGrid=dataset.components.plotGrid,pointObj,chartConfig=dataset.getFromEnv("chartConfig"),viewPortConfig=chartConfig.viewPortConfig,plotBorderThickness=chartConfig.plotborderthickness,halfPlotBorderThickness,dx,dy,hovered;pointObj=plotGrid[pY]&&plotGrid[pY][pX];plotBorderThickness=chartConfig.showplotborder?plotBorderThickness:0;halfPlotBorderThickness=plotBorderThickness/2;halfPlotBorderThickness=halfPlotBorderThickness%2===0?halfPlotBorderThickness+1:Math.round(halfPlotBorderThickness);if(pointObj&&pointObj.config&&pointObj.config.visible){dx=chartX-(pointObj._xPos-viewPortConfig.x*viewPortConfig.scaleX)+halfPlotBorderThickness;dy=chartY-pointObj._yPos+halfPlotBorderThickness;hovered=dx>=0&&dx<=pointObj._width+plotBorderThickness&&dy>=0&&dy<=pointObj._height+plotBorderThickness;if(hovered){return{pointIndex:pointObj._index,hovered:hovered,pointObj:pointObj}}}};_proto._getHoveredPlot=function _getHoveredPlot(chartXVal,chartYVal){var dataset=this,chartX=chartXVal,chartY=chartYVal,xAxis=dataset.getFromEnv("xAxis"),yAxis=dataset.getFromEnv("yAxis"),height=dataset.getFromEnv("chartConfig").canvasHeight/dataset.getFromEnv("totalRows"),x,y,pX,pY;chartX+=xAxis.getTranslation();chartY+=yAxis.getTranslation();y=yAxis.getValue(chartY+height/2);pY=Math.floor(y);x=xAxis.getValue(chartX);pX=Math.round(x);if(pX-x>0){return y-pY>.5?dataset._checkPointObj(pX,pY,chartX,chartY)||dataset._checkPointObj(pX-1,pY,chartX,chartY):dataset._checkPointObj(pX,pY-1,chartX,chartY)||dataset._checkPointObj(pX,pY,chartX,chartY)}return y-pY>.5?dataset._checkPointObj(pX+1,pY,chartX,chartY)||dataset._checkPointObj(pX,pY,chartX,chartY):dataset._checkPointObj(pX,pY-1,chartX,chartY)||dataset._checkPointObj(pX+1,pY,chartX,chartY)||dataset._checkPointObj(pX,pY,chartX,chartY)};_proto.parsePlotAttributes=function parsePlotAttributes(dataObj,index){var dataSet=this,conf=dataSet.config,setDataArr=dataSet.config.JSONData.data,attr,i=index,chart=dataSet.getFromEnv("chart"),xAxis=dataSet.getFromEnv("xAxis"),yAxis=dataSet.getFromEnv("yAxis"),xPos,yPos,chartConfig=dataSet.getFromEnv("chartConfig"),columnWidth,height,toolText,setLink,setValue,config,plotBorderThickness=conf.plotBorderThickness,plotRadius=conf.plotRadius,colorArr,plotBorderDashStyle,legendActive=chart.getFromEnv("legend")&&chart.getFromEnv("legend").config.isActive,plotGrid=dataSet.components.plotGrid,width,column,row,columnid,rowid,trackerConfig;yAxis.yBasePos=yAxis.getPixel(yAxis.getAxisBase());if(!dataObj||!Object.keys(dataObj).length){return}width=chartConfig.canvasWidth/dataSet.getFromEnv("totalColumns");height=chartConfig.canvasHeight/dataSet.getFromEnv("totalRows");trackerConfig=dataObj.trackerConfig={};config=dataObj&&dataObj.config;setValue=config.setValue;columnid=(0,_lib.getFirstValue)(setDataArr[i].columnid);rowid=(0,_lib.getFirstValue)(setDataArr[i].rowid);column=xAxis.getCategoryFromId(columnid.toLowerCase());row=yAxis.getCategoryFromId(rowid.toLowerCase());if(column.index!==0&&!column.index||row.index!==0&&!row.index){return}if(!conf.mapByCategory&&setValue===null){return}setLink=config.setLink;colorArr=config.colorArr;if(!dataObj.graphics){dataSet.components.data[i].graphics={}}xPos=xAxis.getPixel(column.index)-width/2;yPos=yAxis.getPixel(row.index)-height/2;columnWidth=width;toolText=config.toolText;trackerConfig.eventArgs={index:i,link:setLink,value:config.percentValue||setValue,displayValue:config.displayValue,columnId:column.tickObj.id,rowId:row.tickObj.id,tlLabel:config.tlLabel,trLabel:config.trLabel,blLabel:config.blLabel,brLabel:config.brLabel,colorRangeLabel:config.colorRangeLabel,color:config.rawPlotColor,alpha:config.plotFillAlpha,showValue:config.showValue,toolText:!toolText?"":toolText,id:_lib.BLANKSTRING,datasetIndex:legendActive?dataObj.datasetIndex:UNDEF,datasetName:legendActive?dataObj.datasetName:UNDEF,visible:dataSet.getState("visible")};attr={x:xPos,y:yPos,width:columnWidth,height:height||1,r:plotRadius,fill:config.color,stroke:(0,_lib.toRaphaelColor)(colorArr[1]),"stroke-width":plotBorderThickness,"stroke-dasharray":plotBorderDashStyle,"fill-opacity":config.plotFillAlpha/100,"stroke-linejoin":miterStr,visibility:config.visible?visibleStr:hiddenStr,cursor:setLink?POINTER:_lib.BLANKSTRING};dataObj._xPos=xPos;dataObj._yPos=yPos;dataObj._height=height;dataObj._width=columnWidth;dataObj._index=i;plotGrid[row.index][column.index]=dataObj;if(!dataObj.graphics.element){attr["fill-opacity"]=config.plotFillAlpha/100;attr["stroke-width"]=plotBorderThickness}else{attr={x:xPos,y:yPos,width:columnWidth,height:height||1};attr.fill=config.color;attr.stroke=(0,_lib.toRaphaelColor)(colorArr[1]);attr["fill-opacity"]=config.visible?config.plotFillAlpha/100:0;attr["stroke-width"]=config.visible?plotBorderThickness:0;attr["stroke-dasharray"]=plotBorderDashStyle;attr["stroke-linejoin"]=miterStr;attr.visibility=config.visible?visibleStr:hiddenStr;attr.cursor=setLink?POINTER:_lib.BLANKSTRING}if(setLink||chartConfig.showtooltip){if(height<HTP){yPos-=(HTP-height)/2;height=HTP}trackerConfig.attr={x:xPos,y:yPos,width:columnWidth,height:height,r:plotRadius,cursor:setLink?POINTER:_lib.BLANKSTRING,stroke:TRACKER_FILL,"stroke-width":plotBorderThickness,fill:TRACKER_FILL,visibility:config.visible?visibleStr:hiddenStr}}config.props={element:{attr:attr}}};_proto.allocatePosition=function allocatePosition(){var dataSet=this,setDataArr=dataSet.config.JSONData.data,len,i,dataStore=dataSet.components.data,dataObj;len=setDataArr&&setDataArr.length;for(i=0;i<len;i++){dataObj=dataStore[i];dataSet.parsePlotAttributes(dataObj,i)}};_proto.drawPlots=function drawPlots(){var dataSet=this,conf=dataSet.config,setDataArr=dataSet.config.JSONData.data,len,i,animationManager=dataSet.getFromEnv("animationManager"),crispBox,dataStore=dataSet.components.data,dataObj,setElement,setValue,config,state,column,row,columnid,rowid,elemIdStore=[],elemId,removeDataArrLen=(dataSet.components.removeDataArr||[]).length,trackerConfig;len=setDataArr&&setDataArr.length;for(i=0;i<len;i++){dataObj=dataStore[i];trackerConfig=dataObj.trackerConfig;config=dataObj&&dataObj.config;if(!dataObj.graphics){continue}state=!dataObj.graphics.element?"appearing":dataSet.getState("visible")?"updating":"hiding";setValue=config.setValue;columnid=(0,_lib.getFirstValue)(setDataArr[i].columnid);rowid=(0,_lib.getFirstValue)(setDataArr[i].rowid);column=dataSet.getFromEnv("xAxis").getCategoryFromId(columnid.toLowerCase());row=dataSet.getFromEnv("yAxis").getCategoryFromId(rowid.toLowerCase());if(column.index!==0&&!column.index||row.index!==0&&!row.index){dataObj.graphics.element=dataObj.graphics.element&&animationManager.setAnimation({el:dataObj.graphics.element,component:dataSet});continue}if((!column.tickObj||!row.tickObj||config.value===_lib.BLANKSTRING)&&dataObj.graphics){dataObj.graphics.element=dataObj.graphics.element&&animationManager.setAnimation({el:dataObj.graphics.element,component:dataSet})}if(!conf.mapByCategory&&setValue===null&&dataObj.graphics){dataObj.graphics.element&&dataObj.graphics.element.hide();dataObj.graphics.hotElement&&dataObj.graphics.hotElement.hide();continue}elemId=column.index.toString()+row.index.toString();elemIdStore.push(elemId);if(!dataObj.graphics.element){setElement=dataObj.graphics.element=animationManager.setAnimation({el:"rect",component:dataSet,attr:config.props.element.attr,label:"rect",container:dataSet.getContainer("plotGroup")});config.elemCreated=true}else{setElement=dataObj.graphics.element;config.elemCreated=false;animationManager.setAnimation({el:setElement,state:state,attr:config.props.element.attr,component:dataSet})}setElement.shadow({opacity:conf.showShadow},dataSet.getContainer("shadowGroup")).data("BBox",crispBox);dataSet.getFromEnv("chartConfig").enablemousetracking&&setElement.data(EVENTARGS,trackerConfig.eventArgs).data(showHoverEffectStr,conf.showHoverEffect).data(SETROLLOVERATTR,config.setRolloverAttr||{}).data(SETROLLOUTATTR,config.setRolloutAttr||{})}dataSet.drawn?dataSet.drawLabel():dataSet.addJob("labelJob",dataSet.drawLabel.bind(dataSet),_schedular.priorityList.label);dataSet.drawn=true;removeDataArrLen&&dataSet.removeDataElems()};_proto.drawLabel=function drawLabel(){var dataSet=this,chartConf=dataSet.getFromEnv("chartConfig"),smartLabel=dataSet.getFromEnv("smartLabel"),animationManager=dataSet.getFromEnv("animationManager"),style=chartConf.dataLabelStyle,conf=dataSet.config,len=(dataSet.config.JSONData.data||[]).length,dataStore=dataSet.components.data,dataObj,i,displayValue,graphic,textY,textX,yPos,xPos,attr,dataLabelContainer=dataSet.getContainer("labelGroup"),tlLabelContainer=dataSet.graphics.tlLabelContainer,blLabelContainer=dataSet.graphics.blLabelContainer,trLabelContainer=dataSet.graphics.trLabelContainer,brLabelContainer=dataSet.graphics.brLabelContainer,plotLabelStyle,tlStyle,trStyle,blStyle,brStyle,graphicEle,pointW,pointH,pointX,pointY,smartTextObj,tlLabel,trLabel,blLabel,brLabel,isTLLabel,isTRLabel,isBLLabel,isBRLabel,maxWidth,maxHeight,config,setValue,tlLabelCss,trLabelCss,blLabelCss,brLabelCss;animationManager.setAnimation({el:dataLabelContainer,attr:{opacity:1},component:dataSet,label:"text"});if(!tlLabelContainer){tlLabelContainer=dataSet.graphics.tlLabelContainer=createGroup({name:tlLabelStr},dataLabelContainer,dataSet)}if(!blLabelContainer){blLabelContainer=dataSet.graphics.blLabelContainer=createGroup({name:blLabelStr},dataLabelContainer,dataSet)}if(!trLabelContainer){trLabelContainer=dataSet.graphics.trLabelContainer=createGroup({name:trLabelStr},dataLabelContainer,dataSet)}if(!brLabelContainer){brLabelContainer=dataSet.graphics.brLabelContainer=createGroup({name:brLabelStr},dataLabelContainer,dataSet)}smartLabel.useEllipsesOnOverflow(chartConf.useEllipsesWhenOverflow);smartLabel.setStyle(style);for(i=0;i<len;i++){dataObj=dataStore[i];if(dataObj===UNDEF){continue}graphic=dataObj.graphics;if(!graphic){continue}config=dataObj&&dataObj.config;setValue=config.setValue;if(!conf.mapByCategory&&setValue===null){dataSet.removeLabels(dataObj);continue}displayValue=config.displayValue;graphicEle=dataObj.graphics.element;pointW=dataObj._width;pointH=dataObj._height;pointX=dataObj._xPos;pointY=dataObj._yPos;smartLabel.setStyle(style);smartTextObj=smartLabel.getSmartText(displayValue,pointW,pointH,false);displayValue=smartTextObj.text;plotLabelStyle=config.dataLabelStyle;if(defined(displayValue)&&displayValue!==_lib.BLANK&&config.showValue){textY=pointY+pointH*.5;textX=pointX+pointW*.5;attr={text:displayValue,title:smartTextObj.tooltext||_lib.BLANKSTRING,visibility:config.visible?visibleStr:hiddenStr,fill:plotLabelStyle.color,direction:config.textDirection,x:textX,y:textY,cursor:config.setLink?POINTER:_lib.BLANKSTRING,"text-bound":[plotLabelStyle.backgroundColor,plotLabelStyle.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash]};if(graphicEle){dataObj.graphics.valEle=animationManager.setAnimation({el:dataObj.graphics.valEle||"text",container:dataLabelContainer,component:dataSet,label:"text",attr:attr});dataObj.graphics.valEle.outlineText(conf.showTextOutLine,attr.fill)}else{if(dataObj.graphics.valEle){dataObj.graphics.valEle=animationManager.setAnimation({el:dataObj.graphics.valEle,component:dataSet})}}tlLabel=config.tlLabel;trLabel=config.trLabel;blLabel=config.blLabel;brLabel=config.brLabel;tlStyle=config.tlLabelStyle;trStyle=config.trLabelStyle;blStyle=config.blLabelStyle;brStyle=config.brLabelStyle;isTLLabel=defined(tlLabel)&&tlLabel!==_lib.BLANK;isTRLabel=defined(trLabel)&&trLabel!==_lib.BLANK;isBLLabel=defined(blLabel)&&blLabel!==_lib.BLANK;isBRLabel=defined(brLabel)&&brLabel!==_lib.BLANK;maxWidth=pointW*(isTLLabel&&isTRLabel?POINT_FIVE:MAX_PERCENT_SPACE);maxHeight=(pointH-(smartTextObj&&smartTextObj.height||0))*.5;yPos=pointY+GUTTER_4;if(isTLLabel){smartLabel.setStyle(tlStyle);smartTextObj=smartLabel.getSmartText(tlLabel,maxWidth,maxHeight,false);displayValue=smartTextObj.text;xPos=pointX;attr={text:displayValue,title:smartTextObj.tooltext||_lib.BLANKSTRING,visibility:config.visible?visibleStr:hiddenStr,fill:tlStyle.color,"font-family":tlStyle.fontFamily,"font-weight":tlStyle.fontWeight,"line-height":tlStyle.lineHeight,"font-size":tlStyle.fontSize,"text-anchor":POSITION_START,"vertical-align":POSITION_TOP,direction:config.textDirection,x:xPos+GUTTER_4,y:yPos,"text-bound":[tlStyle.backgroundColor,tlStyle.borderColor,tlStyle.borderThickness,tlStyle.borderPadding,tlStyle.borderRadius,tlStyle.borderDash]};tlLabelCss=Object.assign(attr,tlStyle);dataObj.graphics.tlLabel=animationManager.setAnimation({el:dataObj.graphics.tlLabel||"text",component:dataSet,attr:tlLabelCss,container:tlLabelContainer});dataObj.graphics.tlLabel.outlineText(conf.showTextOutLine,tlLabelCss.fill)}else{if(dataObj.graphics.tlLabel){dataObj.graphics.tlLabel=animationManager.setAnimation({el:dataObj.graphics.tlLabel,component:dataSet})}}if(isTRLabel){smartLabel.setStyle(trStyle);smartTextObj=smartLabel.getSmartText(trLabel,maxWidth,maxHeight,false);displayValue=smartTextObj.text;xPos=pointX+pointW;attr={text:displayValue,title:smartTextObj.tooltext||_lib.BLANKSTRING,visibility:config.visible?visibleStr:hiddenStr,fill:trStyle.color,"font-family":trStyle.fontFamily,"font-weight":trStyle.fontWeight,"line-height":trStyle.lineHeight,"font-size":trStyle.fontSize,"text-anchor":POSITION_END,"vertical-align":POSITION_TOP,direction:config.textDirection,x:xPos-GUTTER_4,y:yPos,"text-bound":[trStyle.backgroundColor,trStyle.borderColor,trStyle.borderThickness,trStyle.borderPadding,trStyle.borderRadius,trStyle.borderDash]};trLabelCss=Object.assign(attr,trStyle);dataObj.graphics.trLabel=animationManager.setAnimation({el:dataObj.graphics.trLabel||"text",attr:trLabelCss,container:trLabelContainer,component:dataSet});dataObj.graphics.trLabel.outlineText(conf.showTextOutLine,trLabelCss.fill)}else{if(dataObj.graphics.trLabel){dataObj.graphics.trLabel=animationManager.setAnimation({el:dataObj.graphics.trLabel,component:dataSet})}}yPos=pointY+pointH-GUTTER_4;if(isBLLabel){smartLabel.setStyle(blStyle);smartTextObj=smartLabel.getSmartText(blLabel,maxWidth,maxHeight,false);displayValue=smartTextObj.text;xPos=pointX;attr={text:displayValue,title:smartTextObj.tooltext||_lib.BLANKSTRING,visibility:config.visible?visibleStr:hiddenStr,fill:blStyle.color,"font-family":blStyle.fontFamily,"font-weight":blStyle.fontWeight,"line-height":blStyle.lineHeight,"font-size":blStyle.fontSize,"text-anchor":POSITION_START,"vertical-align":POSITION_BOTTOM,direction:config.textDirection,x:xPos+GUTTER_4,y:yPos,"text-bound":[blStyle.backgroundColor,blStyle.borderColor,blStyle.borderThickness,blStyle.borderPadding,blStyle.borderRadius,blStyle.borderDash]};blLabelCss=Object.assign(attr,blStyle);dataObj.graphics.blLabel=animationManager.setAnimation({el:dataObj.graphics.blLabel||"text",component:dataSet,container:blLabelContainer,attr:blLabelCss});dataObj.graphics.blLabel.outlineText(conf.showTextOutLine,blLabelCss.fill)}else{if(dataObj.graphics.blLabel){dataObj.graphics.blLabel=animationManager.setAnimation({el:dataObj.graphics.blLabel,component:dataSet})}}if(isBRLabel){smartLabel.setStyle(blStyle);smartTextObj=smartLabel.getSmartText(brLabel,maxWidth,maxHeight,false);displayValue=smartTextObj.text;xPos=pointX+pointW-GUTTER_4;attr={text:displayValue,title:smartTextObj.tooltext||_lib.BLANKSTRING,visibility:config.visible?visibleStr:hiddenStr,fill:brStyle.color,"font-family":brStyle.fontFamily,"font-weight":brStyle.fontWeight,"line-height":brStyle.lineHeight,"font-size":brStyle.fontSize,"text-anchor":POSITION_END,"vertical-align":POSITION_BOTTOM,direction:config.textDirection,x:xPos,y:yPos,"text-bound":[brStyle.backgroundColor,brStyle.borderColor,brStyle.borderThickness,brStyle.borderPadding,brStyle.borderRadius,brStyle.borderDash]};brLabelCss=Object.assign(attr,brStyle);dataObj.graphics.brLabel=animationManager.setAnimation({el:dataObj.graphics.brLabel||"text",attr:brLabelCss,container:brLabelContainer,component:dataSet});dataObj.graphics.brLabel.outlineText(conf.showTextOutLine,brLabelCss.fill)}else{if(dataObj.graphics.brLabel){dataObj.graphics.brLabel=animationManager.setAnimation({el:dataObj.graphics.brLabel,component:dataSet})}}}else{dataSet.removeLabels(dataObj)}}dataSet.labelDrawn=true};_proto.removeLabels=function removeLabels(dataObj){var dataSet=this,animationManager=dataSet.getFromEnv("animationManager");if(dataObj.graphics.valEle){dataObj.graphics.valEle=animationManager.setAnimation({el:dataObj.graphics.valEle,component:dataSet})}if(dataObj.graphics.tlLabel){dataObj.graphics.tlLabel=animationManager.setAnimation({el:dataObj.graphics.tlLabel,component:dataSet})}if(dataObj.graphics.trLabel){dataObj.graphics.trLabel=animationManager.setAnimation({el:dataObj.graphics.trLabel,component:dataSet})}if(dataObj.graphics.blLabel){dataObj.graphics.blLabel=animationManager.setAnimation({el:dataObj.graphics.blLabel,component:dataSet})}if(dataObj.graphics.brLabel){dataObj.graphics.brLabel=animationManager.setAnimation({el:dataObj.graphics.brLabel,component:dataSet})}};_proto.removeDataElems=function removeDataElems(){var dataSet=this,components=dataSet.components,removeDataArr=components.removeDataArr,pool=components.pool||(components.pool={element:[],hotElement:[],label:[]}),len=removeDataArr.length,removeData,ele,graphics,i;for(i=0;i<len;i++){removeData=removeDataArr[0];removeDataArr.splice(0,1);if(!removeData||!removeData.graphics){continue}graphics=removeData.graphics;for(ele in graphics){if(graphics[ele]){graphics[ele]=dataSet.getFromEnv("animationManager").setAnimation({el:graphics[ele],component:dataSet})}}removeData.graphics.element&&(pool.element=pool.element.concat(removeData.graphics.element));removeData.graphics.hotElement&&(pool.hotElement=pool.hotElement.concat(removeData.graphics.hotElement));removeData.graphics.label&&(pool.label=pool.label.concat(removeData.graphics.label))}components.pool=pool};_proto.getAxisValuePadding=function getAxisValuePadding(){return this.config.defaultPadding};_proto.getDataLimits=function getDataLimits(){var dataSet=this,dataStore=dataSet.components.data,conf=dataSet.config,i,config,len=dataStore.length,setValue,maxValue=-Infinity,minValue=+Infinity;for(i=0;i<len;i++){if(!dataStore[i]||!Object.keys(dataStore[i]).length){continue}config=dataStore[i].config;setValue=config.setValue;if(setValue!==UNDEF&&setValue!==null){maxValue=mathMax(maxValue,setValue);minValue=mathMin(minValue,setValue)}}conf.maxValue=maxValue;conf.minValue=minValue;return{max:conf.maxValue,min:conf.minValue}};_proto.trimData=function trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,config=dataSet.config,context=config&&config.context,prevCatlen=context&&context.prevCatlen,currCatLen=dataSet.getFromEnv("xAxis").getTicksLen(),catDiff=prevCatlen-currCatLen,prevData=config.JSONData,prevDataLength=prevData.data&&prevData.data.length,currDataLength=datasetJSON.data&&datasetJSON.data.length||0,dataDiff=prevDataLength-currDataLength,diff,startIndex;if(catDiff>dataDiff){diff=catDiff;startIndex=currCatLen}else{diff=dataDiff;startIndex=currDataLength}if(diff>0){this.removeData(startIndex,diff,false)}};_proto.draw=function draw(){var dataSet=this,xAxis=dataSet.getFromEnv("xAxis"),groupMaxWidth=dataSet.getFromEnv("groupMaxWidth");if(!groupMaxWidth){groupMaxWidth=mathAbs(xAxis.getPixel(1)-xAxis.getPixel(0));dataSet.addToEnv("groupMaxWidth",groupMaxWidth)}!dataSet.config.drawn&&dataSet.createContainer();if(!xAxis.getState("scrolling")){dataSet.createCoordinates()}dataSet.drawPlots()};_proto.createContainer=function createContainer(){var dataset=this,parent=dataset.getLinkedParent(),group=dataset.groupName||dataset.dsGroup||dataset.getType(),parentContainer,parentShadowContainer;!parent.getChildContainer(group+"VcanvasGroup")&&(group="default");parentContainer=parent.getChildContainer(group+"VcanvasGroup");parentShadowContainer=parent.getChildContainer(group+"ShadowVcanvasGroup");!dataset.getContainer("shadowGroup")&&dataset.addContainer("shadowGroup",createGroup({name:"shadow-group"},parentShadowContainer,dataset));!dataset.getContainer("errorShadowGroup")&&dataset.addContainer("errorShadowGroup",createGroup({name:"error-shadow-group"},parentShadowContainer,dataset));!dataset.getContainer("commonElemsGroup")&&dataset.addContainer("commonElemsGroup",createGroup({name:"common-elems-group"},parentContainer,dataset));!dataset.getContainer("plotGroup")&&dataset.addContainer("plotGroup",createGroup({name:"plot-group"},parentContainer,dataset));!dataset.getContainer("errorPlotGroup")&&dataset.addContainer("errorPlotGroup",createGroup({name:"error-plot-group"},parentContainer,dataset));dataset.getFromEnv("chart").hasAnchor&&dataset.getContainer("errorPlotGroup").insertBefore(dataset.getContainer("plotGroup"));!dataset.getContainer("labelGroup")&&dataset.addContainer("labelGroup",createGroup({name:"label-group",class:"fusioncharts-datalabels"},parent.getChildContainer("vcanvasLabelGroup"),dataset))};_proto.createCoordinates=function createCoordinates(){var dataSet=this,chart=dataSet.getFromEnv("chart"),isBar=chart.isBar,yAxis=dataSet.getFromEnv("yAxis"),xAxis=dataSet.getFromEnv("xAxis"),yBasePos=yAxis.getPixel(yAxis.getAxisBase()),dataObj,config,previousY,i,Px,Py,Pb,xDepth=chart.config.xDepth||0,yDepth=chart.config.yDepth||0,len=dataSet.components.data.length,groupManager=dataSet.getLinkedParent(),stackConf=groupManager.getstackConf&&groupManager.getstackConf(),dataStore=dataSet.components.data;!isBar&&(xDepth=-xDepth);isBar&&(yDepth=-yDepth);for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj&&dataObj.config;if(dataObj===UNDEF){continue}previousY=config._b;Px=xAxis.getPixel(stackConf&&stackConf[i].x||config._x)+xDepth;Py=yAxis.getPixel(config._y)+yDepth;Pb=(previousY?yAxis.getPixel(previousY):yBasePos)+yDepth;if(xAxis.config.isVertical){config._Px=Py;config._Py=Px;config._Pby=Px;config._Pbx=Pb}else{config._Px=Px;config._Py=Py;config._Pby=Pb;config._Pbx=Px}if(dataSet.getLineShift){config._Py+=dataSet.getLineShift("y")}}};_proto._decideTooltipType=function _decideTooltipType(plotIndex,e){var dataset=this,drawTrendRegion=dataset.getFromEnv("chartConfig").drawTrendRegion,toolTipController=dataset.getFromEnv("toolTipController"),data=dataset.components.data[plotIndex],toolText=data&&(data.config.finalTooltext||data.config.toolText),element=data&&(data.graphics.element||dataset.graphics.sharedAnchor.element),currentToolTip=dataset.config.currentToolTip,originalEvent=e.originalEvent;if(drawTrendRegion&&element){dataset.config.currentToolTip=dataset.getLinkedParent()._drawTooltip(plotIndex,dataset.config.index,originalEvent,currentToolTip)}else if(toolText&&!drawTrendRegion){if(currentToolTip){toolTipController.draw(originalEvent,toolText,currentToolTip)}else{currentToolTip=dataset.config.currentToolTip=toolTipController.draw(originalEvent,toolText)}}};_proto._firePlotEvent=function _firePlotEvent(eventType,plotIndex,e){var dataset=this,chart=dataset.getFromEnv("chart"),data=dataset.components.data[plotIndex],setElement=data.graphics.element,labelElement=data.graphics.label,config,setLink;if(setElement){config=data.config;setLink=config.setLink;switch(eventType){case"fc-mouseover":dataset._decideTooltipType(plotIndex,e);_rolloverResponseSetter(chart,data,e,UNDEF,dataset);if(setLink){setElement.css({cursor:POINTER});labelElement&&labelElement.css({cursor:POINTER})}break;case"fc-mouseout":dataset.getFromEnv("toolTipController").hide(dataset.config.currentToolTip);_rolloutResponseSetter(chart,data,e,UNDEF,dataset);if(setLink){setElement.css({cursor:DEFAULT_CURSOR});labelElement&&labelElement.css({cursor:DEFAULT_CURSOR})}break;case"fc-click":chart.plotEventHandler(setElement,e);break;case"fc-mousemove":dataset._decideTooltipType(plotIndex,e)}}};_proto.removeData=function removeData(indexVal,stretchVal,draw){var dataSet=this,index=indexVal,stretch=stretchVal,components=dataSet.components,dataStore=components.data,removeDataArr=components.removeDataArr||(components.removeDataArr=[]),conf=dataSet.config,i,config,len,maxminFlag=dataSet.maxminFlag;stretch===UNDEF&&(stretch=1);index=index||0;if(index+stretch===dataStore.length||!dataSet.getFromEnv("chart").isRealTime){dataSet.endPosition=true}else if(index===0||index===UNDEF){dataSet.endPosition=false}components.removeDataArr=removeDataArr=removeDataArr.concat(dataStore.splice(index,stretch));len=removeDataArr.length;for(i=len-1;i>=0;i--){if(!removeDataArr[i]){removeDataArr.splice(i,1);continue}config=removeDataArr[i].config;if(config.setValue===conf.maxValue||config.setValue===conf.minValue){maxminFlag=dataSet.maxminFlag=true}config._x-=stretch;if(maxminFlag){break}}dataSet.removeDataLen=len;dataSet.resetCatPos&&dataSet.resetCatPos();maxminFlag&&dataSet.getDataLimits&&dataSet.getDataLimits();draw&&dataSet.asyncDraw()};return HeatMapDataset}(_componentInterface.ComponentInterface);HeatMapDataset.prototype._configureDataLabelStyle=_lib.configureDataLabelStyle;var _default=HeatMapDataset;exports.default=_default;