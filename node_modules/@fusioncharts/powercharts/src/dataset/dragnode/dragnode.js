"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _area=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/area"));var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _dragnodeAnimation=_interopRequireDefault(require("./dragnode-animation"));var _redraphaelShapes=_interopRequireDefault(require("@fusioncharts/core/src/_internal/redraphael/redraphael-shapes/redraphael-shapes.ringpath"));var _kdtree=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/_internal/kdtree"));var PADDING=1;var Raphael=(0,_dependencyManager.getDep)("redraphael","plugin"),UNDEF,mathMax=Math.max,mathMin=Math.min,CIRCLE=_lib.preDefStr.CIRCLE,POLYGON=_lib.preDefStr.POLYGON,RECTANGLE=_lib.preDefStr.RECTANGLE,UNDERSCORE=_lib.preDefStr.UNDERSCORE,GROUPID=_lib.preDefStr.GROUPID,EVENTARGS=_lib.preDefStr.EVENTARGS,OBJECTBOUNDINGBOX=_lib.preDefStr.OBJECTBOUNDINGBOX,DATAPLOTCLICK="dataplotclick",DATAPLOTDRAGSTART="dataplotdragstart",DATAPLOTDRAGEND="dataplotdragend",DEFAULT_CURSOR=_lib.preDefStr.DEFAULT,COMMA=_lib.preDefStr.COMMA,FIFTY_PERCENT="50%",PATH="path",POLY_4="poly_4",ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",POSITION_TOP=_lib.preDefStr.POSITION_TOP,isVML=!!_lib.hasSVG,hideFn=function hideFn(){this.hide()},defined=function defined(obj){return obj!==UNDEF&&obj!==null},createGroup=function createGroup(groupName,animationManager,parentContainer,component){return animationManager.setAnimation({el:"group",attr:{name:groupName},container:parentContainer,component:component})},getPointColor=function getPointColor(colorVal,alphaVal,shapeType){var color=colorVal,alpha=alphaVal,colorObj,innerColor,outerColor;color=(0,_lib.getFirstColor)(color);alpha=(0,_lib.getFirstAlpha)(alpha);innerColor=(0,_lib.getLightColor)(color,80);outerColor=(0,_lib.getDarkColor)(color,65);colorObj={FCcolor:{gradientUnits:OBJECTBOUNDINGBOX,color:innerColor+COMMA+outerColor,alpha:alpha+COMMA+alpha,ratio:_lib.BGRATIOSTRING}};if(shapeType){if(shapeType===1){colorObj.FCcolor.angle=0}else{colorObj.FCcolor.angle=180}}else{colorObj.FCcolor.cx=.4;colorObj.FCcolor.cy=.4;colorObj.FCcolor.r=FIFTY_PERCENT;colorObj.FCcolor.radialGradient=true}return colorObj},_configureTooltext=function _configureTooltext(config,datasetConf,chartAttr){var setTooltext=config.setTooltext,formatedVal=config.formatedVal,seriesname=datasetConf.seriesname,label=config.label,xValue=config.xValue,pointLabel=config.pointLabel,tooltipSepChar=datasetConf.tooltipSepChar,toolText;if(setTooltext!==UNDEF){toolText=(0,_lib.parseTooltext)(setTooltext,[3,4,5,6,8,9,10,11],{yaxisName:(0,_lib.parseUnsafeString)(chartAttr.yaxisname),xaxisName:(0,_lib.parseUnsafeString)(chartAttr.xaxisname),yDataValue:formatedVal,xDataValue:xValue,label:label},config,chartAttr,datasetConf)}else if(pointLabel!==UNDEF){toolText=label}else{if(formatedVal===null){toolText=false}else{if(datasetConf.seriesNameInToolTip){seriesname=(0,_lib.getFirstValue)(datasetConf.seriesname)}toolText=seriesname?seriesname+tooltipSepChar:_lib.BLANK;toolText+=xValue?xValue+tooltipSepChar:_lib.BLANK;toolText+=formatedVal}}return toolText};(0,_dependencyManager.addDep)({name:"dragNodeAnimation",type:"animationRule",extension:_dragnodeAnimation.default});(0,_redraphaelShapes.default)(Raphael);var DragNodeDataset=function(_Areadataset){(0,_inheritsLoose2.default)(DragNodeDataset,_Areadataset);function DragNodeDataset(){return _Areadataset.apply(this,arguments)||this}var _proto=DragNodeDataset.prototype;_proto.getName=function getName(){return"dragNode"};_proto.getType=function getType(){return"dataset"};_proto.hide=function hide(){var dataSet=this,parent=dataSet.getLinkedParent(),changeInfo={};changeInfo.hide=true;dataSet.setState("dirty",true);dataSet.setState("visible",false);parent.childChanged(changeInfo);dataSet.getFromEnv("chart").getChildren("legend")[0].getItem(dataSet.config.legendItemId).setLegendState("hidden");dataSet.asyncDraw()};_proto.show=function show(){var dataSet=this,parent=dataSet.getLinkedParent(),legendItem=dataSet.getFromEnv("legend").getItem(dataSet.config.legendItemId),changeInfo={};changeInfo.show=true;dataSet.setState("visible",true);dataSet.setState("dirty",true);parent.childChanged(changeInfo);legendItem&&legendItem.removeLegendState("hidden");dataSet.asyncDraw()};_proto._setDatasetIndex=function _setDatasetIndex(){var dataset=this,chidrenArr=dataset.getLinkedParent().getChildren("dataset");dataset.config.datasetIndex=chidrenArr.indexOf(dataset)};_proto.pointInShape=function pointInShape(x,y,config){var dataset=this,chart=dataset.getFromEnv("chart"),canvas=chart.getChildren("canvas")[0],canvasConfig=canvas.config,symbol=config.symbol,x2,y2,r2,xPos=config._xPos,yPos=config._yPos,width,height;if(x<canvasConfig.canvasLeft||x>canvasConfig.canvasLeft+canvasConfig.canvasWidth||y<canvasConfig.canvasTop||y>canvasConfig.canvasTop+canvasConfig.canvasHeight){return false}if(symbol==="rectangle"){width=config._plotWidth;height=config._plotHeight;xPos-=width/2;yPos-=height/2;if(x>=xPos&&y>=yPos&&x<=xPos+width&&y<=yPos+height){return true}return false}x2=(x-xPos)*(x-xPos);y2=(y-yPos)*(y-yPos);r2=Number(config.radius);r2*=r2;if(x2+y2<=r2){return true}return false};_proto._firePlotEvent=function _firePlotEvent(eventType,plotIndex,e){var dataset=this,chart=dataset.getFromEnv("chart"),components=dataset.components,toolTipController=dataset.getFromEnv("toolTipController"),dataStore=components.data,data=dataStore[plotIndex]||{},sharedAnchor=dataset.getGraphicalElement("sharedAnchor"),setElement=data.graphics&&data.graphics.element||(data.config&&data.config.setValue)!==UNDEF&&sharedAnchor,toolTip=this.config.currentToolTip,viewMode=dataset.config.viewMode,groupManager=dataset.getLinkedParent(),config,ele=data.graphics.element,eventArgs,setLink;if(setElement){config=data.config;setLink=config.setLink;eventArgs=config.eventArgs;switch(eventType){case"fc-mouseover":dataset._decideTooltipType(plotIndex,e);dataset._rolloverResponseSetter(chart,data,e);setLink&&(setElement.node.style.cursor=_lib.POINTER);break;case"fc-mouseout":toolTipController.hide(toolTip);dataset._rolloutResponseSetter(chart,data,e);setLink&&(setElement.node.style.cursor=DEFAULT_CURSOR);break;case"fc-click":ele.data("fire_click_event")&&chart.plotEventHandler(setElement,e,DATAPLOTCLICK,eventArgs);break;case"fc-mousemove":groupManager.hideWaitElem();dataset._decideTooltipType(plotIndex,e);break;case"fc-mousedown":clearTimeout(ele._longpressactive);ele.data("fire_click_event",1);if(!viewMode){groupManager.drawWaitingRing(data,dataset.config.datasetIndex)}break;case"fc-mouseup":groupManager.hideWaitElem();groupManager.clearLongPress();break}}};_proto.dragUp=function dragUp(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragUp.call(ele,event)};_proto.dragMove=function dragMove(event,customData){var ele=this,data=ele.data("drag-options"),dataset=data.dataset,dx=customData[0],dy=customData[1],px=customData[2],py=customData[3];dataset._dragMove.call(ele,dx,dy,px,py)};_proto.dragStart=function dragStart(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragStart.call(ele,event)};_proto._dragStart=function _dragStart(){var element=this,data=element.data("drag-options"),dataObj=data.dataObj,dataGraphics=dataObj.graphics,ele=dataGraphics.element,bBox=ele.getBBox(),config=dataObj.config,dataset=data.dataset,chart=dataset.getFromEnv("chart"),sourceEvent=DATAPLOTDRAGSTART,dragStart=config.dragStart||(config.dragStart={}),cloneGraphic=dataObj.graphics.cloneGraphic,cloneGraphicGroup=dataset.getContainer("cloneGraphicGroup"),cloneText=dataObj.graphics.cloneText,image=dataObj.graphics.image,cloneImage=dataObj.graphics.cloneImage,label=dataObj.graphics.label,eventArgs;if(isVML){ele._.dirty=1}if(config.allowDrag){if(!cloneGraphic&&dataObj.graphics.element){cloneGraphic=dataObj.graphics.cloneGraphic=dataObj.graphics.element.clone();cloneGraphicGroup.appendChild(cloneGraphic)}if(label&&!cloneText){cloneText=dataObj.graphics.cloneText=dataObj.graphics.label.clone();if(cloneText.followers[0]&&cloneText.followers[0].el){cloneGraphicGroup.appendChild(cloneText.followers[0].el)}cloneGraphicGroup.appendChild(cloneText)}if(image&&!cloneImage){cloneImage=dataObj.graphics.cloneImage=dataObj.graphics.image.clone();cloneGraphicGroup.appendChild(cloneImage)}cloneText&&cloneText.show();cloneImage&&cloneImage.show();cloneGraphic&&cloneGraphic.show()}dragStart.xPos=config._xPos;dragStart.yPos=config._yPos;dragStart.x=config.x;dragStart.y=config.y;dragStart.bBox=bBox;dragStart.origX=dragStart.lastDx||(dragStart.lastDx=0);dragStart.origY=dragStart.lastDy||(dragStart.lastDy=0);eventArgs=ele.data(EVENTARGS);chart.fireChartInstanceEvent(sourceEvent,eventArgs);cloneGraphic&&cloneGraphic.show();cloneText&&cloneText.show();cloneImage&&cloneImage.show()};_proto._dragMove=function _dragMove(dxVal,dyVal){var element=this,dx=dxVal,dy=dyVal,data=element.data("drag-options"),dataObj=data.dataObj,ele=dataObj.graphics.element,cloneGraphic=dataObj.graphics.cloneGraphic,cloneImage=dataObj.graphics.cloneImage,cloneText=dataObj.graphics.cloneText,config=dataObj.config,dragStart=config.dragStart,startX=dragStart.bBox.x+dx,endX=dragStart.bBox.x2+dx,startY=dragStart.bBox.y+dy,endY=dragStart.bBox.y2+dy,dataset=data.dataset,animationManager=dataset.getFromEnv("animationManager"),parent=dataset.getLinkedParent(),chartConfig=dataset.getFromEnv("chartConfig"),canvasLeft=chartConfig.canvasLeft,canvasRight=chartConfig.canvasRight,transform,canvasTop=chartConfig.canvasTop,canvasBottom=chartConfig.canvasBottom;if(startX<canvasLeft){dx+=canvasLeft-startX}if(endX>canvasRight){dx-=endX-canvasRight}if(startY<canvasTop){dy+=canvasTop-startY}if(endY>canvasBottom){dy-=endY-canvasBottom}if(dx||dy){ele.data("fire_click_event",0);parent.hideWaitElem();parent.clearLongPress()}if(config.allowDrag){dragStart.draged=true;dragStart.lastDx=dx;dragStart.lastDy=dy;transform=data._transformObj={transform:"t"+(dragStart.origX+dx)+COMMA+(dragStart.origY+dy)};if(cloneGraphic){animationManager.setAnimation({el:cloneGraphic,attr:transform,component:dataset})}if(cloneImage){animationManager.setAnimation({el:cloneImage,attr:transform,component:dataset})}if(cloneText){animationManager.setAnimation({el:cloneText,attr:{x:config._xPos+dx,y:config._yPos+dy},component:dataset})}}};_proto._getHoveredPlot=function _getHoveredPlot(x,y){var res=this.config.tree.getNeighbour({x:x,y:y},false);if(res){return{pointIndex:res.index||res.i,hovered:true,pointObj:res.data}}};_proto._rolloutResponseSetter=function _rolloutResponseSetter(chart,data,e){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),config=data.config,element=data.graphics.element,dragStart=config.dragStart,unHoverAttr=element.data("unHoverAttr"),keysNo=dragStart&&Object.keys(dragStart).length;if(!keysNo){if(config.shapeType==="poly"||config.shapeType===CIRCLE){unHoverAttr.path=(0,_lib.polyPathToPath)([config.shapeArg.sides,config._xPos,config._yPos,unHoverAttr.r,config.startAngle,0])}config.rollOverProperties.enabled&&animationManager.setAnimation({el:element,attr:unHoverAttr,component:dataset});chart&&chart.plotEventHandler(element,e,ROLLOUT)}};_proto._rolloverResponseSetter=function _rolloverResponseSetter(chart,data,e){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),config=data.config,element=data.graphics.element,dragStart=config.dragStart,hoverAttr=element.data("hoverAttr"),keysNo=dragStart&&Object.keys(dragStart).length;if(!keysNo){if(config.shapeType==="poly"||config.shapeType===CIRCLE){hoverAttr.path=(0,_lib.polyPathToPath)([config.shapeArg.sides,config._xPos,config._yPos,hoverAttr.r,config.startAngle,0])}config.rollOverProperties.enabled&&animationManager.setAnimation({el:element,attr:hoverAttr,component:dataset});chart&&chart.plotEventHandler(element,e,ROLLOVER)}};_proto._dragUp=function _dragUp(event){var element=this,data=element.data("drag-options"),dataset=data.dataset,chart=dataset.getFromEnv("chart"),dataStore=dataset.components.data,dataObj=data.dataObj,ele=dataObj.graphics.element,groupManager=dataset.getLinkedParent(),startConnectors,endConnectors,sourceEvent=DATAPLOTDRAGEND,config=dataObj.config,dragStart=dataObj.config.dragStart||{},yAxis=dataset.getFromEnv("yAxis"),i,setObj,len,eventCord,eventArgs,cloneText=dataObj.graphics.cloneText,xAxis=dataset.getFromEnv("xAxis"),updateObj={},datasetIndex=dataset.config.datasetIndex,cloneGraphic=dataObj.graphics.cloneGraphic,cloneImage=dataObj.graphics.cloneImage;groupManager.hideWaitElem();groupManager.clearLongPress();if(dragStart.draged){dragStart.origX+=dragStart.lastDx;dragStart.origY+=dragStart.lastDy;dataObj.config._xPos=dragStart.xPos+dragStart.lastDx;dataObj.config._yPos=dragStart.yPos+dragStart.lastDy;updateObj.x=xAxis.getValue(dataObj.config._xPos);updateObj.y=yAxis.getValue(dataObj.config._yPos);updateObj.update=true;for(i=0,len=dataStore.length;i<len;i++){setObj=dataStore[i];if(dataObj.config.id===setObj.config.id){break}}dataset.updatePointConfig(updateObj,i);eventArgs=ele.data(EVENTARGS);eventArgs.x=updateObj.x;eventArgs.y=updateObj.y;dataset.parsePlotAttributes(i);dataset._drawNode(i);startConnectors=dataObj.config.startConnectors;endConnectors=dataObj.config.endConnectors;groupManager.drawNodeConnectors(startConnectors,datasetIndex);groupManager.drawNodeConnectors(endConnectors,datasetIndex);eventCord=(0,_lib.getMouseCoordinate)(chart.getFromEnv("chart-container"),event,chart);eventCord.sourceEvent=sourceEvent;chart.fireChartInstanceEvent("chartupdated",(0,_lib.extend2)({sourceEvent:sourceEvent},eventArgs),event);chart.fireChartInstanceEvent(sourceEvent,eventArgs,event);dragStart.draged=false;dataset._setupKdTree()}cloneText&&cloneText.hide();cloneGraphic&&cloneGraphic.hide();cloneImage&&cloneImage.hide();delete config.dragStart};_proto.updatePointConfig=function updatePointConfig(updateConf,index){var dataset=this,dataStore=dataset.components.data,conf=dataset.config,dataObj=dataStore[index]||{},config=dataObj.config,numberFormatter=dataset.getFromEnv("number-formatter"),chartAttr=dataset.getFromEnv("chart-attrib"),xValue;if(config===UNDEF){return}config.y=numberFormatter.getCleanValue((0,_lib.pluck)(updateConf.y));config.x=numberFormatter.getCleanValue((0,_lib.pluck)(updateConf.x));config._options.x=config.x;config._options.y=config.y;xValue=numberFormatter.xAxis(config.x);config.formatedVal=config.y===null?config.y:numberFormatter.dataLabels(config.y);config.xValue=xValue;if(!conf.showTooltip){config.toolText=false}else{config.toolText=_configureTooltext(config,conf,chartAttr)}config.update=updateConf.update};_proto.getNode=function getNode(id){return id?this.components.nodes[id]:this.components.nodes};_proto.configureAttributes=function configureAttributes(datasetJSON){if(datasetJSON){this.trimData(datasetJSON);this.config.JSONData=datasetJSON}else if(!datasetJSON&&!this.config.JSONData){return false}var dataset=this,dIndex=dataset.config.datasetIndex,JSONData=dataset.config.JSONData,data=JSONData.data||[],chartAttr=dataset.getFromEnv("chart-attrib"),chartConfig=dataset.getFromEnv("chartConfig"),dataLength=data.length,conf=dataset.config,ZERO=_lib.ZEROSTRING,colorM=dataset.getFromEnv("color-manager"),index,plotFillAlpha,showPlotBorder,plotBorderColor,plotBorderThickness,plotBorderAlpha,datasetPlotBorderThickness,useRoundEdges,HUNDRED=_lib.HUNDREDSTRING;conf.context={};dataset.components.nodes={};conf.showValues=(0,_lib.pluckNumber)(JSONData.showvalues,chartAttr.showvalues,1);useRoundEdges=conf.useRoundEdges=(0,_lib.pluckNumber)(chartAttr.useroundedges);conf.zIndex=1;conf.name=(0,_lib.getValidValue)(JSONData.seriesname);conf.viewMode=(0,_lib.pluckNumber)(chartAttr.viewmode,0);conf.id=(0,_lib.pluck)(JSONData.id,dataset.index);if((0,_lib.pluckNumber)(JSONData.includeinlegend)===0||conf.name===UNDEF){conf.showInLegend=false}conf.seriesname=(0,_lib.parseUnsafeString)(JSONData.seriesname);conf.includeinlegend=(0,_lib.pluckNumber)(JSONData.includeinlegend,conf.seriesname?1:0);conf.showTooltip=(0,_lib.pluckNumber)(chartAttr.showtooltip,1);conf.seriesNameInTooltip=(0,_lib.pluckNumber)(chartAttr.seriesnameintooltip,1);conf.showTextOutline=(0,_lib.pluckNumber)(chartAttr.textoutline,0);conf.tooltipSepChar=(0,_lib.pluck)(chartAttr.tooltipsepchar," - ");plotFillAlpha=conf.plotFillAlpha=(0,_lib.pluck)(chartAttr.plotfillalpha,HUNDRED);showPlotBorder=conf.showPlotBorder=(0,_lib.pluckNumber)(chartAttr.showplotborder,1);plotBorderColor=conf.plotBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(chartAttr.plotbordercolor,"666666"));plotBorderThickness=conf.plotBorderThickness=(0,_lib.pluckNumber)(chartAttr.plotborderthickness,useRoundEdges?2:1);plotBorderAlpha=conf.plotBorderAlpha=(0,_lib.pluck)(chartAttr.plotborderalpha,chartAttr.plotfillalpha,useRoundEdges?"35":"95");conf.use3DLighting=Boolean((0,_lib.pluckNumber)(chartAttr.use3dlighting,chartAttr.is3d,useRoundEdges?1:0));conf.color=(0,_lib.getFirstColor)((0,_lib.pluck)(JSONData.color,colorM.getPlotColor(dIndex)));conf.alpha=(0,_lib.pluck)(JSONData.plotfillalpha,JSONData.nodeFillAlpha,JSONData.alpha,plotFillAlpha);conf.datasetShowPlotBorder=Boolean((0,_lib.pluckNumber)(JSONData.showplotborder,showPlotBorder));conf.datasetPlotBorderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(JSONData.plotbordercolor,JSONData.nodebordercolor,plotBorderColor));conf.datasetPlotBorderThickness=(0,_lib.pluckNumber)(JSONData.plotborderthickness,JSONData.nodeborderthickness,plotBorderThickness);conf.datasetPlotBorderAlpha=conf.datasetShowPlotBorder?(0,_lib.pluck)(JSONData.plotborderalpha,JSONData.nodeborderalpha,JSONData.alpha,plotBorderAlpha):ZERO;conf.datasetAllowDrag=Boolean((0,_lib.pluckNumber)(JSONData.allowdrag,1));conf.colorObj={fillColor:(0,_lib.convertColor)(conf.color,conf.alpha),lineColor:{FCcolor:{color:conf.datasetPlotBorderColor,alpha:conf.datasetPlotBorderAlpha}}};conf.lineWidth=datasetPlotBorderThickness;conf.symbol=POLY_4;dataset.components.data||(dataset.components.data=[]);dataset.setState("visible",(0,_lib.pluckNumber)(JSONData.visible,!Number(JSONData.initiallyhidden),1)===1);conf.yMin=conf.yMax=conf.xMax=conf.xMin=0;dataset._refreshData=true;for(index=0;index<dataLength;index+=1){this._setConfigure(index)}dataset._refreshData=false;chartConfig.showLegend&&dataset._addLegend();dataset._setDatasetIndex();dataset.setState("dirty",true)};_proto._setConfigure=function _setConfigure(index,updateObj){var dataset=this,JSONData=dataset.config.JSONData,data=JSONData.data,setData=updateObj||data[index],dataStore=dataset.components.data,conf=dataset.config,dataObj=dataStore[index]=dataStore[index]||(dataStore[index]={}),config=dataObj.config=dataObj.config||(dataObj.config={}),datasetId=conf.id,shape,yMin=conf.yMin||+Infinity,yMax=conf.yMax||-Infinity,xMax=conf.xMax||-Infinity,xMin=conf.xMin||+Infinity,itemValueY,itemValueX,label,safeLabel,shapeType,use3DLighting=conf.use3DLighting,datasetPlotBorderThickness=conf.datasetPlotBorderThickness,datasetPlotBorderColor=conf.datasetPlotBorderColor,datasetPlotBorderAlpha=conf.datasetPlotBorderAlpha,chartAttr=dataset.getFromEnv("chart-attrib"),datasetColor=conf.color,datasetAlpha=conf.alpha,datasetAllowDrag=conf.datasetAllowDrag,numberFormatter=dataset.getFromEnv("number-formatter");!dataObj.graphics&&(dataObj.graphics={});config._options=(0,_lib.extend2)({},setData);if(setData||updateObj){itemValueY=config.y=numberFormatter.getCleanValue((0,_lib.pluck)(setData.y));itemValueX=config.x=numberFormatter.getCleanValue((0,_lib.pluck)(setData.x));config.index=index;if(!config.dragStart){config.dragStart={}}yMax=mathMax(yMax,config.y);yMin=mathMin(yMin,config.y);xMax=mathMax(xMax,config.x);xMin=mathMin(xMin,config.x);if(itemValueY===null){config.value=null}else{label=numberFormatter.xAxis(itemValueX);config.formatedVal=itemValueY===null?itemValueY:numberFormatter.dataLabels(itemValueY);config.setTooltext=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(setData.tooltext,JSONData.plottooltext,chartAttr.plottooltext),false));config.pointLabel=(0,_lib.pluck)(setData.label,setData.name);safeLabel=(0,_lib.parseUnsafeString)(config.pointLabel);config.label=safeLabel;config.name=safeLabel;config.displayValue=safeLabel;config.xValue=label;if(!updateObj){config.startConnectors={};config.endConnectors={}}if(!conf.showTooltip){config.toolText=false}else{config.toolText=_configureTooltext(config,conf,chartAttr)}config.link=setData.link;config.id=(0,_lib.pluck)(setData.id,datasetId+_lib.preDefStr.UNDERSCORE+index);config.allowDrag=Boolean((0,_lib.pluckNumber)(setData.allowdrag,datasetAllowDrag));shape=config.shape=(0,_lib.getValidValue)((0,_lib.pluck)(setData.shape),_lib.preDefStr.RECTANGLE).toLowerCase();config.height=(0,_lib.getValidValue)((0,_lib.pluck)(setData.height),10);config.width=(0,_lib.getValidValue)((0,_lib.pluck)(setData.width),10);config.radius=(0,_lib.getValidValue)((0,_lib.pluck)(setData.radius),10);config.numSides=(0,_lib.getValidValue)((0,_lib.pluck)(setData.numsides),4);config.color=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.color,datasetColor));config.borderColor=(0,_lib.getFirstColor)((0,_lib.pluck)(setData.bordercolor,datasetPlotBorderColor));config.alpha=(0,_lib.pluck)(setData.alpha,datasetAlpha);config.imageURL=(0,_lib.getValidValue)(setData.imageurl);config.imageNode=Boolean((0,_lib.pluckNumber)(setData.imagenode));config.imageWidth=setData.imagewidth;config.imageHeight=setData.imageheight;config.imageAlign=(0,_lib.getValidValue)(setData.imagealign,_lib.BLANK).toLowerCase();config.labelAlign=(0,_lib.pluck)(setData.labelalign,config.imageNode&&defined(config.imageURL)?POSITION_TOP:_lib.preDefStr.POSITION_MIDDLE);config.hovercolor=(0,_lib.pluck)(setData.hovercolor,JSONData.hovercolor);config.borderhoveralpha=(0,_lib.pluck)(setData.borderhoveralpha,JSONData.borderhoveralpha);config.borderhovercolor=(0,_lib.pluck)(setData.borderhovercolor,JSONData.borderhovercolor);config.borderhoverthickness=(0,_lib.pluck)(setData.borderhoverthickness,JSONData.borderhoverthickness);config.hoveralpha=(0,_lib.pluck)(setData.hoveralpha,JSONData.hoveralpha);config.hoverheight=(0,_lib.pluck)(setData.hoverheight,JSONData.hoverheight);config.hoverradius=(0,_lib.pluck)(setData.hoverradius,JSONData.hoverradius);config.hoverwidth=(0,_lib.pluck)(setData.hoverwidth,JSONData.hoverwidth);config.dataLabelStyle=dataset._configureDataLabelStyle(setData);switch(config.shape){case CIRCLE:shapeType=0;break;case POLYGON:shapeType=2;shape=(0,_lib.mapSymbolName)(config.numSides);break;default:shapeType=1;break}config.symbol=shape;if(use3DLighting){config.fillColor=getPointColor(config.color,config.alpha,shapeType);config.cloneFillColor=getPointColor(config.color,50,shapeType)}else{config.fillColor={color:config.color,alpha:config.alpha};config.cloneFillColor=(0,_lib.convertColor)(config.color,50)}config.colorArr=[{FCcolor:{color:config.color,alpha:config.alpha}},{FCcolor:{color:config.borderColor,alpha:datasetPlotBorderAlpha}}];config.rollOverProperties=dataset.pointHoverOptions(dataObj,chartAttr,{shapeType:shapeType,use3D:use3DLighting,height:config.height,width:config.width,radius:config.radius,color:config.color,alpha:config.alpha,borderColor:config.borderColor,borderAlpha:datasetPlotBorderAlpha,borderThickness:datasetPlotBorderThickness})}!config.update&&updateObj&&(config.update=updateObj.update);!config.add&&updateObj&&(config.add=updateObj.add);if(dataset._refreshData===true){delete dataObj.removed}}dataObj.dataset=dataset;conf.xMax=xMax;conf.xMin=xMin;conf.yMin=yMin;conf.yMax=yMax};_proto.pointHoverOptions=function pointHoverOptions(dataObj,chartAttr,defaults){var dataset=this,hoverEffect=(0,_lib.pluckNumber)(dataObj.config.showhovereffect,dataset.config.showhovereffect,chartAttr.plothovereffect,chartAttr.showhovereffect),rolloverProperties={},hoverAttr=!!(0,_lib.pluck)(dataObj.config.hovercolor,dataset.config.hovercolor,chartAttr.plotfillhovercolor,dataObj.config.hoveralpha,dataset.config.hoveralpha,chartAttr.plotfillhoveralpha,dataObj.config.borderhovercolor,dataset.config.borderhovercolor,chartAttr.plotborderhovercolor,dataObj.config.borderhoveralpha,dataset.config.borderhoveralpha,chartAttr.plotborderhoveralpha,dataObj.config.borderhoverthickness,dataset.config.borderhoverthickness,chartAttr.plotborderhoverthickness,dataObj.config.hoverheight,dataset.config.hoverheight,chartAttr.plothoverheight,dataObj.config.hoverwidth,dataset.config.hoverwidth,chartAttr.plothoverwidth,dataObj.config.hoverradius,dataset.config.hoverradius,chartAttr.plothoverradius,hoverEffect),enabled=false,color,alpha,rawhoverBorderColor,rawhoverBorderAlpha,fillColor;if(hoverEffect===UNDEF&&hoverAttr||hoverEffect){enabled=true;color=(0,_lib.pluck)(dataObj.config.hovercolor,dataset.config.hovercolor,chartAttr.plotfillhovercolor,(0,_lib.getLightColor)(defaults.color,70));alpha=(0,_lib.pluck)(dataObj.config.hoveralpha,dataset.config.hoveralpha,chartAttr.plotfillhoveralpha,defaults.alpha);rawhoverBorderColor=(0,_lib.pluck)(dataObj.config.borderhovercolor,dataset.config.borderhovercolor,chartAttr.plotborderhovercolor,defaults.borderColor);rawhoverBorderAlpha=(0,_lib.pluckNumber)(dataObj.config.borderhoveralpha,dataset.config.borderhoveralpha,chartAttr.plotborderhoveralpha,alpha,defaults.borderAlpha);rolloverProperties={rawhoverAlpha:alpha,rawhoverColor:color,rawhoverBorderColor:rawhoverBorderColor,rawhoverBorderAlpha:rawhoverBorderAlpha,stroke:(0,_lib.convertColor)(rawhoverBorderColor,(0,_lib.pluckNumber)(dataObj.config.borderhoveralpha,dataset.config.borderhoveralpha,chartAttr.plotborderhoveralpha,alpha,defaults.borderAlpha)),"stroke-width":(0,_lib.pluckNumber)(dataObj.config.borderhoverthickness,dataset.config.borderhoverthickness,chartAttr.plotborderhoverthickness,defaults.borderThickness),height:(0,_lib.pluckNumber)(dataObj.config.hoverheight,dataset.config.hoverheight,chartAttr.plothoverheight,defaults.height),width:(0,_lib.pluckNumber)(dataObj.config.hoverwidth,dataset.config.hoverwidth,chartAttr.plothoverwidth,defaults.width),r:(0,_lib.pluckNumber)(dataObj.config.hoverradius,dataset.config.hoverradius,chartAttr.plothoverradius,defaults.radius)};if(defaults.use3D){fillColor=getPointColor((0,_lib.getFirstColor)((0,_lib.pluck)(dataObj.config.hovercolor,dataset.config.hovercolor,chartAttr.plotfillhovercolor,(0,_lib.getLightColor)(defaults.color,70))),(0,_lib.pluck)(dataObj.config.hoveralpha,dataset.config.hoveralpha,chartAttr.plotfillhoveralpha,defaults.alpha),defaults.shapeType)}else{fillColor=(0,_lib.convertColor)(color,alpha)}rolloverProperties.fill=(0,_lib.toRaphaelColor)(fillColor)}return{enabled:enabled,rollOverAttrs:rolloverProperties}};_proto._addLegend=function _addLegend(){var dataset=this,conf=dataset.config,legendItem,legend=dataset.getFromEnv("legend"),config={enabled:conf.includeInLegend,type:dataset.type,anchorSide:4,label:(0,_lib.getFirstValue)(dataset.config.JSONData.seriesname)};if(conf.includeinlegend){legendItem=legend.getItem(dataset.config.legendItemId);if(!legendItem){dataset.config.legendItemId=legend.createItem(dataset);legendItem=legend.getItem(dataset.config.legendItemId);dataset.addExtEventListener("fc-click",(function(){legendItem.itemClickFn()}),legendItem)}else{legendItem.configure({style:legend.config.itemStyle,hiddenStyle:legend.config.itemHiddenStyle,datasetVisible:legend.config.datasetVisible,hoverStyle:legend.config.itemHoverStyle})}legendItem.configure(config);legendItem.setStateCosmetics("default",{symbol:{fill:(0,_lib.toRaphaelColor)({color:conf.color,alpha:conf.alpha}),rawFillColor:conf.color,stroke:(0,_lib.toRaphaelColor)({color:conf.plotBorderColor,alpha:_lib.HUNDREDSTRING}),"stroke-width":conf.anchorBorderThickness}});if(!dataset.getState("visible")){legendItem.setLegendState("hidden")}else{legendItem.removeLegendState("hidden")}}else if(dataset.config.legendItemId){legend.disposeItem(dataset.config.legendItemId)}};_proto.createContainer=function createContainer(){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),parentContainer=dataset.getLinkedParent().getChildContainer();!dataset.getContainer("nodesGroup")&&dataset.addContainer("nodesGroup",createGroup("nodesGroup",animationManager,parentContainer.defaultVcanvasGroup,dataset));!dataset.getContainer("dataLabelsGroup")&&dataset.addContainer("dataLabelsGroup",createGroup("dataLabelsGroup",animationManager,parentContainer.vcanvasLabelGroup,dataset));!dataset.getContainer("cloneGraphicGroup")&&dataset.addContainer("cloneGraphicGroup",createGroup("cloneGraphicGroup",animationManager,parentContainer.defaultVcanvasGroup,dataset))};_proto.draw=function draw(){var dataset=this,components=dataset.components,smartLabel=dataset.getFromEnv("smartLabel"),data=components.data,removeDataArr=dataset.components.removeDataArr||[],removeDataArrLen=removeDataArr.length,i,ln,group,style=dataset.getFromEnv("dataLabelStyle"),css={fontFamily:style.fontFamily,fontSize:style.fontSize,lineHeight:style.lineHeight,fontWeight:style.fontWeight,fontStyle:style.fontStyle},removed;if(!dataset.getState("dirty")&&!dataset._contextChanged()){return}dataset.createContainer();group=dataset.getContainer("nodesGroup");dataset.getFromEnv("animationManager").setAnimation({el:dataset.getContainer("cloneGraphicGroup"),attr:{opacity:.3},component:dataset});group.css(css);smartLabel.useEllipsesOnOverflow(dataset.getFromEnv("chartConfig").useEllipsesWhenOverflow);for(i=0,ln=data.length;i<ln;i+=1){removed=data[i].removed;!removed&&this._drawNode(i)}dataset.config.drawn=true;for(i=0;i<removeDataArrLen;i++){dataset._removeDataVisuals(removeDataArr.shift())}dataset._setupKdTree()};_proto._setupKdTree=function _setupKdTree(){var dataset=this,conf=dataset.config,data=dataset.components.data,dataLen,i,config,attr,maxRadius=-Infinity,searchDataArr;searchDataArr=conf.searchDataArr=[];dataLen=data.length;for(i=0;i<dataLen;i++){config=data[i].config;if(!data[i].removed&&config._yPos!==UNDEF&&!isNaN(config._yPos)){attr=config.props.element.attr;maxRadius=Math.max(maxRadius,(0,_lib.pluckNumber)(config.radius,0));searchDataArr.push({x:(0,_lib.pluckNumber)(attr.x,config._xPos),y:(0,_lib.pluckNumber)(attr.y,config._yPos),index:i,data:data[i],shapeInfo:{type:config.shape,radius:(0,_lib.pluck)(config.radius,0),width:(0,_lib.pluckNumber)(config.width),height:(0,_lib.pluckNumber)(config.height),sides:(0,_lib.pluckNumber)(config.numSides)}})}}conf.tree=new _kdtree.default(true).buildKdTree(searchDataArr);conf.tree._setSearchLimit(maxRadius,maxRadius)};_proto.drawLabel=function drawLabel(index){var dataset=this,chart=dataset.getFromEnv("chart"),conf=dataset.config,datasetIndex=conf.datasetIndex,animationManager=dataset.getFromEnv("animationManager"),dataStore=dataset.components.data,i,len=dataStore.length,labelAttrs,labelElement,plotLabelStyle,group=dataset.getContainer("nodesGroup"),config,valueString,chartConfig=dataset.getFromEnv("chartConfig"),style=dataset.getFromEnv("dataLabelStyle"),cursor,smartTextObj,labelDisplacement,eventArgs,set,yAdjustment,xPos,labelY,groupId,cloneText,plotWidth,plotHeight,labelAlign,setGraphics,dragUp=dataset.dragUp,dragMove=dataset.dragMove,dragStart=dataset.dragStart,rollOverProperties,shapeType,yPos,smartLabel=dataset.getFromEnv("smartLabel"),setElement,visible=dataset.getState("visible");smartLabel.setStyle(style);if(index!==UNDEF){i=index;len=i+1}else{i=0}for(;i<len;i++){set=dataStore[i];config=set.config;plotWidth=config._plotWidth;plotHeight=config._plotHeight;valueString=config.displayValue;labelAlign=config.labelAlign;setGraphics=set.graphics;cloneText=setGraphics.cloneText;rollOverProperties=set.config.rollOverProperties;shapeType=config.shapeType;if(visible&&defined(valueString)&&valueString!==_lib.BLANK){smartLabel.useEllipsesOnOverflow(chartConfig.useEllipsesWhenOverflow);smartTextObj=smartLabel.getSmartText(valueString,plotWidth-PADDING,plotHeight-PADDING);labelDisplacement=plotHeight*.5-smartTextObj.height*.5;switch(labelAlign){case POSITION_TOP:labelDisplacement=-labelDisplacement;break;case _lib.POSITION_BOTTOM:break;default:labelDisplacement=0;break}xPos=config._xPos;yPos=config._yPos;set._yAdjustment=yAdjustment=labelDisplacement;labelY=yPos+yAdjustment;cursor=config.link?_lib.POINTER:config.allowDrag?"move":_lib.BLANKSTRING;plotLabelStyle=config.dataLabelStyle;labelAttrs={text:smartTextObj.text,title:smartTextObj.tooltext||_lib.BLANKSTRING,fill:plotLabelStyle.color,"text-bound":[plotLabelStyle.backgroundColor,plotLabelStyle.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash],x:xPos,y:labelY,cursor:cursor};labelElement=setGraphics.label;labelElement=animationManager.setAnimation({el:labelElement||"text",attr:labelAttrs,container:group,component:dataset});labelElement.outlineText(conf.showTextOutline,labelAttrs.fill);if(!setGraphics.label){labelElement=dataset.addGraphicalElement("plotLabel",labelElement,true);setGraphics.label=labelElement;labelElement.drag(dragMove,dragStart,dragUp)}else{labelElement.show()}setElement=setGraphics&&(setGraphics.image||setGraphics.element);if(cloneText){animationManager.setAnimation({el:cloneText,attr:{transform:_lib.BLANKSTRING,x:xPos,y:labelY,text:smartTextObj.text,title:smartTextObj.tooltext||_lib.BLANKSTRING,fill:style.color,"text-bound":[style.backgroundColor,style.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash]},component:dataset})}labelElement.data("drag-options",{dataObj:set,dataset:dataset,datasetIndex:datasetIndex,pointIndex:set.config.index,cursor:cursor,chart:chart,link:set.link});eventArgs={index:i,link:config.link,y:config.y,x:config.x,shape:(0,_lib.pluck)(shapeType,"rect"),width:config.width,height:config.height,radius:config.radius,sides:config.numSides,label:config.displayValue,toolText:config.toolText,id:config.id,datasetIndex:datasetIndex,datasetName:dataset.config.JSONData.seriesname,sourceType:"dataplot",allowDrag:config.allowDrag,numSides:config.numSides,imageNode:config.imageNode,imageAlign:config.imageAlign,imageWidth:config.imageWidth,imageHeight:config.imageHeight,labelAlign:config.labelAlign,color:config.color,alpha:config.alpha,hoverColor:config.rollOverProperties.rollOverAttrs.rawhoverColor,hoverAlpha:config.rollOverProperties.rollOverAttrs.rawhoverAlpha,borderHoverColor:config.rollOverProperties.rollOverAttrs.rawhoverBorderColor,borderHoverAlpha:config.rollOverProperties.rollOverAttrs.rawhoverBorderAlpha,borderHoverThickness:config.rollOverProperties.rollOverAttrs["stroke-width"],hoverHeight:config.rollOverProperties.rollOverAttrs.height,hoverWidth:config.rollOverProperties.rollOverAttrs.width,hoverRadius:config.rollOverProperties.rollOverAttrs.r};groupId=datasetIndex+"_"+i;labelElement.data(GROUPID,groupId);labelElement.data(EVENTARGS,eventArgs);labelElement.data("hoverAttr",rollOverProperties&&rollOverProperties.rollOverAttrs);labelElement.data("unHoverAttr",setElement.data("unHoverAttr"))}else{setGraphics.label&&setGraphics.label.hide()}}};_proto.parsePlotAttributes=function parsePlotAttributes(i){var dataset=this,datasetIndex=dataset.config.datasetIndex,datasetComponents=dataset.components,nodes=datasetComponents.nodes,xAxis=dataset.getFromEnv("xAxis"),yAxis=dataset.getFromEnv("yAxis"),data=datasetComponents.data,set=data[i],config=set.config,conf=dataset.config,xPos,yPos,setGraphics=set.graphics||(set.graphics={}),symbol=config.symbol,width,height,radius,id,imageNode,confShapeArg,imageURL,imageAlign,lineColor=conf.colorObj.lineColor,lineWidth=conf.datasetPlotBorderThickness,plotWidth,plotHeight,isRectangle,rollOverProperties=set.config.rollOverProperties,imageWidth,imageHeight,imageY,pointAttr,fill,shapeType=config.shape,cursor=config.link?_lib.POINTER:config.allowDrag?"move":_lib.BLANKSTRING,rollOverAttrs,polypath,cloneImage=setGraphics.cloneImage,attr,cloneImageAttr,imageElementAttr;config._yPos=yPos=yAxis.getPixel(config.y);config._xPos=xPos=xAxis.getPixel(config.x);if(yPos!==UNDEF&&!isNaN(yPos)){config.shapeArg={};confShapeArg=config.shapeArg;height=(0,_lib.pluckNumber)(config.height);width=(0,_lib.pluckNumber)(config.width);radius=(0,_lib.pluckNumber)(config.radius);isRectangle=symbol===RECTANGLE;id=config.id;imageNode=config.imageNode;imageURL=config.imageURL;imageAlign=config.imageAlign;plotWidth=isRectangle?width:radius*1.4;imageWidth=(0,_lib.pluckNumber)(config.imageWidth,plotWidth);plotHeight=isRectangle?height:radius*1.4;imageHeight=(0,_lib.pluckNumber)(config.imageHeight,plotHeight);fill=(0,_lib.toRaphaelColor)(config.fillColor);config._plotWidth=plotWidth;config._plotHeight=plotHeight;pointAttr={fill:fill,"stroke-width":lineWidth,stroke:(0,_lib.toRaphaelColor)(lineColor)};symbol=confShapeArg.symbol=(0,_lib.pluck)(config.symbol,conf.symbol,_lib.BLANK);symbol=symbol.split(UNDERSCORE);polypath=[symbol[1],xPos,yPos,config.radius,config.startAngle,0];if(symbol[0]==="poly"||symbol[0]===CIRCLE){config.shapeType=symbol[0];config.elemType=PATH;attr={path:(0,_lib.polyPathToPath)(polypath)};confShapeArg.x=xPos;confShapeArg.y=yPos;confShapeArg.radius=config.radius;confShapeArg.sides=symbol[1];pointAttr.r=config.radius;delete pointAttr.width;delete pointAttr.x;delete pointAttr.y;delete pointAttr.height;if(rollOverProperties&&rollOverProperties.enabled){rollOverAttrs=rollOverProperties.rollOverAttrs;delete rollOverAttrs.x;delete rollOverAttrs.y;delete rollOverAttrs.width;delete rollOverAttrs.height}}else{config.shapeType=_lib.SHAPE_RECT;config.elemType=_lib.SHAPE_RECT;confShapeArg.x=xPos-width/2;confShapeArg.y=yPos-height/2;confShapeArg.r=0;confShapeArg.width=width;confShapeArg.height=height;attr={x:confShapeArg.x,y:confShapeArg.y,width:width,height:height,r:0};pointAttr.width=width;pointAttr.height=height;pointAttr.x=xPos-width/2;pointAttr.y=yPos-height/2;if(rollOverProperties&&rollOverProperties.enabled){rollOverAttrs=rollOverProperties.rollOverAttrs;rollOverAttrs.x=xPos-rollOverAttrs.width/2;rollOverAttrs.y=yPos-rollOverAttrs.height/2;delete rollOverAttrs.r}}attr.fill=fill;attr["stroke-width"]=lineWidth;attr.stroke=(0,_lib.toRaphaelColor)(lineColor);config.eventArgs={index:i,link:config.link,y:config.y,x:config.x,shape:(0,_lib.pluck)(shapeType,"rect"),width:width,height:height,radius:radius,sides:config.numSides,label:config.displayValue,toolText:config.toolText,id:config.id,datasetIndex:datasetIndex,datasetName:dataset.config.JSONData.seriesname,sourceType:"dataplot",allowDrag:config.allowDrag,numSides:config.numSides,imageNode:config.imageNode,imageAlign:config.imageAlign,imageWidth:config.imageWidth,imageHeight:config.imageHeight,labelAlign:config.labelAlign,color:config.color,alpha:config.alpha,hoverColor:config.rollOverProperties.rollOverAttrs.rawhoverColor,hoverAlpha:config.rollOverProperties.rollOverAttrs.rawhoverAlpha,borderHoverColor:config.rollOverProperties.rollOverAttrs.rawhoverBorderColor,borderHoverAlpha:config.rollOverProperties.rollOverAttrs.rawhoverBorderAlpha,borderHoverThickness:config.rollOverProperties.rollOverAttrs["stroke-width"],hoverHeight:config.rollOverProperties.rollOverAttrs.height,hoverWidth:config.rollOverProperties.rollOverAttrs.width,hoverRadius:config.rollOverProperties.rollOverAttrs.r};if(imageNode&&imageURL){if(imageHeight>plotHeight){imageHeight=plotHeight}if(imageWidth>plotWidth){imageWidth=plotWidth}switch(imageAlign){case _lib.POSITION_MIDDLE:imageY=yPos-imageHeight/2;break;case _lib.POSITION_BOTTOM:imageY=plotHeight>imageHeight?yPos+plotHeight/2-imageHeight:yPos-imageHeight/2;break;default:imageY=plotHeight>imageHeight?yPos-plotHeight*.5:yPos-imageHeight/2;break}config.imageX=xPos-imageWidth/2;config.imageY=imageY;config.imageWidth=imageWidth;config.imageHeight=imageHeight;imageElementAttr={src:imageURL,x:config.imageX,y:imageY,width:imageWidth,height:imageHeight,cursor:cursor};if(cloneImage){cloneImageAttr={transform:_lib.BLANKSTRING,src:imageURL,x:config.imageX,y:imageY,width:imageWidth,height:imageHeight}}}config.pointAttr=pointAttr;nodes[id]=set;config.props={element:{attr:attr},imageElement:{attr:imageElementAttr},cloneImage:{attr:cloneImageAttr},cloneGraphic:{attr:attr}}}};_proto.allocatePosition=function allocatePosition(index){var dataset=this,data=dataset.components.data,i,len;len=data.length;if(index!==UNDEF){dataset.parsePlotAttributes(index)}else{for(i=0;i<len;i++){dataset.parsePlotAttributes(i)}}};_proto._drawNode=function _drawNode(i){var dataset=this,chart=dataset.getFromEnv("chart"),datasetIndex=dataset.config.datasetIndex,manager=dataset.getLinkedParent(),datasetComponents=dataset.components,animationManager=dataset.getFromEnv("animationManager"),data=datasetComponents.data,set=data[i],config=set.config,setGraphics=set.graphics||(set.graphics={}),groupId,imageNode=config.imageNode,imageURL=config.imageURL,group=dataset.getContainer("nodesGroup"),rollOverProperties=set.config.rollOverProperties,dragUp=dataset.dragUp,dragMove=dataset.dragMove,dragStart=dataset.dragStart,cursor=config.link?_lib.POINTER:config.allowDrag?"move":_lib.BLANKSTRING,type,setElement=setGraphics.graphic,cloneText=setGraphics.cloneText,cloneGraphic=setGraphics.cloneGraphic,cloneImage=setGraphics.cloneImage,imageElement=setGraphics.image,labelElement=setGraphics.label,visible=dataset.getState("visible");if(config._yPos!==UNDEF&&!isNaN(config._yPos)){setElement=setGraphics.element;type=setElement&&setElement.type;if(config.elemType.indexOf(type)===-1&&setElement){setElement.remove();setElement=setGraphics.element=null;labelElement&&labelElement.remove();imageElement&&imageElement.remove();delete setGraphics.label;delete setGraphics.image;imageElement=null;labelElement=null}setElement=animationManager.setAnimation({el:setElement||config.elemType,label:"node",attr:config.props.element.attr,container:group,component:dataset});if(!setGraphics.graphic){setElement.drag(dragMove,dragStart,dragUp)}setGraphics.element=setElement;setElement.show();manager.animationDone=true;groupId=datasetIndex+"_"+i;if(cloneGraphic){if(cloneGraphic.type===setElement.type){animationManager.setAnimation({el:cloneGraphic,attr:config.props.element.attr,component:dataset}).transform(_lib.BLANKSTRING)}else{cloneGraphic.remove();delete set.graphics.cloneGraphic;if(cloneText){cloneText.remove();delete set.graphics.cloneText}}}if(imageNode&&imageURL){imageElement=animationManager.setAnimation({el:setGraphics.image||"image",attr:visible&&config.props.imageElement.attr,doNotRemove:true,container:group,component:dataset,callback:!visible&&hideFn});if(!setGraphics.image&&imageElement){imageElement.drag(dragMove,dragStart,dragUp)}setGraphics.image=imageElement;visible&&imageElement.show();imageElement.data("drag-options",{dataObj:set,dataset:dataset,datasetIndex:dataset.index,pointIndex:set.config.index,cursor:cursor,link:set.link});imageElement.data(GROUPID,groupId);imageElement.data(EVENTARGS,config.eventArgs);imageElement.data("hoverAttr",rollOverProperties&&rollOverProperties.rollOverAttrs);imageElement.data("unHoverAttr",config.pointAttr);if(cloneImage){animationManager.setAnimation({el:cloneImage,attr:config.props.cloneImage.attr,component:dataset})}}else if(setGraphics.image){setGraphics.image=animationManager.setAnimation({el:setGraphics.image,component:dataset})}dataset.drawLabel(i);animationManager.setAnimation({el:setElement,attr:{cursor:cursor},component:dataset});setElement.data("drag-options",{dataObj:set,dataset:dataset,datasetIndex:dataset.index,pointIndex:set.config.index,cursor:cursor,chart:chart,link:set.link});setElement.data(GROUPID,groupId);setElement.data(EVENTARGS,config.eventArgs);setElement.data("hoverAttr",rollOverProperties&&rollOverProperties.rollOverAttrs);setElement.data("unHoverAttr",config.pointAttr);visible?setElement.show():setElement.hide()}else{setGraphics.element&&(setGraphics.element=animationManager.setAnimation({el:setGraphics.element,component:dataset}));setGraphics.image&&(setGraphics.image=animationManager.setAnimation({el:setGraphics.image,component:dataset}));setGraphics.label&&(setGraphics.label=animationManager.setAnimation({el:setGraphics.label,component:dataset}))}};_proto.trimData=function trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,prevData=dataSet.components,prevDataLength=prevData.data&&prevData.data.length,currDataLength=datasetJSON.data&&datasetJSON.data.length||0,dataDiff=prevDataLength-currDataLength;if(dataDiff>0){dataSet.removeData(currDataLength,dataDiff)}};_proto.removeData=function removeData(indexVal,stretchVal){var dataSet=this,index=indexVal,stretch=stretchVal,components=dataSet.components,manager=dataSet.getLinkedParent(),dataStore=components.data,removeDataArr=components.removeDataArr||(components.removeDataArr=[]);stretch=stretch||1;index=index||0;if(index<0){index=0}components.removeDataArr=removeDataArr=removeDataArr.concat(dataStore.splice(index,stretch));manager._clearConnectors()};_proto._removeDataVisuals=function _removeDataVisuals(dataObj){var dataSet=this,ele,graphics,graphicsObj;if(!dataObj){return}graphics=dataObj.graphics;for(ele in graphics){graphicsObj=graphics[ele];if(graphicsObj.hide&&typeof graphicsObj.hide==="function"){dataSet.getFromEnv("animationManager").setAnimation({el:graphicsObj,attr:{"text-bound":[]},component:dataSet});graphicsObj.hide();graphicsObj.transform&&graphicsObj.transform(_lib.BLANKSTRING)}}};_proto.getJSONData=function getJSONData(){var dataset=this,dataStore=dataset.components.data,len=dataStore.length,jsonData=[],dataObj,i;for(i=0;i<len;i++){dataObj=dataStore[i];if(!dataObj.removed){if(dataObj.config._options){delete dataObj.config._options.update;delete dataObj.config._options.add;jsonData.push(dataObj.config._options)}}}return jsonData};return DragNodeDataset}(_area.default);var _default=DragNodeDataset;exports.default=_default;