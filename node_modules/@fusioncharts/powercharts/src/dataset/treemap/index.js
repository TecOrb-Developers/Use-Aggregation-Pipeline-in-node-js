"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _componentInterface=require("@fusioncharts/core/src/component-interface");var _schedular=require("@fusioncharts/core/src/schedular");var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _index=_interopRequireDefault(require("./index.animation"));var UNDEF,HIDDEN="hidden",DEFAULT_CURSOR=_lib.preDefStr.DEFAULT,POINTER="pointer",MOUSEOVER="mouseOver",ROLLOVER="DataPlotRollOver",HIDDEN_STR="hidden",ROUND_STR="round",createGroup=function createGroup(groupName,parentContainer,dataset){return dataset.getFromEnv("animationManager").setAnimation({el:"group",attr:{name:groupName},container:parentContainer,state:"appearing",component:dataset,doNotRemove:true,label:"group"})},inRange=function inRange(a,r1,r2){return a>=r1&&a<=r2},swap=function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp},kdTreeAbs=function kdTreeAbs(arrVal){"use strict";var arr=arrVal,tolerance=arr&&arr[0]&&arr[0].plotDetails.rect||5,i,max=Math.max,floor=Math.floor,sqrt=Math.sqrt,min=Math.min,log=Math.log,exp=Math.exp,pow=Math.pow,result={};arr=arr||[];for(i=arr.length;i--;){if(arr[i].r>tolerance){tolerance=arr[i].r}arr[i].x=+arr[i].plotDetails.rect.x;arr[i].y=+arr[i].plotDetails.rect.y}function buildKdTree(arr,leftVal,rightVal,isY){var ob={},mid,left=leftVal,right=rightVal,access=isY?"y":"x";if(left===right){ob.point=arr[left];return ob}if(right-left===1){if(arr[left][access]>arr[right][access]){ob.point=arr[left];ob.left={point:arr[right]}}else{ob.point=arr[right];ob.left={point:arr[left]}}return ob}mid=left+right>>1;if(isY){quickselectY(arr,mid,left,right)}else{quickselectX(arr,mid,left,right)}ob.point=arr[mid];ob.left=buildKdTree(arr,left,mid-1,!isY);ob.right=buildKdTree(arr,mid+1,right,!isY);return ob}function quickselectX(arr,k,leftVal,rightVal){var left=leftVal,right=rightVal,n,m,z,s,sd,newLeft,newRight,t,i,j;while(right>left){if(right-left>600){n=right-left+1;m=k-left+1;z=log(n);s=.5*exp(2*z/3);sd=.5*sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);newLeft=max(left,floor(k-m*s/n+sd));newRight=min(right,floor(k+(n-m)*s/n+sd));quickselectX(arr,k,newLeft,newRight)}t=arr[k];i=left;j=right;swap(arr,left,k);if(arr[right].x>t.x){swap(arr,left,right)}while(i<j){swap(arr,i,j);i++;j--;while(arr[i].x<t.x){i++}while(arr[j].x>t.x){j--}}if(arr[left].x===t.x){swap(arr,left,j)}else{j++;swap(arr,j,right)}if(j<=k){left=j+1}if(k<=j){right=j-1}}}function quickselectY(arr,k,leftVal,rightVal){var left=leftVal,right=rightVal,n,m,z,s,sd,newLeft,newRight,t,i,j;while(right>left){if(right-left>600){n=right-left+1;m=k-left+1;z=log(n);s=.5*exp(2*z/3);sd=.5*sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);newLeft=max(left,floor(k-m*s/n+sd));newRight=min(right,floor(k+(n-m)*s/n+sd));quickselectY(arr,k,newLeft,newRight)}t=arr[k];i=left;j=right;swap(arr,left,k);if(arr[right].y>t.y){swap(arr,left,right)}while(i<j){swap(arr,i,j);i++;j--;while(arr[i].y<t.y){i++}while(arr[j].y>t.y){j--}}if(arr[left].y===t.y){swap(arr,left,j)}else{j++;swap(arr,j,right)}if(j<=k){left=j+1}if(k<=j){right=j-1}}}result={tree:buildKdTree(arr,0,arr.length-1,false),search:function search(x,y){function apply(ob){var currentHovered=inRange(x,ob.x1,ob.x2)&&inRange(y,ob.y1,ob.y2),currentDist=calcDist(x,y,ob.point.x,ob.point.y);if(!res){res=ob;lastHovered=currentHovered;lastDist=currentDist;return}if(currentHovered){if(lastHovered){if(ob.point.i>res.point.i){res=ob;lastHovered=currentHovered;lastDist=currentDist}}else{res=ob;lastHovered=currentHovered;lastDist=currentDist}}else{if(!lastHovered){if(currentDist<lastDist){res=ob;lastHovered=currentHovered;lastDist=currentDist}}}}function calcDist(x,y,p,q){return sqrt(pow(x-p,2)+pow(y-q,2))}function searchX(ob){if(!ob||!ob.point){return}if(inRange(ob.point.x,x1,x2)&&inRange(ob.point.y,y1,y2)){apply(ob)}if(x1<=ob.point.x){searchY(ob.left)}if(x2>=ob.point.x){searchY(ob.right)}}function searchY(ob){if(!ob||!ob.point){return}if(inRange(ob.point.x,x1,x2)&&inRange(ob.point.y,y1,y2)){apply(ob)}if(y1<=ob.point.y){searchX(ob.left)}if(y2>=ob.point.y){searchX(ob.right)}}var tree=this.tree,res,x1=x-tolerance,x2=x+tolerance,y1=y-tolerance,y2=y+tolerance,lastHovered=false,lastDist=0;searchX(tree);return res&&res.point||res},searchTreemap:function searchTreemap(x,y){var res,apply=function apply(ob){if(!res){res=ob;return}if(ob.i>res.i){res=ob}},search=function search(ob,isY){if(!ob||!ob.point){return}var x1=ob.point.x,x2=x1+ob.point.plotDetails.rect.width,y1=ob.point.y,y2=y1+ob.point.plotDetails.rect.height;ob.point.x2=x2;ob.point.y2=y2;if(x>=x1&&x<=x2&&y>=y1&&y<=y2){apply(ob.point)}search(ob.left,!isY);search(ob.right,!isY)};search(this.tree,false);return res}};arr.sort((function(a,b){return a.i-b.i}));return result};(0,_dependencyManager.addDep)({name:"treeMapAnimation",type:"animationRule",extension:_index.default});var TreeMapDS=function(_ComponentInterface){(0,_inheritsLoose2.default)(TreeMapDS,_ComponentInterface);function TreeMapDS(){var _this;_this=_ComponentInterface.call(this)||this;var datasetDefStore=(0,_assertThisInitialized2.default)(_this);datasetDefStore.components={};datasetDefStore.conf={};datasetDefStore.graphics={elemStore:{rect:[],label:[],highlight:[],hot:[],polypath:[]}};return _this}var _proto=TreeMapDS.prototype;_proto.getName=function getName(){return"treeMap"};_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return}this.config.JSONData=datasetJSON.data[0];var algorithm,maxDepth,showNavigationBar,datasetDefStore=this,chart=datasetDefStore.getFromEnv("chart"),dsConf=datasetDefStore.conf,rawChartAttr=chart.getFromEnv("chart-attrib");dsConf.metaTreeInf={};algorithm=rawChartAttr.algorithm||"squarified";dsConf.algorithm=algorithm.toLowerCase();dsConf.range=UNDEF;dsConf.horizontalPadding=(0,_lib.pluckNumber)(rawChartAttr.horizontalpadding,5);dsConf.horizontalPadding=dsConf.horizontalPadding<0?0:dsConf.horizontalPadding;dsConf.verticalPadding=(0,_lib.pluckNumber)(rawChartAttr.verticalpadding,5);dsConf.verticalPadding=dsConf.verticalPadding<0?0:dsConf.verticalPadding;dsConf.showParent=(0,_lib.pluckNumber)(rawChartAttr.showparent,1);dsConf.showChildLabels=(0,_lib.pluckNumber)(rawChartAttr.showchildlabels,0);dsConf.showHoverEffect=(0,_lib.pluckNumber)(rawChartAttr.showhovereffect,1);dsConf.highlightParentsOnHover=(0,_lib.pluckNumber)(rawChartAttr.highlightparentsonhover,0);dsConf.defaultParentBGColor=(0,_lib.pluck)(rawChartAttr.defaultparentbgcolor,UNDEF);dsConf.defaultNavigationBarBGColor=(0,_lib.pluck)(rawChartAttr.defaultnavigationbarbgcolor,dsConf.defaultParentBGColor);dsConf.showTooltip=(0,_lib.pluckNumber)(rawChartAttr.showtooltip,1);dsConf.baseFontSize=(0,_lib.pluckNumber)(rawChartAttr.basefontsize,10);dsConf.baseFontSize=dsConf.baseFontSize<1?1:dsConf.baseFontSize;dsConf.labelFontSize=(0,_lib.pluckNumber)(this.computeFontSize(rawChartAttr.labelfontsize),UNDEF);dsConf.labelFontSize=dsConf.labelFontSize<1?1:dsConf.labelFontSize;dsConf.baseFont=(0,_lib.pluck)(rawChartAttr.basefont,"Verdana, Sans");dsConf.labelFont=(0,_lib.pluck)(rawChartAttr.labelfont,UNDEF);dsConf.showTextOutline=(0,_lib.pluckNumber)(rawChartAttr.textoutline,0);dsConf.baseFontColor=(0,_lib.pluck)(rawChartAttr.basefontcolor,"#000000").replace(/^#?([a-f0-9]+)/gi,"#$1");dsConf.labelFontColor=(0,_lib.pluck)(rawChartAttr.labelfontcolor,UNDEF);dsConf.labelFontColor&&(dsConf.labelFontColor=dsConf.labelFontColor.replace(/^#?([a-f0-9]+)/gi,"#$1"));dsConf.labelFontBold=(0,_lib.pluckNumber)(rawChartAttr.labelfontbold,0);dsConf.labelFontItalic=(0,_lib.pluckNumber)(rawChartAttr.labelfontitalic,0);dsConf.plotBorderThickness=(0,_lib.pluckNumber)(rawChartAttr.plotborderthickness,1);dsConf.plotBorderThickness=dsConf.plotBorderThickness<0?0:dsConf.plotBorderThickness>5?5:dsConf.plotBorderThickness;dsConf.plotBorderColor=(0,_lib.pluck)(rawChartAttr.plotbordercolor,"#000000").replace(/^#?([a-f0-9]+)/gi,"#$1");dsConf.tooltipSeparationCharacter=(0,_lib.pluck)(rawChartAttr.tooltipsepchar,",");dsConf.plotToolText=(0,_lib.parseUnsafeString)((0,_lib.pluck)(rawChartAttr.plottooltext,""),false);dsConf.parentLabelLineHeight=(0,_lib.pluckNumber)(rawChartAttr.parentlabellineheight,12);dsConf.parentLabelLineHeight=dsConf.parentLabelLineHeight<0?0:dsConf.parentLabelLineHeight;dsConf.labelGlow=dsConf.showTextOutline?0:(0,_lib.pluckNumber)(rawChartAttr.labelglow,1);dsConf.labelGlowIntensity=(0,_lib.pluckNumber)(rawChartAttr.labelglowintensity,100)/100;dsConf.labelGlowIntensity=dsConf.labelGlowIntensity<0?0:dsConf.labelGlowIntensity>1?1:dsConf.labelGlowIntensity;dsConf.labelGlowColor=(0,_lib.pluck)(rawChartAttr.labelglowcolor,"#ffffff").replace(/^#?([a-f0-9]+)/gi,"#$1");dsConf.labelGlowRadius=(0,_lib.pluckNumber)(rawChartAttr.labelglowradius,2);dsConf.labelGlowRadius=dsConf.labelGlowRadius<0?0:dsConf.labelGlowRadius>10?10:dsConf.labelGlowRadius;dsConf.btnResetChartTooltext=(0,_lib.pluck)(rawChartAttr.btnresetcharttooltext,"Back to Top");dsConf.btnBackChartTooltext=(0,_lib.pluck)(rawChartAttr.btnbackcharttooltext,"Back to Parent");dsConf.rangeOutBgColor=(0,_lib.pluck)(rawChartAttr.rangeoutbgcolor,"#808080").replace(/^#?([a-f0-9]+)/gi,"#$1");dsConf.rangeOutBgAlpha=(0,_lib.pluckNumber)(rawChartAttr.rangeoutbgalpha,100);dsConf.rangeOutBgAlpha=dsConf.rangeOutBgAlpha<1||dsConf.rangeOutBgAlpha>100?100:dsConf.rangeOutBgAlpha;maxDepth=(0,_lib.pluckNumber)(rawChartAttr.maxdepth);dsConf.maxDepth=maxDepth!==UNDEF?Math.max(maxDepth,1):UNDEF;showNavigationBar=dsConf.showNavigationBar=(0,_lib.pluckNumber)(rawChartAttr.shownavigationbar,1);dsConf.slicingMode=(0,_lib.pluck)(rawChartAttr.slicingmode,"alternate");dsConf.navigationBarHeight=(0,_lib.pluckNumber)(rawChartAttr.navigationbarheight);dsConf.navigationBarHeightRatio=(0,_lib.pluckNumber)(rawChartAttr.navigationbarheightratio);dsConf.navigationBarBorderColor=(0,_lib.pluck)(rawChartAttr.navigationbarbordercolor,dsConf.plotBorderColor).replace(/^#?([a-f0-9]+)/gi,"#$1");dsConf.navigationBarBorderThickness=showNavigationBar?(0,_lib.pluckNumber)(rawChartAttr.navigationbarborderthickness,dsConf.plotBorderThickness):0;dsConf.seperatorAngle=(0,_lib.pluckNumber)(rawChartAttr.seperatorangle)*(Math.PI/180);dsConf.isConfigured=true;datasetDefStore.setState("dirty",true)};_proto.createContainer=function createContainer(){var dataset=this,datasetGroup,datalabelGroup,trackerGroup,labelHighlightGroup,parentContainer=dataset.getLinkedParent().getChildContainer();datasetGroup=dataset.getContainer("plots")||dataset.addContainer("plots",createGroup("plots",parentContainer.defaultGroup,dataset));datalabelGroup=dataset.getContainer("datalabels")||dataset.addContainer("datalabels",createGroup("datalabels",parentContainer.defaultGroup,dataset).insertAfter(datasetGroup));trackerGroup=dataset.getContainer("tracker")||dataset.addContainer("tracker",createGroup("tracker",parentContainer.defaultGroup,dataset));!dataset.getContainer("line-hot")&&dataset.addContainer("line-hot",createGroup("line-hot",trackerGroup,dataset));labelHighlightGroup=dataset.getContainer("labelhighlight")||dataset.addContainer("labelhighlight",createGroup("labelhighlight",datalabelGroup,dataset));!dataset.getContainer("labelfloat")&&dataset.addContainer("labelfloat",createGroup("labelfloat",datalabelGroup,dataset).insertAfter(labelHighlightGroup))};_proto._getHoveredPlot=function _getHoveredPlot(chartX,chartY){var dataset=this,trackerElem,m,keys;keys=Object.keys(dataset.config.kdTree||{});for(m=keys.length-1;m>-1;m--){if(dataset.config.kdTree[keys[m]].searchTreemap(chartX,chartY)){trackerElem=dataset.config.kdTree[keys[m]].searchTreemap(chartX,chartY);break}}if(trackerElem){dataset.pointObj=trackerElem;return{pointIndex:trackerElem.i||trackerElem.index,hovered:true,pointObj:trackerElem}}};_proto.kdTreePartioning=function kdTreePartioning(){var dataset=this,trackerConfigArray=dataset.getFromEnv("chartConfig").trackerConfig,m,keys,trackerObjPartition={};for(m=trackerConfigArray.length;m--;){trackerConfigArray[m].i=m;if(trackerObjPartition[trackerConfigArray[m].node.meta.depth]===UNDEF){trackerObjPartition[trackerConfigArray[m].node.meta.depth]=[]}trackerObjPartition[trackerConfigArray[m].node.meta.depth].push(trackerConfigArray[m])}dataset.config.kdTree={};keys=Object.keys(trackerObjPartition);for(m=keys.length-1;m>-1;m--){dataset.config.kdTree[keys[m]]=kdTreeAbs&&kdTreeAbs(trackerObjPartition[keys[m]])}};_proto._rolloverResponseSetter=function _rolloverResponseSetter(elem,event,dataset){var elData=elem.getData(),animationManager=dataset.getFromEnv("animationManager"),chart=this.getFromEnv("chart");if(elData&&elData.showHoverEffect!==0){if(!chart.getState("drill")){animationManager.setAnimationState(MOUSEOVER);animationManager.setAnimation({el:elem,label:"rect",component:dataset,attr:elem.getData().setRolloverAttr})}chart.plotEventHandler(elem,event,ROLLOVER)}};_proto._getParentNode=function _getParentNode(nodePath){if(nodePath===void 0){nodePath=[]}var navigationBarNodes=this.conf.navigationBarNodes||[],i,len=navigationBarNodes.length,nodePathLen=nodePath.length,parent=nodePath[nodePathLen-2],self=nodePath[nodePathLen-1],isParentInNavBar=false;if(nodePathLen<2){return false}for(i=0;i<len;i++){if(navigationBarNodes[i].id===parent.id){isParentInNavBar=true;break}}return isParentInNavBar?self:parent};_proto._firePlotEvent=function _firePlotEvent(eventType,plotIndex,e){var dataset=this,currentToolTip=dataset.config.currentToolTip,data=dataset.getFromEnv("chartConfig").trackerConfig[plotIndex||0],setElement=data&&data.node&&data.node.plotItem,toolText=data&&data.plotDetails&&data.plotDetails.toolText,toolTipController=dataset.getFromEnv("toolTipController"),originalEvent=e.originalEvent,singleTracker=dataset.graphics.singleTracker,plotDetails=dataset.pointObj.plotDetails,attr,parent=dataset._getParentNode(data&&data.node.path),rectParent=parent&&parent.rect;if(!setElement){setElement=data&&(data.node.plotItem||data.node.polyPathItem);plotDetails={};plotDetails.rect={}}else if(dataset.conf.highlightParentsOnHover&&parent){attr={x:rectParent.x,y:rectParent.y,width:rectParent.width,height:rectParent.height,stroke:"rgba(255,255,255,0)"}}else{attr={x:plotDetails.rect.x||0,y:plotDetails.rect.y||0,width:plotDetails.rect.width||0,height:plotDetails.rect.height||0,stroke:"rgba(255,255,255,0)"}}singleTracker=dataset.graphics.singleTracker=dataset.getFromEnv("animationManager").setAnimation({el:dataset.graphics.singleTracker||"rect",attr:attr,component:dataset,label:"tracker",container:dataset.getContainer("tracker"),doNotRemove:true}).toFront();if(setElement){setElement.node.style.cursor=POINTER;singleTracker.node.style.cursor=POINTER;switch(eventType){case"fc-mouseover":if(dataset.conf.showHoverEffect){data.evtFns.hover[0](singleTracker)}else{singleTracker.attr("fill",_lib.TRACKER_FILL)}if(toolText){if(currentToolTip){toolTipController.draw(originalEvent,toolText,currentToolTip)}else{currentToolTip=dataset.config.currentToolTip=toolTipController.draw(originalEvent,toolText)}}break;case"fc-mouseout":setElement.node.style.cursor=DEFAULT_CURSOR;singleTracker.node.style.cursor=POINTER;singleTracker.attr({x:0,y:0,width:0,height:0,stroke:"#ffffff","stroke-width":"0px"});singleTracker.toFront();toolTipController.hide(currentToolTip);data.evtFns.hover[1](singleTracker);break;case"fc-click":data&&data.evtFns&&data.evtFns.click&&data.evtFns.click[0]();dataset.config.kdTree={};dataset.addJob("click",dataset.kdTreePartioning.bind(dataset),_schedular.priorityList.tracker);break;case"fc-mousemove":if(toolText){if(currentToolTip){toolTipController.draw(originalEvent,toolText,currentToolTip)}else{currentToolTip=dataset.config.currentToolTip=toolTipController.draw(originalEvent,toolText)}}}}};_proto.draw=function draw(){var datasetDefStore=this,dsConf=datasetDefStore.conf,chart=datasetDefStore.getFromEnv("chart"),chartConf=datasetDefStore.getFromEnv("chartConfig"),trackerConfig=chartConf.trackerConfig,canvasLeft=chartConf.canvasLeft,canvasTop=chartConf.canvasTop,datasetLayer,metaInf=dsConf.metaTreeInf,elemStore=datasetDefStore.graphics.elemStore,rendererAPI={},graphicPool=dsConf._graphicPool||(dsConf._graphicPool={}),drawingAreaCenterPoint={},groupLabelCssProps=["fontFamily","fontSize","fontWeight","fontStyle"],groupLabelCss={cursor:POINTER},nodeRect,tree,attrs=dsConf,drawTreeFn,shadeFilter,ref=this.getFromEnv("ref"),index,length,animationManager=datasetDefStore.getFromEnv("animationManager"),containerManager=ref.containerManager,chartLevelAttr,algorithmFactory=ref.algorithmFactory,removeNodeItemsObjectArr={},attr;trackerConfig&&(trackerConfig.length=0);datasetDefStore.createContainer();chartLevelAttr=_lib.parsexAxisStyles.apply(this,[{},{},datasetDefStore.getFromEnv("chart-attrib"),{fontFamily:"Verdana,sans",fontSize:"10px"}]);for(index=0,length=groupLabelCssProps.length;index<length;index++){attr=groupLabelCssProps[index];if(attr in chartLevelAttr){groupLabelCss[attr]=chartLevelAttr[attr]}}containerManager.remove();datasetLayer=datasetDefStore.getContainer("plots");datasetDefStore.getContainer("datalabels").css(groupLabelCss);dsConf.colorRange=datasetDefStore.getFromEnv("colorManager");metaInf.effectiveWidth=chartConf.canvasRight-canvasLeft;metaInf.effectiveHeight=chartConf.canvasBottom-canvasTop;metaInf.startX=canvasLeft;metaInf.startY=canvasTop;drawingAreaCenterPoint.x=metaInf.effectiveWidth/2;drawingAreaCenterPoint.y=metaInf.effectiveHeight/2;drawingAreaCenterPoint.x=metaInf.effectiveWidth/2;drawingAreaCenterPoint.y=metaInf.effectiveHeight/2;rendererAPI.drawPolyPath=function(config,styleAttrs,node){var pathElem;removeNodeItemsObjectArr[node.id]&&delete removeNodeItemsObjectArr[node.id];pathElem=animationManager.setAnimation({el:rendererAPI.graphicPool(false,"polyPathItem")||"path",container:datasetLayer,attr:{path:config.path},css:styleAttrs,state:chart.getState("drill")?"updating":"appearing",label:"path",component:datasetDefStore});pathElem&&elemStore.polypath.push(pathElem);return pathElem};rendererAPI.drawRect=function(rect,styleAttrs,_rect,overriddenAttrs,node){var prop,pVal,beforeAnimationStateRect={},overrideCss={},newElem;removeNodeItemsObjectArr[node.id]&&delete removeNodeItemsObjectArr[node.id];for(prop in rect){pVal=rect[prop];if(pVal<0){rect[prop]=0;overrideCss.visibility=HIDDEN_STR}}(0,_lib.extend2)(beforeAnimationStateRect,rect);beforeAnimationStateRect.x=drawingAreaCenterPoint.x;beforeAnimationStateRect.y=drawingAreaCenterPoint.y;beforeAnimationStateRect.height=0;beforeAnimationStateRect.width=0;nodeRect=animationManager.setAnimation({el:rendererAPI.graphicPool(false,"plotItem")||"rect",container:datasetLayer,attr:rect,css:Object.assign(styleAttrs,overrideCss),state:chart.getState("drill")?"updating":"appearing",props:node.__props,label:"rect",component:datasetDefStore}).toFront();newElem&&elemStore.rect.push(newElem);return nodeRect};rendererAPI.drawText=function(textVal,coordinates,attrs,_coordinates,overAttr,node){if(overAttr===void 0){overAttr={}}var mandatoryStyle={},newTextElem,text=textVal,newHighlightElem,state,label,labelAttrs,highlightMask,visibility,textAttrs=attrs.textAttrs,highlightsAttrs=attrs.highlightAttrs;state=chart.getState("drill")?"updating":"appearing";removeNodeItemsObjectArr[node.id]&&delete removeNodeItemsObjectArr[node.id];(0,_lib.extend2)(mandatoryStyle,textAttrs);delete mandatoryStyle.fill;mandatoryStyle["stroke-linejoin"]=ROUND_STR;delete overAttr.opacity;text=coordinates.x<0||coordinates.y<0?_lib.BLANKSTRING:text;labelAttrs=Object.assign({},textAttrs,overAttr,{text:text,x:coordinates.x,y:coordinates.y,visibility:"visible"});label=animationManager.setAnimation({el:rendererAPI.graphicPool(false,"labelItem")||rendererAPI.graphicPool(false,"pathlabelItem")||"text",container:datasetDefStore.getContainer("labelfloat"),component:datasetDefStore,attr:labelAttrs,state:state,label:"labelItem"});label.outlineText(datasetDefStore.conf.showTextOutline,labelAttrs.fill);label.show();visibility=highlightsAttrs.visibility!==HIDDEN;delete highlightsAttrs.visibility;highlightMask=animationManager.setAnimation({el:rendererAPI.graphicPool(false,"highlightItem")||rendererAPI.graphicPool(false,"pathhighlightItem")||"text",container:datasetDefStore.getContainer("labelhighlight"),component:datasetDefStore,attr:Object.assign({},overAttr,highlightsAttrs,{x:coordinates.x,y:coordinates.y,text:visibility?text:"",visibility:"visible"}),css:{lineHeight:mandatoryStyle.fontSize*1.2+"px"},state:state,label:"highlightItem"});datasetDefStore.prevLabelGlowVisibility!==visibility&&visibility===true&&highlightMask.show();datasetDefStore.prevLabelGlowVisibility=visibility;elemStore.label.push(newTextElem);elemStore.highlight.push(newHighlightElem);return{label:label,highlightMask:highlightMask}};rendererAPI.disposeItems=function(node,disposeList){var i,item,prop,disposeNames=disposeList||["plotItem","labelItem","hotItem","highlightItem","polyPathItem","pathlabelItem","pathhighlightItem","stackedpolyPathItem","stackedpathlabelItem","stackedpathhighlightItem"];for(i=0;i<disposeNames.length;i+=1){prop=disposeNames[i];item=node[prop];item&&item.type==="text"&&item.attr({text:"","text-bound":[]});item&&!item.removed&&(item=animationManager.setAnimation({el:item,component:datasetDefStore}));node[prop]=UNDEF}};rendererAPI.disposeChild=function(){var rendererAPI,disposeItems=function disposeItems(){return rendererAPI.disposeItems},removeFn=function removeFn(currentNode,depth){var index,childrenArr;disposeItems(currentNode);for(index=0;index<(currentNode.getChildren()||[]).length;index++){childrenArr=currentNode.getChildren();index=removeFn(childrenArr[index],index)}return depth};return function(node){var parentNode=node.getParent();if(!rendererAPI){rendererAPI=this;disposeItems=disposeItems()}if(parentNode){rendererAPI.disposeChild(parentNode)}else{removeFn(node,0)}}}();rendererAPI.disposeSelectedChildren=function(){var rendererAPI,disposeSelectedItems=function disposeSelectedItems(){return rendererAPI.addRemovalNodes},removeItems=function removeItems(currentNode,depth){var index,childrenArr;disposeSelectedItems(currentNode);for(index=0;index<(currentNode.getChildren()||[]).length;++index){childrenArr=currentNode.getChildren();index=removeItems(childrenArr[index],index)}return depth};return function(node){var parentNode=node.getParent();if(!rendererAPI){rendererAPI=this;disposeSelectedItems=disposeSelectedItems()}if(parentNode){rendererAPI.addRemovalNodes(parentNode)}else{removeItems(node,0)}}}();rendererAPI.addRemovalNodes=function(node){removeNodeItemsObjectArr[node.id]=node};rendererAPI.hideNodes=function(){var i,item,node,prop,disposeNames=["plotItem","labelItem","hotItem","highlightItem","polyPathItem","pathlabelItem","pathhighlightItem","stackedpolyPathItem","stackedpathlabelItem","stackedpathhighlightItem"];for(var itr in removeNodeItemsObjectArr){node=removeNodeItemsObjectArr[itr];for(i=0;i<disposeNames.length;i+=1){prop=disposeNames[i];item=node[prop];item&&item.type==="text"&&item.attr({text:"","text-bound":[]});item=item&&!item.removed&&animationManager.setAnimation({el:item,component:datasetDefStore,label:"gen"});node[prop]=UNDEF}}};rendererAPI.graphicPool=function(){return function(add,type,elem){var freeElement,dumpArr=graphicPool[type];if(!dumpArr){dumpArr=graphicPool[type]=[]}if(type==="hotItem"||type==="pathhotItem"){elem.remove()}if(add){dumpArr.push(elem)}else{freeElement=dumpArr.splice(0,1)[0];if(freeElement){freeElement.show();return freeElement}}}}();rendererAPI.disposeComplimentary=function(targetNode){var child,childrenArr,rendererAPI=this,parentNode=targetNode.getParent(),leftSiblingCount=targetNode.getSiblingCount("left");if(parentNode){childrenArr=parentNode.getChildren();child=childrenArr.splice(leftSiblingCount,1)[0];rendererAPI.disposeChild(targetNode);childrenArr.splice(leftSiblingCount,0,child)}rendererAPI.removeLayers()};rendererAPI.removeLayers=function(){var index,length,hot,_hotLayer;_hotLayer=elemStore.hot;length=_hotLayer.length;for(index=0;index<length;index++){hot=_hotLayer[index];hot&&hot.remove()}_hotLayer.length=0};if(datasetDefStore.getState("dirty")){algorithmFactory.init(dsConf.algorithm,true,dsConf.maxDepth);drawTreeFn=algorithmFactory.plotOnCanvas(datasetDefStore.config.JSONData,chart._getCleanValue());containerManager.init(datasetDefStore,metaInf,rendererAPI,tree,drawTreeFn)}containerManager.draw();shadeFilter=algorithmFactory.applyShadeFiltering({fill:attrs.rangeOutBgColor,opacity:attrs.rangeOutBgAlpha*.01},(function(css){var nodeInf=this;nodeInf.plotItem&&nodeInf.plotItem.css(css)}));datasetDefStore.addExtEventListener("legendUpdate",(function(e,d){shadeFilter.call(this,{start:d.maxMinArray[0].min,end:d.maxMinArray[0].max});dsConf.range={min:d.maxMinArray[0].min,max:d.maxMinArray[0].max}}),datasetDefStore.getFromEnv("colorManager"));dsConf.isConfigured=false;datasetDefStore.addJob("buildKDTreeID",datasetDefStore.kdTreePartioning.bind(datasetDefStore),_schedular.priorityList.tracker)};_proto.getType=function getType(){return"dataset"};_proto.setJSONIndex=function setJSONIndex(index){this.config.index=index};_proto.getJSONIndex=function getJSONIndex(){return this.config.index||0};return TreeMapDS}(_componentInterface.ComponentInterface);var _default=TreeMapDS;exports.default=_default;