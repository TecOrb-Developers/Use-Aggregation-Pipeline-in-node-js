"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.copyScale=copyScale;exports.deInterpolateLinear=deInterpolateLinear;exports.bimap=bimap;exports.default=void 0;var _value=_interopRequireDefault(require("../scale-utils/interpolators/value"));var _round=_interopRequireDefault(require("../scale-utils/interpolators/round"));var _constant=_interopRequireDefault(require("../scale-utils/constant"));var _enUS=_interopRequireDefault(require("..//number-converter/locales/en-US"));var _numberConverter=require("..//number-converter");var count=0,UNDEF;var UNIT=[0,1];function bimap(domain,range,deInterpolate,reInterpolate){var deInterpolator,reInterpolator;if(domain[0]>domain[1]){deInterpolator=deInterpolate(domain[1],domain[0]);reInterpolator=reInterpolate(range[1],range[0])}else{deInterpolator=deInterpolate(domain[0],domain[1]);reInterpolator=reInterpolate(range[0],range[1])}return function(value){return reInterpolator(deInterpolator(value))}}function copyScale(sourceScale,targetScale){return targetScale.setInterpolate(sourceScale.getInterpolate()).setClamp(sourceScale.getClamp()).setDomain(sourceScale.getDomain()).setRange(sourceScale.getRange())}function deInterpolateLinear(_min,_max){var min=Number(_min),max=Number(_max),diff=max-min;if(!diff){return(0,_constant.default)(diff)}return function(value){return(value-min)/diff}}function deInterpolateClamp(deInterpolate){return function(_min,_max){var min=Number(_min),max=Number(_max),interpolator=deInterpolate(min,max);return function(value){if(value<=min){return 0}else if(value>=max){return 1}return interpolator(value)}}}function reInterpolateClamp(reInterpolate){return function(_min,_max){var min=Number(_min),max=Number(_max),interpolator=reInterpolate(min,max);return function(ratio){if(ratio<=0){return min}else if(ratio>=1){return max}return interpolator(ratio)}}}var ScaleContinuous=function(){function ScaleContinuous(deInterpolate,reInterpolate){this.domain=UNIT;this.range=UNIT;this.deInterpolate=deInterpolate;this.reInterpolate=reInterpolate;this.interpolate=_value.default;this.clamp=false;this.input=null;this.output=null;this.locale=_enUS.default;this._localeConverter=new _numberConverter.NumberConverter(_enUS.default);this._rescale();this._id="scale_"+count++}var _proto=ScaleContinuous.prototype;_proto._rescale=function _rescale(){this.input=null;this.output=null;return this};_proto.setDomain=function setDomain(inputArr){if(inputArr===void 0){inputArr=UNIT}this.domain=inputArr.map(Number);return this._rescale()};_proto.getDomain=function getDomain(){return this.domain.slice()};_proto.setRange=function setRange(inputArr){if(inputArr===void 0){inputArr=UNIT}this.range=inputArr.slice();return this._rescale()};_proto.getRange=function getRange(){return this.range.slice()};_proto.setInterpolate=function setInterpolate(interpolate){if(interpolate===void 0){interpolate=_value.default}this.interpolate=interpolate;return this._rescale()};_proto.getInterpolate=function getInterpolate(){return this.interpolate};_proto.setClamp=function setClamp(clamp){if(clamp===void 0){clamp=false}this.clamp=!!clamp;return this._rescale()};_proto.getClamp=function getClamp(){return this.clamp};_proto.rangeRound=function rangeRound(inputArr){if(inputArr===void 0){inputArr=UNIT}this.range=inputArr.slice();this.interpolate=_round.default;return this._rescale()};_proto.getRangeValue=function getRangeValue(_domainValue){var domainValue=_domainValue!==null?_domainValue:UNDEF,clamp=this.getClamp(),deInterpolate=clamp?deInterpolateClamp(this.deInterpolate):this.deInterpolate;if(!this.output){this.output=bimap(this.getDomain(),this.getRange(),deInterpolate,this.interpolate)}return this.output(Number(domainValue))};_proto.getDomainValue=function getDomainValue(rangeValue){var clamp=this.getClamp(),reInterpolate=clamp?reInterpolateClamp(this.reInterpolate):this.reInterpolate;if(!this.input){this.input=bimap(this.getRange(),this.getDomain(),deInterpolateLinear,reInterpolate)}return this.input(Number(rangeValue))};_proto.setLocale=function setLocale(locale){if(locale===void 0){locale=_enUS.default}this.locale=locale;this._localeConverter=new _numberConverter.NumberConverter(locale);return this};_proto.getLocale=function getLocale(){return this.locale};_proto.getId=function getId(){return this._id};return ScaleContinuous}();var _default=ScaleContinuous;exports.default=_default;