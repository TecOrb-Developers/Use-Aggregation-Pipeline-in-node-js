"use strict";exports.__esModule=true;exports.default=void 0;var _lib=require("@fusioncharts/core/src/lib");var BLACK_LIST={treemap:true,scatter:true,bubble:true,errorscatter:true,errorline:true,errorbar2d:true,candlestick:true,stackedcolumn3d:true,stackedbar3d:true,mscolumnline3d:true,mscombi3d:true,mscolumn3dlinedy:true,stackedcolumn3dline:true,stackedcolumn3dlinedy:true},DEFAULT_PLOT_COLOR="#000000",isBlackListed=function isBlackListed(component){return BLACK_LIST[component.getName().toLowerCase()]},reduceToolTexts=function reduceToolTexts(acc,tooltext){return acc+'<div style="margin: 0;">'+tooltext+"</div>"},countHoveredPlots=function countHoveredPlots(acc,info){return info.hovered?acc+1:acc},extractColor=function extractColor(plotConfig){return plotConfig.originalPlotColor||plotConfig.plotColor||plotConfig.color||DEFAULT_PLOT_COLOR},compareByJsonIndex=function compareByJsonIndex(a,b){return b.getJSONIndex()-a.getJSONIndex()};function _enableConsolidatedToolTip(e){var chart=e.sender.getFromEnv("chart"),canvas=this,toolTextGray=chart.config.tooltipgrayoutcolor,showPlotColor=chart.config.plotcolorintooltip,toolTipController=chart.getFromEnv("toolTipController"),datasets=chart.getDatasets().sort(compareByJsonIndex),consolidatedToolTip=chart.getFromEnv("consolidated-tooltip"),chartCoords=(0,_lib.getMouseCoordinate)(e.sender.getFromEnv("chart-container"),e.originalEvent,chart),canvasX=chartCoords.chartX,canvasY=chartCoords.chartY,alreadyColored=false,hoveredInfos=datasets.map((function(dataset){return dataset.getPlotInCategoryAt(canvasX,canvasY)})).filter(Boolean),numPlotsHovered=hoveredInfos.reduce(countHoveredPlots,0),plotTexts=hoveredInfos.map((function(hoveredInfo){var dataConfig=hoveredInfo.pointObj.config,text=dataConfig.finalTooltext||dataConfig.toolText,color=extractColor(dataConfig);if(numPlotsHovered>0){if(!alreadyColored&&hoveredInfo.hovered){text='<div style="display: inline-block;">'+text+"</div>";alreadyColored=true}else{color=toolTextGray;text='<div style="color: '+(0,_lib.hashify)(toolTextGray)+'; display: inline-block;">'+text+"</div>"}}else{text='<div style="display: inline-block;">'+text+"</div>"}return showPlotColor?'<div style="color: '+(0,_lib.hashify)(color)+'; display: inline-block;">&#9632&nbsp;</div>'+text:text})),consolidatedText=[].concat(plotTexts).reverse().reduce(reduceToolTexts,"");if(!canvas.isWithinCanvas(canvasX,canvasY)){consolidatedToolTip&&toolTipController.hide(consolidatedToolTip);return}if(consolidatedText){if(!consolidatedToolTip){chart.addToEnv("consolidated-tooltip",toolTipController.draw(e.originalEvent,consolidatedText))}else{toolTipController.draw(e.originalEvent,consolidatedText,consolidatedToolTip)}}else{consolidatedToolTip&&toolTipController.hide(consolidatedToolTip)}}function _disableConsolidatedToolTip(e){var chart=e.sender.getFromEnv("chart"),consolidatedToolTip=chart.getFromEnv("consolidated-tooltip");consolidatedToolTip&&chart.getFromEnv("toolTipController").hide(consolidatedToolTip)}function drawConsolidatedToolTip(idx){var chart=this.apiInstance,datasets=chart.getDatasets().sort(compareByJsonIndex),showPlotColor=chart.config.plotcolorintooltip,toolTipController=chart.getFromEnv("toolTipController"),consolidatedToolTip=chart.getFromEnv("consolidated-tooltip"),dataComponents=datasets.map((function(dataset){var dataComponent=dataset.components.data;return dataComponent[idx]&&dataComponent[idx]})).filter(Boolean),coords=dataComponents[0]&&{x:dataComponents[0].config._Px-dataComponents[0]._width,y:dataComponents[0].config._Py,width:dataComponents[0].config._width},consolidatedText=dataComponents.map((function(data){var config=data.config,text=config.finalTooltext||config.toolText;return showPlotColor?'<div style="color: '+(0,_lib.hashify)(extractColor(config))+'; display: inline-block;">&#9632&nbsp;</div><div style="display: inline-block;">'+text+"</div>":'<div style="display: inline-block;">'+text+"</div>"})).reduce(reduceToolTexts,"");if(consolidatedText&&coords){if(!consolidatedToolTip){chart.addToEnv("consolidated-tooltip",toolTipController.drawAt(coords.x,coords.y,consolidatedText))}else{toolTipController.drawAt(coords.x,coords.y,consolidatedText,consolidatedToolTip)}}else{consolidatedToolTip&&toolTipController.hide(consolidatedToolTip)}}function consolidatedTooltipExt(FusionCharts){FusionCharts.addEventListener("predraw",(function onFcPredraw(event){var chart;if(event.sender.getType&&event.sender.getType()==="chartAPI"&&!isBlackListed(event.sender)){chart=event.sender;var canvases=chart.getChildren("canvas");chart.getFromEnv("chartInstance").drawConsolidatedToolTip=drawConsolidatedToolTip;canvases&&canvases.forEach((function(canvas){if(!chart.config.drawTrendRegion||!chart.config.showtooltip){canvas.removeEventListener("fc-mouseover",_enableConsolidatedToolTip);canvas.removeEventListener("fc-mousemove",_enableConsolidatedToolTip);canvas.removeEventListener("fc-mouseout",_disableConsolidatedToolTip);canvas.setState("consolidatedTooltipEventListenerAttached",false);return}if(!canvas.getState("consolidatedTooltipEventListenerAttached")&&chart.config.showtooltip){canvas.addEventListener("fc-mouseover",_enableConsolidatedToolTip);canvas.addEventListener("fc-mousemove",_enableConsolidatedToolTip);canvas.addEventListener("fc-mouseout",_disableConsolidatedToolTip);canvas.setState("consolidatedTooltipEventListenerAttached",true)}}))}}))}var _default={extension:consolidatedTooltipExt,name:"ConsolidatedToolTip",type:"extension",requiresFusionCharts:true};exports.default=_default;