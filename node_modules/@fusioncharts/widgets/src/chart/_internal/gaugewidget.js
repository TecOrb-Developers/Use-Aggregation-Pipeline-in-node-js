"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _realtime=require("./realtime");var _schedular=require("@fusioncharts/core/src/schedular");var _commonchartapi=_interopRequireDefault(require("@fusioncharts/charts/src/chart/_internal/commonchartapi"));var _lib=require("@fusioncharts/core/src/lib");var _singleseriesDataset=_interopRequireDefault(require("@fusioncharts/charts/src/factories/singleseries-dataset"));var _constructor=_interopRequireDefault(require("@fusioncharts/constructor/src/constructor"));var _datastreamer=_interopRequireDefault(require("./datastreamer"));var defaultGaugePaletteOptions=(0,_lib.extend2)({},_lib.defaultGaugePaletteOptions),math=Math,mathMax=math.max,getDataset=function getDataset(component){var datasets=[];component.iterateComponents((function(child){if(child.getType()==="dataset"){datasets.push(child)}}));return datasets};_constructor.default.addDep(_datastreamer.default);var GaugeWidget=function(_CommonAPI){(0,_inheritsLoose2.default)(GaugeWidget,_CommonAPI);GaugeWidget.getName=function getName(){return"GaugeBase"};function GaugeWidget(){var _this;_this=_CommonAPI.call(this)||this;_this.defaultPaletteOptions=defaultGaugePaletteOptions;_this.multiValueGauge=false;_this.drawAnnotations=true;_this.includeColorRangeInLimits=false;_this.isWidget=true;_this._feedAxesRawData=_this._feedAxesRawData||_lib.stubFN;_this._setCategories=_this._setCategories||_lib.stubFN;_this.eiMethods=_realtime.eiMethods;_this.registerFactory("dataset",_singleseriesDataset.default,["vCanvas"]);_this.registerFactory("axis",_lib.stubFN,["vCanvas"]);return _this}var _proto=GaugeWidget.prototype;_proto.getName=function getName(){return"GaugeBase"};_proto.__setDefaultConfig=function __setDefaultConfig(){_CommonAPI.prototype.__setDefaultConfig.call(this);var config=this.config;config.valuefontbold=1;config.useScaleRecursively=true;config.formatnumberscale=0};_proto.parseChartAttr=function parseChartAttr(dataObj){_CommonAPI.prototype.parseChartAttr.call(this,dataObj);this.config.drawTrendRegion=0};_proto.realTimeUpdate=function realTimeUpdate(dataObj){var iapi=this,components=iapi.getChildren(),dataset=components.dataset,newDataset=dataObj.dataset,newCategory=dataObj.categories&&dataObj.categories.category||[],realTimeConfig=iapi.config.realTimeConfig=iapi.config.realTimeConfig||(iapi.config.realTimeConfig={}),data,length,i,curDataset;iapi.fireChartInstanceEvent("updateDataReceived",dataObj);iapi.fireEvent("realtimeDataUpdate",dataObj);if(!iapi.config.cachedArrivedJSON){iapi.config.cachedArrivedJSON={}}iapi.config.cachedArrivedJSON=dataObj;if(dataset){curDataset=newDataset[0];data=curDataset.data;for(i=0,length=data.length;i<length;i++){data[i].label=newCategory[i]&&newCategory[i].label}dataset[0].maxminFlag&&(realTimeConfig.maxminFlag=dataset[0].maxminFlag)}};_proto._setData=function _setData(value,label){var stream=_lib.BLANKSTRING;if(value&&value.toString||value===_lib.BLANKSTRING||value===0){stream="value="+value.toString()}if(label&&label.toString||label===_lib.BLANKSTRING){stream=stream+"&label="+label.toString()}if(stream){this.feedData(stream)}};_proto._getData=function _getData(){var iapi=this,components=iapi.getChildren(),dataset=iapi.getDatasets(),xAxis=components.xAxis&&components.xAxis[0]||components.scale,length,i,j,store=[],maxLength=0,data,innerStore;if(dataset){length=dataset.length;for(i=0;i<length;i++){maxLength=mathMax(maxLength,dataset[i].components.data.length)}for(i=0;i<maxLength;i++){innerStore=store[i]=[];innerStore[0]=xAxis.getLabel(i).label;for(j=1;j<=length;j++){data=dataset[j-1].components.data[i];innerStore[j]=data&&data.config.setValue}}return store}};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){};_proto.realTimeDraw=function realTimeDraw(eventArgs){if(eventArgs===void 0){eventArgs={}}if(!this.config.cachedArrivedJSON){return}var iapi=this,config=iapi.config,prevData=config.prevData,dataset=getDataset(iapi),dataObj=config.cachedArrivedJSON,newDataset,realTimeConfig=config.realTimeConfig||(config.realTimeConfig={}),curDataset,showRTValue=realTimeConfig.showRTValue,drawLatency,i,inputData,pointerId=[],pointerIdLen,getValueArray=function getValueArray(data){if(data===void 0){data=[]}var len=data.length,newData=[],ii,dataObject;for(ii=0;ii<len;++ii){dataObject=data[ii];newData.push(dataObject.value)}return[newData]};iapi.__rtDrawStartAt=new Date;iapi.getFromEnv("animationManager").setAnimationState("realTimeUpdate");if(dataset&&dataset.length){inputData=dataObj.dataset[0].data;pointerId=Object.keys(dataset[0].config.dataById||dataset[0].config.idMap||{});pointerIdLen=pointerId.length;for(i=0;i<pointerIdLen;i++){if(dataObj.hasOwnProperty(pointerId[i])){inputData.push({value:Number(dataObj[pointerId[i]]),id:pointerId[i]})}}config.prevData=getValueArray(inputData);newDataset=dataObj.dataset;curDataset=newDataset[0];curDataset.data[0]&&(curDataset.data[0].label=dataObj.categories&&dataObj.categories.category&&dataObj.categories.category[0]&&dataObj.categories.category[0].label);dataset[0].updateData(curDataset);dataset[0].maxminFlag&&(realTimeConfig.maxminFlag=dataset[0].maxminFlag);dataset[0].asyncDraw();config.cachedArrivedJSON=_lib.UNDEF;iapi.rtManageSpace&&iapi._RTmanageSpace();iapi.prepareAttributes&&iapi.prepareAttributes();iapi._preDraw();if(showRTValue&&iapi._drawRealTimeValue){iapi.asyncRealTimeValueDraw()}}config._eventArgs=eventArgs;eventArgs.prevData=prevData;iapi.__realtimeUpdateComplete||(iapi.__realtimeUpdateComplete=function(){drawLatency=new Date-iapi.__rtDrawStartAt;if(!realTimeConfig.clear){config._eventArgs.latency=drawLatency;config._eventArgs.updateObject=realTimeConfig.legacyUpdateObj}iapi.getChildren("dataStreamer")[0].addToEnv("realtimeDrawingLatency",drawLatency);iapi.fireChartInstanceEvent("realTimeUpdateComplete",config._eventArgs)});iapi.addJob("realtimeupdatecomplete",iapi.__realtimeUpdateComplete,_schedular.priorityList.postRender)};_proto._setRTmenu=function _setRTmenu(showRTmenuItem,useMessageLog){_realtime._setRTmenu.call(this,showRTmenuItem,useMessageLog)};_proto._createLayers=function _createLayers(){var iapi=this,belowPlotGroup,axisBottomGroup;_CommonAPI.prototype._createLayers.call(this);belowPlotGroup=iapi.getChildContainer("belowPlotGroup");axisBottomGroup=iapi.getChildContainer("axisBottomGroup");belowPlotGroup.insertBefore(axisBottomGroup)};_proto._realTimeConfigure=function _realTimeConfigure(){_realtime._realTimeConfigure.call(this)};_proto._stopUpdate=function _stopUpdate(source){_realtime._stopUpdate.call(this,source)};_proto._restartUpdate=function _restartUpdate(){_realtime._restartUpdate.call(this)};_proto._isUpdateActive=function _isUpdateActive(){return _realtime._isUpdateActive.call(this)};_proto.feedData=function feedData(stream){_realtime.feedData.call(this,stream)};_proto._linearDataParser=function _linearDataParser(responseText){return _realtime._linearDataParser.call(this,responseText)};_proto._clearChart=function _clearChart(_source){_realtime._clearChart.call(this,_source)};return GaugeWidget}(_commonchartapi.default);var _default=GaugeWidget;exports.default=_default;